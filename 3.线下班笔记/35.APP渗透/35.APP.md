# 1.隐私合规

## 一.隐私合规评估依据

1. 《⽹络安全法》

2. 《信息安全技术个⼈信息安全规范》
3. 《关于开展纵深推进APP侵害⽤户权益专项整治⾏动》 
4. 《App违法违规使⽤个⼈信息⾃评估指南》 
5. 《app弹窗治理》 
6. 《⽤户感知提升和信息共享公开通知》

## 二.隐私合规覆盖重点问题

1. 违规收集/超范围收集个⼈信息 
2. 强制⽤户使⽤定向推送功能 
3. APP强制.频繁.过度索取权限.APP频繁⾃启动和关联启动
4. 欺骗诱导强迫⾏为.欺骗误导⽤户提供个⼈信息 
5. 具有分发功能的APP信息明示不到位

## 三.隐私合规注意事项

###   一.未公开收集使⽤规则  

1. 
   在App中没有隐私政策，或者隐私政策中没有收集使⽤个⼈信息规则；  

2. 在App⾸次运⾏时未通过弹窗等明显⽅式提示⽤户阅读隐私政策等收集使⽤规则  

3. 隐私政策等收集使⽤规则难以访问，如进⼊App主界⾯后，需多于4次点击等操作才能访问到  
4. 隐私政策等收集使⽤规则难以阅读，如⽂字过⼩过密.颜⾊过淡.模糊不清，或未提供简体中⽂版等  

###  ⼆ .未明示收集使⽤个⼈信息的⽬的.⽅式和范围

1. 未逐⼀列出App（包括委托的第三⽅或嵌⼊的第三⽅代码.插件）收集使⽤个⼈信息的⽬ 的.⽅式.范围等；  

2. 收集使⽤个⼈信息的⽬的.⽅式.范围发⽣变化时，未以适当⽅式通知⽤户，适当⽅式包 括更新隐私政策等收集使⽤规则并提醒⽤户阅读等  
3. 在申请打开可收集个⼈信息的权限，或申请收集⽤户身份证号.银⾏账号.⾏踪轨迹等个⼈敏感信息时，未同步告知⽤户其⽬的，或者⽬的不明确.难以理解  
4. 有关收集使⽤规则的内容晦涩难懂.冗⻓繁琐，⽤户难以理解，如使⽤⼤量专业术语等。  

### 三.未经⽤户同意收集使⽤个⼈信息  

1. App虽然具备隐私政策也在⾸次运⾏时通过弹窗等⽅式提示⽤户阅读隐私政策，但在⽤户可 阅读并决定是否同意隐私政策前，App已要求⽤户提交个⼈信息（如⽤户⼿机号.⽹络（含 三⽅登录）账号.IP地址等）或授权使⽤收集个⼈信息的权限（如电话.存储.位置等）  
2. 
   征得⽤户同意前就开始收集个⼈信息或打开可收集个⼈信息的权限 (例如，未经⽤户 同意收 集或打开收集以下信息的权限：IMEI.IMSI.设备MAC地址.软件安装列表.位置.联系 ⼈.通话记录.⽇历.短信.本机电话号码.图⽚.⾳视频信息或权限)；  

3. 
   ⽤户明确表示不同意后，仍收集个⼈信息或打开可收集个⼈信息的权限；或⽤户明确拒绝 与当前服务场景⽆关权限，频繁弹窗.反复申请，⼲扰⽤户正常使⽤；  

4. 
   实际收集的个⼈信息或打开的可收集个⼈信息权限超出⽤户授权范围；  

5. 
   以默认选择同意隐私政策等⾮明示⽅式征求⽤户同意；  

6. 
   未经⽤户同意更改其设置的可收集个⼈信息权限状态，如App更新时⾃动将⽤户设置的权限 恢复到默认状态；  

7. 
   收集⽤户个⼈信息⽤于定向推送或⼴告精准营销，未以显著⽅式标示且未经⽤户同意，且 未提供关闭定向推送功能的选项；  

8. 
   以欺诈.诱骗等不正当⽅式误导⽤户同意收集个⼈信息或打开可收集个⼈信息的权限，如 故意欺瞒.掩饰收集使⽤个⼈信息的真实⽬的；  

9. 
   ⾮服务所必需或⽆合理场景，通过积分.奖励.优惠等⽅式欺骗误导⽤户提供身份证号码 以及个⼈⽣物特征信息的⾏为  

10. 
    未向⽤户提供撤回同意收集个⼈信息的途径.⽅式  

11. 
    违反其所声明的收集使⽤规则，收集使⽤个⼈信息；  


### 四.违反必要原则，收集与其提供的服务⽆关的个⼈信息  

1. 
   APP.SDK⾮服务所必需或⽆合理应⽤场景，特别是在静默状态下或在后台运⾏ 时，超范 围收集个⼈信息  

2. 
   ⾸次安装运⾏，⽤户未同意隐私政策前或同意隐私政策后⾮服务所必需或⽆应⽤场景时， App申请打开的可收集个⼈信息权限，⽤户拒绝后，应⽤⾃动退出或关闭  

3. 
   App⾸次安装及运⾏期间，收集的个⼈信息类型或打开的可收集个⼈信息权限与现有业务功 能⽆关；  


### 五.应⽤分发平台管理责任落实不到位  

1. 应⽤分发平台管理责任落实不到位。APP上架审核不严格.违法违规软件处理不及时和APP 提供者.运营者.开发者身份信息不真实.联系⽅式虚假失效  



#  2.测评需要工具及环境

模拟器，`adb` ,`frida`,`camille` 先配置adb，添加环境变量。 配置模拟器，进⾏adb连接  

## 一.ADB

### 1.1.ADB简介


ADB 全称为 Android Debug Bridge，起到调试桥的作⽤，是⼀个客户端-服务器端程序。其中客户端
是 ⽤来操作的电脑，服务端是 Android 设备。 


ADB 也是 Android SDK 中的⼀个⼯具，可以直接操作管理 Android 模拟器或者真实的 Android 设备

### 1.2.ADB安装与配置 

#### adb下载安装 

- 
  adb官⽅⽹址：https://developer.android.google.cn/studio/command-line/adb?hl=zh-cn  

- 
  下载地址： https://developer.android.com/studio/releases/platform-tools?hl=zh-cn


#### 下载后解压  

### 1.3.adb环境变量配置


 把解压路径放到系统变量⾥去（Path）

### 1.4.adb使用

#### 连接

- 通过模拟器连接或者⼿机数据线连接。 

- 
  通过数据线连接时，⼿机进⼊"**开发者选项**" ，打开" **usb调试**" 。  


#### 连接模拟器

```python
adb connect ip:port

adb connect 127.0.0.1:62001
```



#### 断开连接

```python
adb disconnect ip:port

adb disconnect 127.0.0.1:62001
```

#### 显示 adb 版本

```python
adb version
```

![image-20240921145904136](https://image.201068.xyz/assets/35.APP/image-20240921145904136.png)

#### 帮助信息

```python
adb help
```

![image-20240921150002852](https://image.201068.xyz/assets/35.APP/image-20240921150002852.png)

```bash
# adb help
Android Debug Bridge version 1.0.41
Version 34.0.4-10411341
Installed as D:\environment\Android\platform-tools\adb.exe
Running on Windows 10.0.22631

global options:
 -a                       listen on all network interfaces, not just localhost
 -d                       use USB device (error if multiple devices connected)
 -e                       use TCP/IP device (error if multiple TCP/IP devices available)
 -s SERIAL                use device with given serial (overrides $ANDROID_SERIAL)
 -t ID                    use device with given transport id
 -H                       name of adb server host [default=localhost]
 -P                       port of adb server [default=5037]
 -L SOCKET                listen on given socket for adb server [default=tcp:localhost:5037]
 --one-device SERIAL|USB  only allowed with 'start-server' or 'server nodaemon', server will only connect to one USB device, specified by a serial number or USB device address.
 --exit-on-write-error    exit if stdout is closed

general commands:
 devices [-l]             list connected devices (-l for long output)
 help                     show this help message
 version                  show version num

networking:
 connect HOST[:PORT]      connect to a device via TCP/IP [default port=5555]
 disconnect [HOST[:PORT]]
     disconnect from given TCP/IP device [default port=5555], or all
 pair HOST[:PORT] [PAIRING CODE]
     pair with a device for secure TCP/IP communication
 forward --list           list all forward socket connections
 forward [--no-rebind] LOCAL REMOTE
     forward socket connection using:
       tcp:<port> (<local> may be "tcp:0" to pick any open port)
       localabstract:<unix domain socket name>
       localreserved:<unix domain socket name>
       localfilesystem:<unix domain socket name>
       dev:<character device name>
       jdwp:<process pid> (remote only)
       vsock:<CID>:<port> (remote only)
       acceptfd:<fd> (listen only)
 forward --remove LOCAL   remove specific forward socket connection
 forward --remove-all     remove all forward socket connections
 reverse --list           list all reverse socket connections from device
 reverse [--no-rebind] REMOTE LOCAL
     reverse socket connection using:
       tcp:<port> (<remote> may be "tcp:0" to pick any open port)
       localabstract:<unix domain socket name>
       localreserved:<unix domain socket name>
       localfilesystem:<unix domain socket name>
 reverse --remove REMOTE  remove specific reverse socket connection
 reverse --remove-all     remove all reverse socket connections from device
 mdns check               check if mdns discovery is available
 mdns services            list all discovered services

file transfer:
 push [--sync] [-z ALGORITHM] [-Z] LOCAL... REMOTE
     copy local files/directories to device
     --sync: only push files that are newer on the host than the device
     -n: dry run: push files to device without storing to the filesystem
     -z: enable compression with a specified algorithm (any/none/brotli/lz4/zstd)
     -Z: disable compression
 pull [-a] [-z ALGORITHM] [-Z] REMOTE... LOCAL
     copy files/dirs from device
     -a: preserve file timestamp and mode
     -z: enable compression with a specified algorithm (any/none/brotli/lz4/zstd)
     -Z: disable compression
 sync [-l] [-z ALGORITHM] [-Z] [all|data|odm|oem|product|system|system_ext|vendor]
     sync a local build from $ANDROID_PRODUCT_OUT to the device (default all)
     -n: dry run: push files to device without storing to the filesystem
     -l: list files that would be copied, but don't copy them
     -z: enable compression with a specified algorithm (any/none/brotli/lz4/zstd)
     -Z: disable compression

shell:
 shell [-e ESCAPE] [-n] [-Tt] [-x] [COMMAND...]
     run remote shell command (interactive shell if no command given)
     -e: choose escape character, or "none"; default '~'
     -n: don't read from stdin
     -T: disable pty allocation
     -t: allocate a pty if on a tty (-tt: force pty allocation)
     -x: disable remote exit codes and stdout/stderr separation
 emu COMMAND              run emulator console command

app installation (see also `adb shell cmd package help`):
 install [-lrtsdg] [--instant] PACKAGE
     push a single package to the device and install it
 install-multiple [-lrtsdpg] [--instant] PACKAGE...
     push multiple APKs to the device for a single package and install them
 install-multi-package [-lrtsdpg] [--instant] PACKAGE...
     push one or more packages to the device and install them atomically
     -r: replace existing application
     -t: allow test packages
     -d: allow version code downgrade (debuggable packages only)
     -p: partial application install (install-multiple only)
     -g: grant all runtime permissions
     --abi ABI: override platform's default ABI
     --instant: cause the app to be installed as an ephemeral install app
     --no-streaming: always push APK to device and invoke Package Manager as separate steps
     --streaming: force streaming APK directly into Package Manager
     --fastdeploy: use fast deploy
     --no-fastdeploy: prevent use of fast deploy
     --force-agent: force update of deployment agent when using fast deploy
     --date-check-agent: update deployment agent when local version is newer and using fast deploy
     --version-check-agent: update deployment agent when local version has different version code and using fast deploy
     (See also `adb shell pm help` for more options.)
 uninstall [-k] PACKAGE
     remove this app package from the device
     '-k': keep the data and cache directories

debugging:
 bugreport [PATH]
     write bugreport to given PATH [default=bugreport.zip];
     if PATH is a directory, the bug report is saved in that directory.
     devices that don't support zipped bug reports output to stdout.
 jdwp                     list pids of processes hosting a JDWP transport
 logcat                   show device log (logcat --help for more)

security:
 disable-verity           disable dm-verity checking on userdebug builds
 enable-verity            re-enable dm-verity checking on userdebug builds
 keygen FILE
     generate adb public/private key; private key stored in FILE,

scripting:
 wait-for[-TRANSPORT]-STATE...
     wait for device to be in a given state
     STATE: device, recovery, rescue, sideload, bootloader, or disconnect
     TRANSPORT: usb, local, or any [default=any]
 get-state                print offline | bootloader | device
 get-serialno             print <serial-number>
 get-devpath              print <device-path>
 remount [-R]
      remount partitions read-write. if a reboot is required, -R will
      will automatically reboot the device.
 reboot [bootloader|recovery|sideload|sideload-auto-reboot]
     reboot the device; defaults to booting system image but
     supports bootloader and recovery too. sideload reboots
     into recovery and automatically starts sideload mode,
     sideload-auto-reboot is the same but reboots after sideloading.
 sideload OTAPACKAGE      sideload the given full OTA package
 root                     restart adbd with root permissions
 unroot                   restart adbd without root permissions
 usb                      restart adbd listening on USB
 tcpip PORT               restart adbd listening on TCP on PORT

internal debugging:
 start-server             ensure that there is a server running
 kill-server              kill the server if it is running
 reconnect                kick connection from host side to force reconnect
 reconnect device         kick connection from device side to force reconnect
 reconnect offline        reset offline/unauthorized devices to force reconnect

usb:
 attach                   attach a detached USB device
 detach                   detach from a USB device to allow use by other processes
environment variables:
 $ADB_TRACE
     comma-separated list of debug info to log:
     all,adb,sockets,packets,rwx,usb,sync,sysdeps,transport,jdwp
 $ADB_VENDOR_KEYS         colon-separated list of keys (files or directories)
 $ANDROID_SERIAL          serial number to connect to (see -s)
 $ANDROID_LOG_TAGS        tags to be used by logcat (see logcat --help)
 $ADB_LOCAL_TRANSPORT_MAX_PORT max emulator scan port (default 5585, 16 emus)
 $ADB_MDNS_AUTO_CONNECT   comma-separated list of mdns services to allow auto-connect (default adb-tls-connect)

Online documentation: https://android.googlesource.com/platform/packages/modules/adb/+/refs/heads/master/docs/user/adb.1.md
```

## 二.模拟器使用

设置开发者模式,

模拟器进⼊开发者模式

![image-20240921164850733](https://image.201068.xyz/assets/35.APP/image-20240921164850733.png)

### 开启UDB调试

#### 夜神模拟器

![image-20240921164822171](https://image.201068.xyz/assets/35.APP/image-20240921164822171.png)

第一个模拟器端口是`62001`，

第二个模拟器端口是`62025`，

第三个是`62026`，

依此类推。

### 连接模拟器 

```python
adb connect 127.0.0.1:62001
adb devices
adb shell
```

![image-20240921150621630](https://image.201068.xyz/assets/35.APP/image-20240921150621630.png)

## 三.Frida

### 3.1.Frida简介

`frida`是⼀款基于`python` + `javascript` 的`hook`框架，可运⾏在`Android,iOS,Linux,Windows`等各平台，主要使⽤**动态⼆进制插桩技术**。

`Hook`翻译成中⽂就是勾⼦的意思，在java中它表示在事件到达终点前进⾏**拦截或监控**的⼀种⾏为。 

**插桩技术**是指将额外的代码注⼊程序中以收集运⾏时的信息，可分为两种：

1. 源代码插桩

2. ⼆进制插桩 

   - 静态⼆进制插桩


   - 动态⼆进制插桩


### 3.2.Frida 安装与配置

#### frida框架分为两部分： 

- ⼀部分是运⾏在系统上的交互⼯具`frida CLI`; 
- ⼀部分是运⾏在⽬标机器上的代 码注⼊⼯具 `frida-server`。  

众所周知，frida是一个轻量级的HOOK工具，多个平台可以使用，Android，ios，Windows等`fida`分为两部分，

服务端运行在目标机上面，通过进程注入的方式来实现劫持应用函数，另一部运行在系统机器上。

#### python安装

##### 安装frida

```python
python -m pip install frida
```

![image-20240921161839193](https://image.201068.xyz/assets/35.APP/image-20240921161839193.png)

##### 安装frida-tools

```python
python -m pip install frida-tools
```

![image-20240921161821634](https://image.201068.xyz/assets/35.APP/image-20240921161821634.png)

#### github下载

通过GitHub上下载**手机服务端**，通电脑上下载`frida`**版本一样**

github：https://github.com/frida/frida/releases

![image-20240921162054539](https://image.201068.xyz/assets/35.APP/image-20240921162054539.png)

下载链接：https://github.com/frida/frida/releases/download/16.5.2/frida-server-16.5.2-android-x86_64.xz

解压

![image-20240921165207449](https://image.201068.xyz/assets/35.APP/image-20240921165207449.png)

####  查看电脑上frida的版本

```python
frida version
```

![image-20240921161856641](https://image.201068.xyz/assets/35.APP/image-20240921161856641.png)

#### frida放⼊Android

```python
adb push frida-server-16.5.2-android-x86_64 /data/local/tmp
```

### 3.3. Frida的使用

#### 1.启动Frida服务

启动Frida服务 保持模拟器的打开状态

```bash
adb devices
adb shell
su
cd /data/local/tmp/
chmod 755 frida-server-16.5.2-android-x86_64
./frida-server-16.5.2-android-x86_64
```

![image-20240921165419451](https://image.201068.xyz/assets/35.APP/image-20240921165419451.png)

#### 2.停止frida-service 服务

```bash
ps | grep frida     //查看服务是否启动

kill -s 9 3082  		//杀死服务(4743是进程id)
```

![image-20240921165807978](https://image.201068.xyz/assets/35.APP/image-20240921165807978.png)

#### 3.查看进程

```python
frida-ps -U
```

![image-20240921170055346](https://image.201068.xyz/assets/35.APP/image-20240921170055346.png)

https://blog.csdn.net/qq910689331/article/details/124115640

## 四.Camille

### 4.1.camille简介

github：https://github.com/zhengjim/camille

Android **App隐私合规检测**辅助⼯具 

现如今APP隐私合规⼗分重要，各监管部⻔不断开展APP专项治理⼯作及核查通报，不合规的APP通知整改或直接下架。

`camille`可以hook住Android敏感接⼝，检测是否第三⽅`SDK`调⽤。

根据隐私合规的场景，辅助检查是否符合隐私合规标准。

### 4.2.camille安装与配置

```python
git clone https://github.com/zhengjim/camille.git
cd camille
pip install -r requirements.txt
python camille.py -h
```

![image-20240921171521645](https://image.201068.xyz/assets/35.APP/image-20240921171521645.png)

### 4.3.运行camille

####  1.需要安装预先模块进行使用

```python
pip install xlwt
pip install opencv-contrib-python
pip install opencv-python
```

####  2.进⼊后进⾏如下操作 

 `Camille`的运⾏需要知道待检测的APP包名，如何知道呢？

这⾥我们需要在`bin`⽬录下打开⼀个新的CMD 窗⼝，运⾏下⾯的指令：  

```python
adb shell am monitor
```

之后在模拟器中打开程序，就可以看到包名  


这⾥可以看到包名是：`pay.haikexiaodian.com` 可以做⼀个记录，之后会⽤到。 

```python
python camille.py pay.haikexiaodian.com
python camille.py pay.haikexiaodian.com -ns -f yin.xls
```

###  4.5.不合规项目确定  

https://github.com/zhengjim/camille/blob/master/docs/use.md

## 五.APP隐私合规检测实操案例

### 1.打开Frida服务

打开Frida服务  ，保持模拟器的打开状态

```python
adb devices
adb shell
su
cd /data/local/tmp/
chmod 755 frida-server-16.0.1-android-x86_64
./frida-server-16.1.4-android-x86_64
```

### 2. 查看需要检测的APP包名  

 `Camille`的运⾏需要知道待检测的APP包名，如何知道呢？

这⾥我们需要在`bin`⽬录下打开⼀个新的CMD 窗⼝，运⾏下⾯的指令：  

```python
adb shell am monitor
```

之后在模拟器中打开程序，就可以看到包名  


这⾥可以看到包名是：`pay.haikexiaodian.com` 可以做⼀个记录，之后会⽤到。  



# 4、pixel线刷教程+进入fastboot模式

```python
pixel
一：线刷，fastboot
二：卡刷，手机都有sdcard，micro sdcarf -->USB读卡器，rom包拷贝到sdcard，recovery去刷
```

## 1、通过Google进行刷机


https://developer.android.google.cn/about/versions/oreo?hl=zh-cn 


通过 Android 平台


https://developers.google.com/android/images


选择合适的二进制映像文件

## 2、pixel刷机

线刷逻辑：电脑准备系统包和sdk工具包 —— 手机在关机状态通过usb数据线连接电脑 —— 刷入系统

前提：已解BL锁。

BL锁全称为BootLoader，字面意思就是启动加载，只有先解锁了BL才能获取root权限、刷入第三方系统包。

> 类似windows开机时会首先加载bios，然后是系统内核，最后启动完毕。
>
> 那么bootloader就相当于手机的bios，它在手机启动的时候根据基带初始化硬件，然后引导系统内核，直到系统启动。
>
> 解BL锁会清除用户数据，所以最好在拿到手机的第一时间就先把BL解了。
>
> 本人的pixel在购买时就已经被店家解锁好了。

### 1.手机进入bootloader


由于手机无法正常进入系统，循环在开机logo界面，所以必须先退出该循环，进入bootloader模
式，为随后刷机做准备。

方式：长按开机键先重启，屏幕黑屏后一直按音量减，直到出现写着Fastboot Mode的界面，且
device state显示unlocked表示已解BL。

### 2.电脑准备好系统包和SDK工具包


刷系统指的是要刷入原生Android 13系统，因此根据相应的型号和系统版本号，在[


官网](https://developers.google.cn/android/images?hl=zh-cn)上下载对应的系统包（ROM image），文件比较大耐心等待。

#### 下载SDK工具包


Android SDK Platform-Tools 是 Android SDK 的一个组件，包含一些可以在电脑上对 Android 平台进行调试的工具，主要是 adb 和 fastboot。 Platform-Tools用来辅助刷入系统包。

根据电脑系统，选择对应的Windows/Mac版本下载，地址：

https://developer.android.com/studio/releases/platform-tools?hl=zh-cn

> 注：platform-tools一般是向后兼容，所以要刷Android 13的话，用31版本和之后的都可以。
>
> 但网上反应用最新的34版本刷会有问题，所以建议下载33版本的。

### 3.手机连接电脑


找一根数据线连接电脑和pixel。在platform-tools文件夹下cmd进入，输入`fastboot devices`若返回序列号则表示连接成功。

### 4.修改配置文件，刷入系统

#### （1） 解压系统包

（ps：里面的image-flame-xxx.zip不用解压）打开目录里的`flash-all.sh`文件，编辑其中的一行命令删除`-w`以保留用户数据

删去这里的-w参数


    fastboot -w update image-flame-tp1a.221005.002.b2.zip

#### （2）platform-tools

把`platform-tools`里的所有文件复制到系统包文件夹里

#### （3）`bootloader`模式

确保手机在`bootloader`模式下连接电脑，双击`flash-all.bat`即可刷入系统。

https://www.bilibili.com/opus/782676988684926985

https://support.yeshen.com/zh-CN/qt/jssb

